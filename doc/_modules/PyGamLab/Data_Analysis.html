<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="author" title="About these documents" href="../../about.html" /><link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" />

    <!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>PyGamLab.Data_Analysis - PyGamLab 2.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">PyGamLab 2.0.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../../_static/logo_dark.png" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../../_static/logo_dark.png" alt="Dark Logo"/>
  </div>
  
  <span class="sidebar-brand-text">PyGamLab 2.0.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart.html">Getting Started</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../modules.html">🧩 Modules</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of 🧩 Modules</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../modules_/structures.html">Structures Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modules_/databases.html">Databases Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modules_/ai_core.html">AI Core Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modules_/data_analysis.html">Data_Analysis Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modules_/constants.html">Constants Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modules_/converters.html">Convertors Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modules_/functions.html">Functions Module</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../examples.html">💡 Examples</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of 💡 Examples</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../examples_/data_analysis_example.html">Data Analysis Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples_/structures_example.html">Structures Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples_/ai_workflow_example.html">AI Example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../citation.html">Citation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../collaborate.html">Collaborate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">About PyGamLab</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../license.html">License</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <h1>Source code for PyGamLab.Data_Analysis</h1><div class="highlight"><pre>
<span></span><span class="c1">#import-----------------------------------------</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">statistics</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="c1">#import matplotlib as plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.ticker</span><span class="w"> </span><span class="kn">import</span> <span class="n">AutoMinorLocator</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span> 
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.integrate</span><span class="w"> </span><span class="kn">import</span> <span class="n">solve_bvp</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.signal</span><span class="w"> </span><span class="kn">import</span> <span class="n">savgol_filter</span><span class="p">,</span> <span class="n">find_peaks</span> <span class="p">,</span> <span class="n">peak_widths</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.interpolate</span><span class="w"> </span><span class="kn">import</span> <span class="n">interp1d</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">brentq</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.integrate</span><span class="w"> </span><span class="kn">import</span> <span class="n">simpson</span>  <span class="c1"># Corrected import</span>




<div class="viewcode-block" id="DSC">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.DSC">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">DSC</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">application</span><span class="o">=</span><span class="s2">&quot;plot&quot;</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">sample_mass</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">heating_rate</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform Differential Scanning Calorimetry (DSC) data processing, analysis, and visualization.</span>

<span class="sd">    This function allows for automated DSC curve plotting, peak detection, </span>
<span class="sd">    transition temperature determination (Tg, Tm, Tc), enthalpy (ΔH) estimation, </span>
<span class="sd">    and kinetic analysis from experimental DSC datasets. The analysis can be </span>
<span class="sd">    adapted for both exothermic-up and endothermic-up instrument conventions.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : pandas.DataFrame</span>
<span class="sd">        Input DataFrame containing DSC measurement data. It must include one of:</span>
<span class="sd">        - Columns [&quot;t&quot;, &quot;Value&quot;] for time-based measurements, or</span>
<span class="sd">        - Columns [&quot;Temperature&quot;, &quot;Value&quot;] for temperature-based measurements.</span>
<span class="sd">    </span>
<span class="sd">    application : str, optional, default=&quot;plot&quot;</span>
<span class="sd">        The type of analysis or operation to perform. </span>
<span class="sd">        Supported options include:</span>
<span class="sd">        - `&quot;plot&quot;` : Plot the raw DSC curve.</span>
<span class="sd">        - `&quot;peak_detection&quot;` : Detect and label endothermic and exothermic peaks.</span>
<span class="sd">        - `&quot;Tg&quot;` : Estimate the glass transition temperature (Tg).</span>
<span class="sd">        - `&quot;Tm&quot;` : Determine the melting temperature (Tm).</span>
<span class="sd">        - `&quot;Tc&quot;` : Determine the crystallization temperature (Tc).</span>
<span class="sd">        - `&quot;dH&quot;` : Compute enthalpy changes (ΔH) for detected events.</span>
<span class="sd">        - `&quot;kinetics&quot;` : Estimate reaction onset, peak, endset, and corresponding ΔH.</span>

<span class="sd">    prominence : float, optional, default=0.5</span>
<span class="sd">        Minimum prominence of peaks for detection. Higher values filter out smaller peaks.</span>
<span class="sd">        Passed to `scipy.signal.find_peaks`.</span>

<span class="sd">    distance : int, optional, default=5</span>
<span class="sd">        Minimum number of data points between detected peaks. </span>
<span class="sd">        Helps to separate closely spaced transitions.</span>

<span class="sd">    sample_mass : float, optional, default=1.0</span>
<span class="sd">        Sample mass in milligrams (mg). Used to normalize enthalpy (ΔH) values.</span>

<span class="sd">    heating_rate : float, optional, default=1.0</span>
<span class="sd">        Heating or cooling rate in °C/min. Used to normalize ΔH for temperature-based data.</span>

<span class="sd">    orientation : str or None, optional, default=None</span>
<span class="sd">        Defines the thermal orientation of the DSC instrument:</span>
<span class="sd">        - `&quot;exo_up&quot;` : Exothermic events produce positive peaks.</span>
<span class="sd">        - `&quot;endo_up&quot;` : Endothermic events produce positive peaks.</span>
<span class="sd">        If None, the user is prompted interactively to choose.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    varies depending on `application`</span>
<span class="sd">        - `&quot;plot&quot;` : None</span>
<span class="sd">        - `&quot;peak_detection&quot;` : dict</span>
<span class="sd">            Contains coordinates of detected endothermic and exothermic peaks:</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;endothermic&quot;: [(x1, y1), (x2, y2), ...],</span>
<span class="sd">                    &quot;exothermic&quot;: [(x1, y1), (x2, y2), ...]</span>
<span class="sd">                }</span>
<span class="sd">        - `&quot;Tg&quot;`, `&quot;Tm&quot;`, `&quot;Tc&quot;` : float</span>
<span class="sd">            The estimated transition temperature value in the same units as the x-axis.</span>
<span class="sd">        - `&quot;dH&quot;` : list of tuples</span>
<span class="sd">            Each tuple contains (Temperature, Signal, ΔH) for detected events.</span>
<span class="sd">        - `&quot;kinetics&quot;` : list of dict</span>
<span class="sd">            Each dictionary contains:</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;Onset&quot;: float,</span>
<span class="sd">                    &quot;Peak&quot;: float,</span>
<span class="sd">                    &quot;End&quot;: float,</span>
<span class="sd">                    &quot;ΔH (J/g)&quot;: float</span>
<span class="sd">                }</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If the required data columns are missing or if `application` </span>
<span class="sd">        is not one of the supported analysis modes.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - The function automatically handles both time-based (`t`) and temperature-based (`Temperature`) DSC data.</span>
<span class="sd">    - The `orientation` parameter affects sign convention in peak detection and ΔH calculation.</span>
<span class="sd">      For example, `exo_up` instruments produce positive exothermic peaks, </span>
<span class="sd">      while `endo_up` instruments produce negative ones.</span>
<span class="sd">    - The area under peaks (ΔH) is numerically integrated using the trapezoidal rule.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">    &gt;&gt;&gt; data = pd.read_csv(&quot;sample_dsc.csv&quot;)</span>
<span class="sd">    &gt;&gt;&gt; DSC(data, application=&quot;plot&quot;)</span>
<span class="sd">    # Displays the DSC curve.</span>

<span class="sd">    &gt;&gt;&gt; results = DSC(data, application=&quot;peak_detection&quot;, orientation=&quot;exo_up&quot;)</span>
<span class="sd">    &gt;&gt;&gt; results[&quot;exothermic&quot;]</span>
<span class="sd">    [(134.2, -0.023), (276.4, -0.018)]</span>

<span class="sd">    &gt;&gt;&gt; Tg = DSC(data, application=&quot;Tg&quot;, orientation=&quot;exo_up&quot;)</span>
<span class="sd">    Estimated Glass Transition Temperature (Tg): 65.12 °C</span>

<span class="sd">    &gt;&gt;&gt; dH_values = DSC(data, application=&quot;dH&quot;, sample_mass=5.0, heating_rate=10.0, orientation=&quot;endo_up&quot;)</span>
<span class="sd">    Enthalpy Changes (ΔH):</span>
<span class="sd">    Peak at 135.50 °C, ΔH ≈ 25.432 J/g</span>
<span class="sd">    &quot;&quot;&quot;</span>
        
    <span class="c1"># Determine X and Y columns</span>
    <span class="k">if</span> <span class="s2">&quot;t&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="s2">&quot;Value&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">x_col</span> <span class="o">=</span> <span class="s2">&quot;t&quot;</span>
        <span class="n">y_col</span> <span class="o">=</span> <span class="s2">&quot;Value&quot;</span>
    <span class="k">elif</span> <span class="s2">&quot;Temperature&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="s2">&quot;Value&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">x_col</span> <span class="o">=</span> <span class="s2">&quot;Temperature&quot;</span>
        <span class="n">y_col</span> <span class="o">=</span> <span class="s2">&quot;Value&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Data must contain either &#39;t&#39; or &#39;Temperature&#39; and &#39;Value&#39; columns.&quot;</span><span class="p">)</span>
    
    <span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">x_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">y_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">y_plot</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># always plot raw data</span>
    
    <span class="c1"># Orientation handling</span>
    <span class="k">if</span> <span class="n">orientation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Is your data exo up or endo up? (type &#39;exo&#39; or &#39;endo&#39;): &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">orientation</span> <span class="o">=</span> <span class="s2">&quot;exo_up&quot;</span> <span class="k">if</span> <span class="n">ans</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;exo&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;endo_up&quot;</span>
    
    <span class="n">exo_is_negative</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">orientation</span> <span class="o">==</span> <span class="s2">&quot;endo_up&quot;</span> <span class="k">else</span> <span class="kc">False</span>
    <span class="c1"># If endo_up → exo = negative peaks</span>
    <span class="c1"># If exo_up → exo = positive peaks</span>
    
    <span class="k">if</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;plot&quot;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_plot</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;DSC Curve&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">x_col</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">y_col</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;DSC Curve&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;peak_detection&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">exo_is_negative</span><span class="p">:</span>
            <span class="n">peaks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="n">prominence</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="n">distance</span><span class="p">)</span>       <span class="c1"># endo</span>
            <span class="n">troughs</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="o">-</span><span class="n">y</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="n">prominence</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="n">distance</span><span class="p">)</span>    <span class="c1"># exo</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">peaks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="o">-</span><span class="n">y</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="n">prominence</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="n">distance</span><span class="p">)</span>      <span class="c1"># endo</span>
            <span class="n">troughs</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="n">prominence</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="n">distance</span><span class="p">)</span>     <span class="c1"># exo</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_plot</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;DSC Curve&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">peaks</span><span class="p">],</span> <span class="n">y_plot</span><span class="p">[</span><span class="n">peaks</span><span class="p">],</span> <span class="s2">&quot;ro&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Endothermic Peaks&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">troughs</span><span class="p">],</span> <span class="n">y_plot</span><span class="p">[</span><span class="n">troughs</span><span class="p">],</span> <span class="s2">&quot;bo&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Exothermic Peaks&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">x_col</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">y_col</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;DSC Curve with Peak Detection&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;endothermic&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">peaks</span><span class="p">],</span>
            <span class="s2">&quot;exothermic&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">troughs</span><span class="p">]</span>
        <span class="p">}</span>
    
    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;Tg&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">x_col</span> <span class="o">==</span> <span class="s2">&quot;t&quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tg calculation requires Temperature as x-axis, not Time.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">dy_dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">Tg_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dy_dx</span><span class="p">))</span>
        <span class="n">Tg_value</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">Tg_index</span><span class="p">]</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_plot</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;DSC Curve&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">Tg_value</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Tg ≈ </span><span class="si">{</span><span class="n">Tg_value</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">x_col</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">y_col</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;DSC Curve with Tg&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Estimated Glass Transition Temperature (Tg): </span><span class="si">{</span><span class="n">Tg_value</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">x_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Tg_value</span>
    
    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;Tm&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">x_col</span> <span class="o">==</span> <span class="s2">&quot;t&quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tm calculation requires Temperature as x-axis, not Time.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        
        <span class="k">if</span> <span class="n">exo_is_negative</span><span class="p">:</span>
            <span class="n">peaks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="n">prominence</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="n">distance</span><span class="p">)</span>  <span class="c1"># endo melting</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">peaks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="o">-</span><span class="n">y</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="n">prominence</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="n">distance</span><span class="p">)</span> <span class="c1"># endo melting</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No melting peak detected.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">max_peak_idx</span> <span class="o">=</span> <span class="n">peaks</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">peaks</span><span class="p">]))]</span>
        <span class="n">Tm_value</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">max_peak_idx</span><span class="p">]</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_plot</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;DSC Curve&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">max_peak_idx</span><span class="p">],</span> <span class="n">y_plot</span><span class="p">[</span><span class="n">max_peak_idx</span><span class="p">],</span> <span class="s2">&quot;ro&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Tm ≈ </span><span class="si">{</span><span class="n">Tm_value</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">x_col</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">y_col</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;DSC Curve with Melting Point&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Estimated Melting Point (Tm): </span><span class="si">{</span><span class="n">Tm_value</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">x_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Tm_value</span>
    
    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;Tc&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">x_col</span> <span class="o">==</span> <span class="s2">&quot;t&quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tc calculation requires Temperature as x-axis, not Time.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        
        <span class="k">if</span> <span class="n">exo_is_negative</span><span class="p">:</span>
            <span class="n">troughs</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="o">-</span><span class="n">y</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="n">prominence</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="n">distance</span><span class="p">)</span>  <span class="c1"># exo crystallization</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">troughs</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="n">prominence</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="n">distance</span><span class="p">)</span>   <span class="c1"># exo crystallization</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">troughs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No crystallization peak detected.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">max_trough_idx</span> <span class="o">=</span> <span class="n">troughs</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">troughs</span><span class="p">]))]</span>
        <span class="n">Tc_value</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">max_trough_idx</span><span class="p">]</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_plot</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;DSC Curve&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">max_trough_idx</span><span class="p">],</span> <span class="n">y_plot</span><span class="p">[</span><span class="n">max_trough_idx</span><span class="p">],</span> <span class="s2">&quot;bo&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Tc ≈ </span><span class="si">{</span><span class="n">Tc_value</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">x_col</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">y_col</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;DSC Curve with Crystallization Temperature&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Estimated Crystallization Temperature (Tc): </span><span class="si">{</span><span class="n">Tc_value</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">x_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Tc_value</span>
    
    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;dH&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">exo_is_negative</span><span class="p">:</span>
            <span class="n">peaks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="n">prominence</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="n">distance</span><span class="p">)</span>
            <span class="n">troughs</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="o">-</span><span class="n">y</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="n">prominence</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="n">distance</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">peaks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="o">-</span><span class="n">y</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="n">prominence</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="n">distance</span><span class="p">)</span>
            <span class="n">troughs</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="n">prominence</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="n">distance</span><span class="p">)</span>
        
        <span class="n">all_events</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">peaks</span><span class="p">,</span> <span class="n">troughs</span><span class="p">)))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_events</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No events found for enthalpy calculation.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_plot</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;DSC Curve&quot;</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">all_events</span><span class="p">:</span>
            <span class="n">left</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mi">20</span><span class="p">)</span>
            <span class="n">right</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">20</span><span class="p">)</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">left</span><span class="p">:</span><span class="n">right</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">avg_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">left</span><span class="p">:</span><span class="n">right</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="n">left</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">right</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">area</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">avg_y</span> <span class="o">*</span> <span class="n">dx</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">x_col</span> <span class="o">==</span> <span class="s2">&quot;t&quot;</span><span class="p">:</span>
                <span class="n">dH</span> <span class="o">=</span> <span class="n">area</span> <span class="o">/</span> <span class="n">sample_mass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dH</span> <span class="o">=</span> <span class="n">area</span> <span class="o">/</span> <span class="p">(</span><span class="n">heating_rate</span> <span class="o">*</span> <span class="n">sample_mass</span><span class="p">)</span>
            
            <span class="c1"># Apply orientation sign convention</span>
            <span class="k">if</span> <span class="n">orientation</span> <span class="o">==</span> <span class="s2">&quot;exo_up&quot;</span><span class="p">:</span>
                <span class="n">dH</span> <span class="o">=</span> <span class="o">-</span><span class="n">dH</span>
            
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">dH</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">left</span><span class="p">:</span><span class="n">right</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">y_plot</span><span class="p">[</span><span class="n">left</span><span class="p">:</span><span class="n">right</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;ΔH at </span><span class="si">{</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">x_col</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">y_col</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;DSC Curve with Enthalpy Areas&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Enthalpy Changes (ΔH):&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Peak at </span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">x_col</span><span class="si">}</span><span class="s2">, ΔH ≈ </span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> J/g&quot;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">results</span>
    
    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;kinetics&quot;</span><span class="p">:</span>
        <span class="n">peaks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">prominence</span><span class="o">=</span><span class="n">prominence</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="n">distance</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No reaction events detected.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_plot</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;DSC Curve&quot;</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">peaks</span><span class="p">:</span>
            <span class="n">left</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mi">30</span><span class="p">)</span>
            <span class="n">right</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">30</span><span class="p">)</span>
            <span class="n">onset</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">left</span><span class="p">]</span>
            <span class="n">endset</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">right</span><span class="p">]</span>
            <span class="n">peak_temp</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            
            <span class="n">dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">left</span><span class="p">:</span><span class="n">right</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">avg_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">left</span><span class="p">:</span><span class="n">right</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="n">left</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">right</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">area</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">avg_y</span> <span class="o">*</span> <span class="n">dx</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">x_col</span> <span class="o">==</span> <span class="s2">&quot;t&quot;</span><span class="p">:</span>
                <span class="n">dH</span> <span class="o">=</span> <span class="n">area</span> <span class="o">/</span> <span class="n">sample_mass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dH</span> <span class="o">=</span> <span class="n">area</span> <span class="o">/</span> <span class="p">(</span><span class="n">heating_rate</span> <span class="o">*</span> <span class="n">sample_mass</span><span class="p">)</span>
            
            <span class="c1"># Orientation adjustment</span>
            <span class="k">if</span> <span class="n">orientation</span> <span class="o">==</span> <span class="s2">&quot;exo_up&quot;</span><span class="p">:</span>
                <span class="n">dH</span> <span class="o">=</span> <span class="o">-</span><span class="n">dH</span>
            
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">&quot;Onset&quot;</span><span class="p">:</span> <span class="n">onset</span><span class="p">,</span>
                <span class="s2">&quot;Peak&quot;</span><span class="p">:</span> <span class="n">peak_temp</span><span class="p">,</span>
                <span class="s2">&quot;End&quot;</span><span class="p">:</span> <span class="n">endset</span><span class="p">,</span>
                <span class="s2">&quot;ΔH (J/g)&quot;</span><span class="p">:</span> <span class="n">dH</span>
            <span class="p">})</span>
            
            <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">left</span><span class="p">:</span><span class="n">right</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">y_plot</span><span class="p">[</span><span class="n">left</span><span class="p">:</span><span class="n">right</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Reaction at </span><span class="si">{</span><span class="n">peak_temp</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">onset</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">endset</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">peak_temp</span><span class="p">,</span> <span class="n">y_plot</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s2">&quot;ro&quot;</span><span class="p">)</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">x_col</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">y_col</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;DSC Reaction Kinetics Analysis&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reaction Kinetics Results:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Onset: </span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;Onset&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">x_col</span><span class="si">}</span><span class="s2">, Peak: </span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;Peak&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, End: </span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;End&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, ΔH ≈ </span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;ΔH (J/g)&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> J/g&quot;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">results</span>
    
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Application must be one of: &#39;plot&#39;,&#39;peak_detection&#39;,&#39;Tg&#39;,&#39;Tm&#39;,&#39;Tc&#39;,&#39;dH&#39;,&#39;kinetics&#39;.&quot;</span><span class="p">)</span></div>




<div class="viewcode-block" id="EELS_Analysis">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.EELS_Analysis">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">EELS_Analysis</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">application</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform quantitative and visual analysis of Electron Energy Loss Spectroscopy (EELS) data.</span>

<span class="sd">    This function allows detailed inspection of EELS spectra across different energy-loss regions,</span>
<span class="sd">    including Zero-Loss Peak (ZLP), low-loss, and core-loss regions. It supports both raw plotting </span>
<span class="sd">    and automated analysis such as peak detection, band gap estimation, plasmon peak identification, </span>
<span class="sd">    and fine structure analysis (ELNES/EXELFS).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : list of tuples/lists or pandas.DataFrame</span>
<span class="sd">        Input EELS data.  </span>
<span class="sd">        - If a list, each element should be `(energy_loss, intensity)`.  </span>
<span class="sd">        - If a DataFrame, it must contain columns:</span>
<span class="sd">          - `&quot;energy_loss&quot;` : float — Energy loss values in eV.</span>
<span class="sd">          - `&quot;Intensity&quot;`   : float — Measured intensity (arbitrary units).</span>

<span class="sd">    application : str</span>
<span class="sd">        Specifies the type of analysis to perform. Options include:</span>
<span class="sd">        </span>
<span class="sd">        - `&quot;plot&quot;` :</span>
<span class="sd">            Simply plot the EELS spectrum for visual inspection.</span>
<span class="sd">        </span>
<span class="sd">        - `&quot;ZLP&quot;` :</span>
<span class="sd">            Analyze the **Zero-Loss Peak (ZLP)** region near 0 eV.  </span>
<span class="sd">            Automatically detects the main elastic scattering peak and estimates:</span>
<span class="sd">              - Peak position (energy in eV)</span>
<span class="sd">              - Peak height (intensity)</span>
<span class="sd">              - Full Width at Half Maximum (FWHM) if determinable.  </span>
<span class="sd">            The results are printed and visualized with the smoothed curve and annotations.</span>
<span class="sd">        </span>
<span class="sd">        - `&quot;low_loss&quot;` :</span>
<span class="sd">            Analyze the **Low-Loss Region (−5 to 50 eV)** including pre-zero baseline.  </span>
<span class="sd">            Performs:</span>
<span class="sd">              - Baseline smoothing and visualization</span>
<span class="sd">              - Detection of **plasmon peaks** (typically &lt;25 eV)</span>
<span class="sd">              - Estimation of **optical band gap (Eg)** via derivative onset method.  </span>
<span class="sd">            Prints and plots plasmon peaks and band gap position.</span>
<span class="sd">        </span>
<span class="sd">        - `&quot;core_loss&quot;` :</span>
<span class="sd">            Analyze the **Core-Loss (High-Loss) Region (&gt;50 eV)**.  </span>
<span class="sd">            Performs:</span>
<span class="sd">              - Edge onset detection using signal derivative</span>
<span class="sd">              - Step height estimation at the absorption edge</span>
<span class="sd">              - Identification of fine structure features:</span>
<span class="sd">                  * ELNES (Energy-Loss Near Edge Structure) within ~30 eV above onset  </span>
<span class="sd">                  * EXELFS (Extended Energy-Loss Fine Structure) oscillations beyond onset  </span>
<span class="sd">            Results include detected edges, peaks, and oscillations with visualized spectrum.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">        The function primarily displays plots and prints analysis results to the console.</span>
<span class="sd">        Key detected parameters (peak positions, FWHM, etc.) are reported in the output text.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - Smoothing is performed using a Savitzky-Golay filter (`scipy.signal.savgol_filter`)</span>
<span class="sd">      with a default window length of 11 and polynomial order of 3.</span>
<span class="sd">    - Peak detection uses `scipy.signal.find_peaks` with adaptive height thresholds.</span>
<span class="sd">    - Energy regions are automatically segmented as:</span>
<span class="sd">        * ZLP: around 0 eV</span>
<span class="sd">        * Low-loss: −5–50 eV</span>
<span class="sd">        * Core-loss: &gt;50 eV</span>
<span class="sd">    - The function assumes intensity units are arbitrary and energy loss is in electronvolts (eV).</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">    &gt;&gt;&gt; data = pd.DataFrame({</span>
<span class="sd">    ...     &quot;energy_loss&quot;: np.linspace(-10, 200, 500),</span>
<span class="sd">    ...     &quot;Intensity&quot;: np.random.random(500) * np.exp(-np.linspace(-10, 200, 500)/100)</span>
<span class="sd">    ... })</span>
<span class="sd">    &gt;&gt;&gt; EELS_Analysis(data, &quot;plot&quot;)</span>
<span class="sd">    # Displays the EELS spectrum</span>

<span class="sd">    &gt;&gt;&gt; EELS_Analysis(data, &quot;ZLP&quot;)</span>
<span class="sd">    # Detects and plots Zero-Loss Peak with FWHM estimation</span>

<span class="sd">    &gt;&gt;&gt; EELS_Analysis(data, &quot;low_loss&quot;)</span>
<span class="sd">    # Identifies plasmon peaks and estimates band gap</span>

<span class="sd">    &gt;&gt;&gt; EELS_Analysis(data, &quot;core_loss&quot;)</span>
<span class="sd">    # Detects absorption edge and ELNES/EXELFS features</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Handle both DataFrame and list input</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="n">energy_loss</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;energy_loss&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">intensity</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Intensity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">energy_loss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">data</span><span class="p">])</span>
        <span class="n">intensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">data</span><span class="p">])</span>

    <span class="c1"># ====== PLOT APPLICATION ======</span>
    <span class="k">if</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;plot&quot;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">energy_loss</span><span class="p">,</span> <span class="n">intensity</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;EELS Spectrum&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Energy Loss (ΔE) [eV]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Intensity (a.u.)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># ====== ZERO LOSS PEAK ======</span>
    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;ZLP&quot;</span><span class="p">:</span>
        <span class="n">smoothed_intensity</span> <span class="o">=</span> <span class="n">savgol_filter</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="n">window_length</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">polyorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">peaks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">smoothed_intensity</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">smoothed_intensity</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;⚠️ No Zero-Loss Peak detected.&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="n">peak_idx</span> <span class="o">=</span> <span class="n">peaks</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">energy_loss</span><span class="p">[</span><span class="n">peaks</span><span class="p">]))]</span>
        <span class="n">peak_position</span> <span class="o">=</span> <span class="n">energy_loss</span><span class="p">[</span><span class="n">peak_idx</span><span class="p">]</span>
        <span class="n">peak_height</span> <span class="o">=</span> <span class="n">smoothed_intensity</span><span class="p">[</span><span class="n">peak_idx</span><span class="p">]</span>

        <span class="n">half_max</span> <span class="o">=</span> <span class="n">peak_height</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">left_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">smoothed_intensity</span><span class="p">[:</span><span class="n">peak_idx</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">half_max</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">right_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">smoothed_intensity</span><span class="p">[</span><span class="n">peak_idx</span><span class="p">:]</span> <span class="o">&lt;=</span> <span class="n">half_max</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">left_idx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">right_idx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">fwhm</span> <span class="o">=</span> <span class="n">energy_loss</span><span class="p">[</span><span class="n">peak_idx</span> <span class="o">+</span> <span class="n">right_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">-</span> <span class="n">energy_loss</span><span class="p">[</span><span class="n">left_idx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fwhm</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;📊 Zero-Loss Peak (ZLP) Analysis:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Peak Position: </span><span class="si">{</span><span class="n">peak_position</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> eV&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Peak Height  : </span><span class="si">{</span><span class="n">peak_height</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> a.u.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fwhm</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Peak Width (FWHM): </span><span class="si">{</span><span class="n">fwhm</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> eV&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   Peak Width (FWHM): Could not be determined&quot;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">energy_loss</span><span class="p">,</span> <span class="n">intensity</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Raw Data&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">energy_loss</span><span class="p">,</span> <span class="n">smoothed_intensity</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Smoothed&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">peak_position</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;ZLP Peak&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fwhm</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">half_max</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Half Maximum&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Zero-Loss Peak (ZLP) Analysis&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Energy Loss (ΔE) [eV]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Intensity (a.u.)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># ====== LOW LOSS REGION ======</span>
    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;low_loss&quot;</span><span class="p">:</span>
    <span class="c1"># Keep a window that includes negative values for proper baseline</span>
        <span class="n">mask_full</span> <span class="o">=</span> <span class="p">(</span><span class="n">energy_loss</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">energy_loss</span> <span class="o">&lt;=</span> <span class="mi">50</span><span class="p">)</span>   <span class="c1"># allow pre-zero baseline</span>
        <span class="n">E_full</span> <span class="o">=</span> <span class="n">energy_loss</span><span class="p">[</span><span class="n">mask_full</span><span class="p">]</span>
        <span class="n">I_full</span> <span class="o">=</span> <span class="n">intensity</span><span class="p">[</span><span class="n">mask_full</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">E_full</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;⚠️ No data in -5–50 eV range.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">smoothed_full</span> <span class="o">=</span> <span class="n">savgol_filter</span><span class="p">(</span><span class="n">I_full</span><span class="p">,</span> <span class="n">window_length</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">polyorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

        <span class="c1"># Extract 0–50 eV part (for plasmon &amp; bandgap plotting)</span>
        <span class="n">mask_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">E_full</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">E_full</span> <span class="o">&lt;=</span> <span class="mi">50</span><span class="p">)</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">E_full</span><span class="p">[</span><span class="n">mask_pos</span><span class="p">]</span>
        <span class="n">smoothed_I</span> <span class="o">=</span> <span class="n">smoothed_full</span><span class="p">[</span><span class="n">mask_pos</span><span class="p">]</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">I_full</span><span class="p">[</span><span class="n">mask_pos</span><span class="p">]</span>

        <span class="c1"># ---- Detect plasmon peaks (&lt;20 eV typically) ----</span>
        <span class="n">plasmon_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">E</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">E</span> <span class="o">&lt;=</span> <span class="mi">25</span><span class="p">)</span>   <span class="c1"># restrict to plasmon range</span>
        <span class="n">E_plasmon</span> <span class="o">=</span> <span class="n">E</span><span class="p">[</span><span class="n">plasmon_mask</span><span class="p">]</span>
        <span class="n">I_plasmon</span> <span class="o">=</span> <span class="n">smoothed_I</span><span class="p">[</span><span class="n">plasmon_mask</span><span class="p">]</span>

        <span class="n">peaks</span><span class="p">,</span> <span class="n">props</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">I_plasmon</span><span class="p">,</span> 
                                <span class="n">height</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">I_plasmon</span><span class="p">)</span><span class="o">*</span><span class="mf">0.08</span><span class="p">,</span>  <span class="c1"># lower threshold</span>
                                <span class="n">distance</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="n">plasmon_info</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">peaks</span><span class="p">:</span>
            <span class="n">peak_pos</span> <span class="o">=</span> <span class="n">E_plasmon</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
            <span class="n">peak_height</span> <span class="o">=</span> <span class="n">I_plasmon</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
            <span class="n">half_max</span> <span class="o">=</span> <span class="n">peak_height</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">left_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">I_plasmon</span><span class="p">[:</span><span class="n">p</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">half_max</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">right_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">I_plasmon</span><span class="p">[</span><span class="n">p</span><span class="p">:]</span> <span class="o">&lt;=</span> <span class="n">half_max</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">left_idx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">right_idx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">width</span> <span class="o">=</span> <span class="n">E_plasmon</span><span class="p">[</span><span class="n">p</span> <span class="o">+</span> <span class="n">right_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">-</span> <span class="n">E_plasmon</span><span class="p">[</span><span class="n">left_idx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">width</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">plasmon_info</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">peak_pos</span><span class="p">,</span> <span class="n">peak_height</span><span class="p">,</span> <span class="n">width</span><span class="p">))</span>

        <span class="c1"># ---- Band gap estimation ----</span>
        <span class="c1"># baseline = min around -5 to 0 eV</span>
        <span class="n">baseline_region</span> <span class="o">=</span> <span class="p">(</span><span class="n">E_full</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">E_full</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">baseline</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">smoothed_full</span><span class="p">[</span><span class="n">baseline_region</span><span class="p">])</span>
        <span class="n">dI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">smoothed_I</span><span class="p">,</span> <span class="n">E</span><span class="p">)</span>   <span class="c1"># derivative</span>
        <span class="n">dI_threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dI</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span>  

        <span class="n">valid_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">E</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">onset_candidates</span> <span class="o">=</span> <span class="n">valid_idx</span><span class="p">[</span><span class="n">dI</span><span class="p">[</span><span class="n">valid_idx</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">dI_threshold</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">onset_candidates</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">band_gap</span> <span class="o">=</span> <span class="n">E</span><span class="p">[</span><span class="n">onset_candidates</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">band_gap</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># ---- Print results ----</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;📊 Low-Loss Region Analysis (-5–50 eV):&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">band_gap</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Estimated Band Gap Eg: </span><span class="si">{</span><span class="n">band_gap</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> eV&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   Band Gap: Could not be determined&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plasmon_info</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">plasmon_info</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Plasmon Peak </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">pos</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> eV, Height=</span><span class="si">{</span><span class="n">h</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, Width=</span><span class="si">{</span><span class="n">w</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;N/A&#39;</span><span class="si">}</span><span class="s2"> eV&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   No plasmon peaks detected.&quot;</span><span class="p">)</span>

        <span class="c1"># ---- Plot ----</span>
        <span class="c1"># ---- Plot ----</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">E_full</span><span class="p">,</span> <span class="n">I_full</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Raw Data (-5–50 eV)&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">E_full</span><span class="p">,</span> <span class="n">smoothed_full</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Smoothed&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">band_gap</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">band_gap</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Band Gap ≈ </span><span class="si">{</span><span class="n">band_gap</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> eV&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">plasmon_info</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Plasmon </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">pos</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> eV&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Low-Loss Region Analysis (with pre-zero baseline)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Energy Loss (ΔE) [eV]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Intensity (a.u.)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># ====== CORE LOSS REGION ======</span>
    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;core_loss&quot;</span><span class="p">:</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">energy_loss</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">)</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">energy_loss</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">intensity</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">E</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;⚠️ No data in &gt;50 eV range.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">smoothed_I</span> <span class="o">=</span> <span class="n">savgol_filter</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">window_length</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">polyorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

        <span class="c1"># Detect edges via derivative</span>
        <span class="n">derivative</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">smoothed_I</span><span class="p">,</span> <span class="n">E</span><span class="p">)</span>
        <span class="n">edge_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">derivative</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">derivative</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">edge_idx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">edge_onset</span> <span class="o">=</span> <span class="n">E</span><span class="p">[</span><span class="n">edge_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">step_height</span> <span class="o">=</span> <span class="n">smoothed_I</span><span class="p">[</span><span class="n">edge_idx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">-</span> <span class="n">smoothed_I</span><span class="p">[</span><span class="n">edge_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">edge_onset</span><span class="p">,</span> <span class="n">step_height</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

        <span class="c1"># ELNES peaks: local maxima near edge (within 30 eV above onset)</span>
        <span class="n">elnes_info</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">edge_onset</span><span class="p">:</span>
            <span class="n">near_edge_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">E</span> <span class="o">&gt;=</span> <span class="n">edge_onset</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">E</span> <span class="o">&lt;=</span> <span class="n">edge_onset</span> <span class="o">+</span> <span class="mi">30</span><span class="p">)</span>
            <span class="n">E_near</span><span class="p">,</span> <span class="n">I_near</span> <span class="o">=</span> <span class="n">E</span><span class="p">[</span><span class="n">near_edge_mask</span><span class="p">],</span> <span class="n">smoothed_I</span><span class="p">[</span><span class="n">near_edge_mask</span><span class="p">]</span>
            <span class="n">peaks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">I_near</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">I_near</span><span class="p">)</span><span class="o">*</span><span class="mf">0.2</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">peaks</span><span class="p">:</span>
                <span class="n">elnes_info</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">E_near</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="n">I_near</span><span class="p">[</span><span class="n">p</span><span class="p">]))</span>

        <span class="c1"># EXELFS: oscillations further above the edge (&gt;30 eV after onset)</span>
        <span class="n">exelfs_info</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">edge_onset</span><span class="p">:</span>
            <span class="n">exelfs_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">E</span> <span class="o">&gt;</span> <span class="n">edge_onset</span> <span class="o">+</span> <span class="mi">30</span><span class="p">)</span>
            <span class="n">E_far</span><span class="p">,</span> <span class="n">I_far</span> <span class="o">=</span> <span class="n">E</span><span class="p">[</span><span class="n">exelfs_mask</span><span class="p">],</span> <span class="n">smoothed_I</span><span class="p">[</span><span class="n">exelfs_mask</span><span class="p">]</span>
            <span class="n">peaks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">I_far</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">I_far</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">peaks</span><span class="p">:</span>
                <span class="n">exelfs_info</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">E_far</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="n">I_far</span><span class="p">[</span><span class="n">p</span><span class="p">]))</span>

        <span class="c1"># Print results</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;📊 Core-Loss Region Analysis (&gt;50 eV):&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">edge_onset</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Edge Onset Energy: </span><span class="si">{</span><span class="n">edge_onset</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> eV&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Step Height: </span><span class="si">{</span><span class="n">step_height</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> a.u.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   No clear edge detected.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">elnes_info</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">elnes_info</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   ELNES Peak </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">pos</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> eV, Intensity=</span><span class="si">{</span><span class="n">h</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">exelfs_info</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Detected </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">exelfs_info</span><span class="p">)</span><span class="si">}</span><span class="s2"> EXELFS oscillation peaks.&quot;</span><span class="p">)</span>

        <span class="c1"># Plot</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Raw Data&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">smoothed_I</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Smoothed&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">edge_onset</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">edge_onset</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Edge Onset ≈ </span><span class="si">{</span><span class="n">edge_onset</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> eV&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">elnes_info</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="s2">&quot;go&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;ELNES </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">exelfs_info</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="s2">&quot;mo&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;EXELFS&quot;</span> <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Core-Loss Region Analysis (&gt;50 eV)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Energy Loss (ΔE) [eV]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Intensity (a.u.)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>





<div class="viewcode-block" id="Raman_Analysis">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.Raman_Analysis">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Raman_Analysis</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">application</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform quantitative and visual analysis of Raman spectroscopy data.</span>

<span class="sd">    This function provides flexible tools for visualizing and analyzing</span>
<span class="sd">    Raman spectra. It supports basic spectrum plotting and automated</span>
<span class="sd">    peak detection for identifying characteristic Raman bands.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : list of tuples or list of lists</span>
<span class="sd">        Raman spectrum data, where each element corresponds to one measurement point:</span>
<span class="sd">            (wavenumber, intensity)</span>
<span class="sd">        - wavenumber : float</span>
<span class="sd">            Raman shift in inverse centimeters (cm⁻¹)</span>
<span class="sd">        - intensity : float</span>
<span class="sd">            Measured Raman intensity in arbitrary units (a.u.)</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; data = [(100, 0.1), (150, 0.5), (200, 1.2)]</span>

<span class="sd">    application : str</span>
<span class="sd">        Defines the type of analysis to perform. Supported options:</span>

<span class="sd">        - `&quot;plot&quot;` :</span>
<span class="sd">            Plot the Raman spectrum with labeled axes and gridlines for quick visual inspection.</span>
<span class="sd">        </span>
<span class="sd">        - `&quot;peak_detect&quot;` :</span>
<span class="sd">            Automatically detect and highlight prominent peaks in the Raman spectrum.  </span>
<span class="sd">            Peak detection is performed using `scipy.signal.find_peaks` with:</span>
<span class="sd">              * Minimum peak height = 10% of maximum intensity</span>
<span class="sd">              * Minimum distance between peaks = 5 data points  </span>
<span class="sd">            The detected peaks are printed (wavenumber and intensity) and plotted with red markers.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If the data format is invalid or the specified application is not supported.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">        The function generates plots and prints peak data to the console when applicable.</span>
<span class="sd">        No explicit return value.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - The function assumes Raman shift values are given in cm⁻¹ and intensity in arbitrary units.</span>
<span class="sd">    - The x-axis is plotted as Raman shift (increasing rightward). Uncomment the `invert_xaxis()`</span>
<span class="sd">      line to follow the traditional Raman plotting convention (decreasing Raman shift).</span>
<span class="sd">    - Peak detection parameters (height and distance) can be fine-tuned based on spectral resolution.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; # Generate synthetic Raman data</span>
<span class="sd">    &gt;&gt;&gt; wavenumbers = np.linspace(100, 2000, 500)</span>
<span class="sd">    &gt;&gt;&gt; intensities = np.exp(-((wavenumbers - 1350)/40)**2) + 0.5*np.exp(-((wavenumbers - 1580)/30)**2)</span>
<span class="sd">    &gt;&gt;&gt; data = list(zip(wavenumbers, intensities))</span>

<span class="sd">    &gt;&gt;&gt; Raman_Analysis(data, &quot;plot&quot;)</span>
<span class="sd">    # Displays the Raman spectrum</span>

<span class="sd">    &gt;&gt;&gt; Raman_Analysis(data, &quot;peak_detect&quot;)</span>
<span class="sd">    # Detects and highlights Raman peaks in the spectrum</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># --- Convert data into two lists ---</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">wavenumbers</span> <span class="o">=</span> <span class="p">[</span><span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
        <span class="n">intensities</span> <span class="o">=</span> <span class="p">[</span><span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Data format must be list of (wavenumber, intensity) pairs.&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
    
    <span class="n">wavenumbers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">wavenumbers</span><span class="p">)</span>
    <span class="n">intensities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">intensities</span><span class="p">)</span>
    
    <span class="c1"># --- Application handling ---</span>
    <span class="k">if</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;plot&quot;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wavenumbers</span><span class="p">,</span> <span class="n">intensities</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Raman Shift (cm⁻¹)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Intensity (a.u.)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Raman Spectrum&quot;</span><span class="p">)</span>
        <span class="c1">#plt.gca().invert_xaxis()  # Raman convention</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;peak_detect&quot;</span><span class="p">:</span>
        <span class="c1"># Detect peaks (threshold: 10% of max, min distance=5 points)</span>
        <span class="n">peaks</span><span class="p">,</span> <span class="n">properties</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">intensities</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">intensities</span><span class="p">)</span><span class="o">*</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wavenumbers</span><span class="p">,</span> <span class="n">intensities</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wavenumbers</span><span class="p">[</span><span class="n">peaks</span><span class="p">],</span> <span class="n">intensities</span><span class="p">[</span><span class="n">peaks</span><span class="p">],</span> <span class="s2">&quot;ro&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Detected Peaks&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Raman Shift (cm⁻¹)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Intensity (a.u.)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Raman Spectrum with Peak Detection&quot;</span><span class="p">)</span>
        <span class="c1">#plt.gca().invert_xaxis()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        
        <span class="c1"># Print detected peaks</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Detected peak positions (cm⁻¹):&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">wn</span><span class="p">,</span> <span class="n">inten</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">wavenumbers</span><span class="p">[</span><span class="n">peaks</span><span class="p">],</span> <span class="n">intensities</span><span class="p">[</span><span class="n">peaks</span><span class="p">]):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Peak at </span><span class="si">{</span><span class="n">wn</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> cm⁻¹, Intensity = </span><span class="si">{</span><span class="n">inten</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Application &#39;</span><span class="si">{</span><span class="n">application</span><span class="si">}</span><span class="s2">&#39; not implemented yet.&quot;</span><span class="p">)</span></div>





<div class="viewcode-block" id="TGA">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.TGA">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">TGA</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">application</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform multi-mode Thermogravimetric Analysis (TGA) for material characterization.</span>

<span class="sd">    This function enables comprehensive TGA data analysis for studying</span>
<span class="sd">    thermal stability, composition, surface modification, and reaction kinetics.</span>
<span class="sd">    It supports visualization, derivative thermogravimetry (DTG), decomposition</span>
<span class="sd">    step identification, and moisture or solvent content determination.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : pandas.DataFrame</span>
<span class="sd">        Experimental TGA dataset with the following required columns:</span>
<span class="sd">        - &#39;Temp&#39; : float</span>
<span class="sd">            Temperature in degrees Celsius (°C)</span>
<span class="sd">        - &#39;Mass&#39; : float</span>
<span class="sd">            Corresponding sample mass in percentage (%)</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; data = pd.DataFrame({</span>
<span class="sd">        ...     &quot;Temp&quot;: [25, 100, 200, 300],</span>
<span class="sd">        ...     &quot;Mass&quot;: [100, 99.5, 80.2, 10.5]</span>
<span class="sd">        ... })</span>

<span class="sd">    application : str</span>
<span class="sd">        Defines the type of analysis to perform. Supported options include:</span>

<span class="sd">        - `&quot;plot&quot;` :</span>
<span class="sd">            Plot the raw TGA curve (Mass vs. Temperature).</span>

<span class="sd">        - `&quot;peaks&quot;` :</span>
<span class="sd">            Compute and display the derivative thermogravimetry (DTG) curve</span>
<span class="sd">            and identify key decomposition peaks using `scipy.signal.find_peaks`.</span>

<span class="sd">        - `&quot;stability&quot;` :</span>
<span class="sd">            Estimate the onset temperature of thermal degradation by</span>
<span class="sd">            tangent extrapolation from the baseline region.</span>

<span class="sd">        - `&quot;moisture&quot;` :</span>
<span class="sd">            Calculate moisture or solvent content based on mass loss before</span>
<span class="sd">            the first decomposition event (typically below 150 °C).</span>

<span class="sd">        - `&quot;functionalization&quot;` :</span>
<span class="sd">            Identify surface functionalization or modification steps by</span>
<span class="sd">            detecting multiple degradation peaks above 150 °C.</span>

<span class="sd">        - `&quot;composition&quot;` :</span>
<span class="sd">            Estimate polymer and filler content from the initial and final</span>
<span class="sd">            mass values (residue analysis).</span>

<span class="sd">        - `&quot;DTG&quot;` :</span>
<span class="sd">            Compute and plot the first derivative of the TGA curve (dM/dT)</span>
<span class="sd">            for insight into reaction rate behavior.</span>

<span class="sd">        - `&quot;decomposition_steps&quot;` :</span>
<span class="sd">            Identify and quantify major decomposition events (DTG peaks),</span>
<span class="sd">            returning their temperatures and mass values.</span>

<span class="sd">        - `&quot;kinetics&quot;` :</span>
<span class="sd">            Evaluate relative reaction rates and identify the fastest</span>
<span class="sd">            decomposition step (maximum |dM/dT| above 150 °C).</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    TypeError</span>
<span class="sd">        If the input is not a pandas DataFrame.</span>
<span class="sd">    ValueError</span>
<span class="sd">        If required columns (&#39;Temp&#39;, &#39;Mass&#39;) are missing or</span>
<span class="sd">        if the specified application is not supported.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    object</span>
<span class="sd">        Depends on the application:</span>

<span class="sd">        - `&quot;plot&quot;` :</span>
<span class="sd">            Displays the TGA curve; returns `None`.</span>
<span class="sd">        - `&quot;peaks&quot;` :</span>
<span class="sd">            DataFrame containing detected DTG peak temperatures and intensities.</span>
<span class="sd">        - `&quot;stability&quot;` :</span>
<span class="sd">            Dictionary with onset temperature and mass at onset.</span>
<span class="sd">        - `&quot;moisture&quot;` :</span>
<span class="sd">            Dictionary with moisture content, cutoff temperature, and mass loss.</span>
<span class="sd">        - `&quot;functionalization&quot;` :</span>
<span class="sd">            DataFrame listing detected modification steps.</span>
<span class="sd">        - `&quot;composition&quot;` :</span>
<span class="sd">            Dictionary with polymer and filler content percentages.</span>
<span class="sd">        - `&quot;DTG&quot;` :</span>
<span class="sd">            DataFrame of temperatures and corresponding dM/dT values.</span>
<span class="sd">        - `&quot;decomposition_steps&quot;` :</span>
<span class="sd">            DataFrame of decomposition step information.</span>
<span class="sd">        - `&quot;kinetics&quot;` :</span>
<span class="sd">            Dictionary with step-wise reaction rate data and the fastest decomposition step.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - TGA data should be preprocessed to ensure monotonic temperature increase.</span>
<span class="sd">    - The function uses numerical differentiation (`np.gradient`) for DTG calculations.</span>
<span class="sd">    - Peak prominence thresholds can be adjusted to improve detection sensitivity.</span>
<span class="sd">    - Onset temperatures are approximate and depend on the slope estimation method.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import pandas as pd, numpy as np</span>
<span class="sd">    &gt;&gt;&gt; T = np.linspace(25, 800, 300)</span>
<span class="sd">    &gt;&gt;&gt; M = 100 - 0.05*(T - 25) + 10*np.exp(-((T-400)/50)**2)</span>
<span class="sd">    &gt;&gt;&gt; data = pd.DataFrame({&quot;Temp&quot;: T, &quot;Mass&quot;: M})</span>

<span class="sd">    &gt;&gt;&gt; TGA(data, &quot;plot&quot;)</span>
<span class="sd">    # Displays the TGA curve.</span>

<span class="sd">    &gt;&gt;&gt; peaks_info = TGA(data, &quot;peaks&quot;)</span>
<span class="sd">    &gt;&gt;&gt; print(peaks_info.head())</span>

<span class="sd">    &gt;&gt;&gt; stability = TGA(data, &quot;stability&quot;)</span>
<span class="sd">    &gt;&gt;&gt; print(stability)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Input data must be a pandas DataFrame.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;Temp&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="ow">or</span> <span class="s2">&quot;Mass&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;DataFrame must contain &#39;Temp&#39; and &#39;Mass&#39; columns.&quot;</span><span class="p">)</span>

    <span class="n">T</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Temp&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Mass&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

    <span class="c1"># --- Plot Application ---</span>
    <span class="k">if</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;plot&quot;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;TGA Curve&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Temperature (°C)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Mass (%)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Thermogravimetric Analysis (TGA)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># --- Peak Detection Application ---</span>
    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;peaks&quot;</span><span class="p">:</span>
        <span class="n">dM_dT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
        <span class="n">dM_dT_pos</span> <span class="o">=</span> <span class="o">-</span><span class="n">dM_dT</span>
        <span class="n">peaks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">dM_dT_pos</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>

        <span class="n">peaks_info</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
            <span class="s2">&quot;Temperature&quot;</span><span class="p">:</span> <span class="n">T</span><span class="p">[</span><span class="n">peaks</span><span class="p">],</span>
            <span class="s2">&quot;dM/dT&quot;</span><span class="p">:</span> <span class="n">dM_dT_pos</span><span class="p">[</span><span class="n">peaks</span><span class="p">],</span>
            <span class="s2">&quot;Mass&quot;</span><span class="p">:</span> <span class="n">M</span><span class="p">[</span><span class="n">peaks</span><span class="p">]</span>
        <span class="p">})</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;TGA Curve&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Temperature (°C)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Mass (%)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;TGA Curve&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">dM_dT_pos</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;DTG Curve (dM/dT)&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="n">peaks</span><span class="p">],</span> <span class="n">dM_dT_pos</span><span class="p">[</span><span class="n">peaks</span><span class="p">],</span> <span class="s2">&quot;ko&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Peaks&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">peaks</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="n">dM_dT_pos</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;T=</span><span class="si">{</span><span class="n">T</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Temperature (°C)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;dM/dT&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;DTG Curve with Peak Detection&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">peaks_info</span>

    <span class="c1"># --- Stability Application ---</span>
    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;stability&quot;</span><span class="p">:</span>
        <span class="n">dM_dT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>

        <span class="c1"># Only consider data above 150 °C</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">T</span> <span class="o">&gt;=</span> <span class="mi">150</span>
        <span class="n">T_sub</span> <span class="o">=</span> <span class="n">T</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
        <span class="n">M_sub</span> <span class="o">=</span> <span class="n">M</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
        <span class="n">dM_dT_sub</span> <span class="o">=</span> <span class="n">dM_dT</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>

        <span class="n">onset_temp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">onset_mass</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">tangent_line_T</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">tangent_line_M</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">T_sub</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Find the index of the maximum negative derivative (steepest drop)</span>
            <span class="n">min_deriv_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">dM_dT_sub</span><span class="p">)</span>
            
            <span class="c1"># Get the corresponding temperature and mass</span>
            <span class="n">max_degrad_temp</span> <span class="o">=</span> <span class="n">T_sub</span><span class="p">[</span><span class="n">min_deriv_idx</span><span class="p">]</span>
            <span class="n">max_degrad_mass</span> <span class="o">=</span> <span class="n">M_sub</span><span class="p">[</span><span class="n">min_deriv_idx</span><span class="p">]</span>
            
            <span class="c1"># Get the slope at this point (the maximum negative derivative)</span>
            <span class="n">slope</span> <span class="o">=</span> <span class="n">dM_dT_sub</span><span class="p">[</span><span class="n">min_deriv_idx</span><span class="p">]</span>

            <span class="c1"># Define the initial mass baseline for extrapolation</span>
            <span class="c1"># This is often the average mass in a stable region before degradation</span>
            <span class="c1"># We&#39;ll use the average of the first few points after 150 C</span>
            <span class="n">baseline_mass</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">M_sub</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span>

            <span class="c1"># Calculate the onset temperature using the tangent line equation:</span>
            <span class="c1"># M_tangent = slope * T_tangent + intercept</span>
            <span class="c1"># intercept = max_degrad_mass - slope * max_degrad_temp</span>
            <span class="c1"># At onset, M_tangent = baseline_mass</span>
            <span class="c1"># baseline_mass = slope * onset_temp + intercept</span>
            <span class="c1"># onset_temp = (baseline_mass - intercept) / slope</span>
            <span class="n">onset_temp</span> <span class="o">=</span> <span class="n">max_degrad_temp</span> <span class="o">-</span> <span class="p">(</span><span class="n">max_degrad_mass</span> <span class="o">-</span> <span class="n">baseline_mass</span><span class="p">)</span> <span class="o">/</span> <span class="n">slope</span>
            
            <span class="c1"># Now find the corresponding mass on the original curve</span>
            <span class="c1"># We need to find the index of the temperature closest to onset_temp</span>
            <span class="n">onset_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="n">onset_temp</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
            <span class="n">onset_mass</span> <span class="o">=</span> <span class="n">M</span><span class="p">[</span><span class="n">onset_idx</span><span class="p">]</span>

            <span class="c1"># Generate points for plotting the tangent line</span>
            <span class="n">tangent_line_T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">onset_temp</span><span class="p">,</span> <span class="n">max_degrad_temp</span><span class="p">])</span>
            <span class="n">tangent_line_M</span> <span class="o">=</span> <span class="n">slope</span> <span class="o">*</span> <span class="p">(</span><span class="n">tangent_line_T</span> <span class="o">-</span> <span class="n">max_degrad_temp</span><span class="p">)</span> <span class="o">+</span> <span class="n">max_degrad_mass</span>

        <span class="c1"># --- Plot ---</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;TGA Curve&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">onset_temp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">onset_temp</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Onset ~ </span><span class="si">{</span><span class="n">onset_temp</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> °C&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">onset_temp</span><span class="p">,</span> <span class="n">onset_mass</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> <span class="c1"># zorder ensures it&#39;s on top</span>
            
            <span class="c1"># Plot the tangent line used for calculation</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tangent_line_T</span><span class="p">,</span> <span class="n">tangent_line_M</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Tangent Line&quot;</span><span class="p">)</span>
            
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Temperature (°C)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Mass (%)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Thermal Stability (Onset of Degradation)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;Onset_Temperature&quot;</span><span class="p">:</span> <span class="n">onset_temp</span><span class="p">,</span> <span class="s2">&quot;Mass_at_Onset&quot;</span><span class="p">:</span> <span class="n">onset_mass</span><span class="p">}</span>



    <span class="c1"># --- Moisture Content Application ---</span>
    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;moisture&quot;</span><span class="p">:</span>
        <span class="n">dM_dT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>

        <span class="c1"># Dynamic cutoff detection (first significant drop)</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.01</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dM_dT</span><span class="p">))</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dM_dT</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cutoff_temp</span> <span class="o">=</span> <span class="n">T</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cutoff_temp</span> <span class="o">=</span> <span class="mi">150</span>  <span class="c1"># fallback cutoff</span>

        <span class="c1"># Mass values at start and at cutoff</span>
        <span class="n">initial_mass</span> <span class="o">=</span> <span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">final_mass_cutoff</span> <span class="o">=</span> <span class="n">M</span><span class="p">[</span><span class="n">T</span> <span class="o">&lt;=</span> <span class="n">cutoff_temp</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Moisture/solvent loss up to cutoff</span>
        <span class="n">moisture_loss_cutoff</span> <span class="o">=</span> <span class="n">initial_mass</span> <span class="o">-</span> <span class="n">final_mass_cutoff</span>
        <span class="n">moisture_percent_cutoff</span> <span class="o">=</span> <span class="p">(</span><span class="n">moisture_loss_cutoff</span> <span class="o">/</span> <span class="n">initial_mass</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>

        <span class="c1"># --- Additional calculation: Mass loss up to 150 °C (fixed moisture definition) ---</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">T</span> <span class="o">&lt;=</span> <span class="mi">150</span><span class="p">):</span>
            <span class="n">final_mass_150</span> <span class="o">=</span> <span class="n">M</span><span class="p">[</span><span class="n">T</span> <span class="o">&lt;=</span> <span class="mi">150</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">moisture_loss_150</span> <span class="o">=</span> <span class="n">initial_mass</span> <span class="o">-</span> <span class="n">final_mass_150</span>
            <span class="n">moisture_percent_150</span> <span class="o">=</span> <span class="p">(</span><span class="n">moisture_loss_150</span> <span class="o">/</span> <span class="n">initial_mass</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">final_mass_150</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">moisture_loss_150</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">moisture_percent_150</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Plot</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;TGA Curve&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">cutoff_temp</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Cutoff ~ </span><span class="si">{</span><span class="n">cutoff_temp</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> °C&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cutoff_temp</span><span class="p">],</span> <span class="p">[</span><span class="n">initial_mass</span><span class="p">,</span> <span class="n">final_mass_cutoff</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Dynamic Moisture Loss&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;150 °C Reference&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">final_mass_150</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="mi">150</span><span class="p">],</span> <span class="p">[</span><span class="n">final_mass_150</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;purple&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Mass @ 150 °C&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Temperature (°C)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Mass (%)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Moisture/Solvent Content Analysis&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;Initial_Mass&quot;</span><span class="p">:</span> <span class="n">initial_mass</span><span class="p">,</span>
            <span class="s2">&quot;Final_Mass_at_cutoff&quot;</span><span class="p">:</span> <span class="n">final_mass_cutoff</span><span class="p">,</span>
            <span class="s2">&quot;Moisture_Loss_Cutoff(%)&quot;</span><span class="p">:</span> <span class="n">moisture_percent_cutoff</span><span class="p">,</span>
            <span class="s2">&quot;Cutoff_Temperature&quot;</span><span class="p">:</span> <span class="n">cutoff_temp</span><span class="p">,</span>
            <span class="s2">&quot;Final_Mass_at_150C&quot;</span><span class="p">:</span> <span class="n">final_mass_150</span><span class="p">,</span>
            <span class="s2">&quot;Moisture_Loss_150C(%)&quot;</span><span class="p">:</span> <span class="n">moisture_percent_150</span>
        <span class="p">}</span>


    <span class="c1"># --- Functionalization / Surface Modification Application ---</span>
    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;functionalization&quot;</span><span class="p">:</span>
        <span class="n">dM_dT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
        <span class="n">peaks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="o">-</span><span class="n">dM_dT</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>

        <span class="c1"># Filter out peaks below 150 °C (moisture/solvent)</span>
        <span class="n">peaks</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">peaks</span> <span class="k">if</span> <span class="n">T</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">150</span><span class="p">]</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">peaks</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">mass_loss</span> <span class="o">=</span> <span class="n">M</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">-</span> <span class="n">M</span><span class="p">[</span><span class="n">peaks</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mass_loss</span> <span class="o">=</span> <span class="n">M</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">-</span> <span class="n">M</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">&quot;Step&quot;</span><span class="p">:</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;Temperature&quot;</span><span class="p">:</span> <span class="n">T</span><span class="p">[</span><span class="n">p</span><span class="p">],</span>
                <span class="s2">&quot;Mass_at_Peak&quot;</span><span class="p">:</span> <span class="n">M</span><span class="p">[</span><span class="n">p</span><span class="p">],</span>
                <span class="s2">&quot;Estimated_Mass_Loss&quot;</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">mass_loss</span><span class="p">)</span>
            <span class="p">})</span>

        <span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;TGA Curve&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="n">peaks</span><span class="p">],</span> <span class="n">M</span><span class="p">[</span><span class="n">peaks</span><span class="p">],</span> <span class="s2">&quot;ro&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Functionalization Steps&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;Temperature&quot;</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;Mass_at_Peak&quot;</span><span class="p">],</span>
                    <span class="sa">f</span><span class="s2">&quot;Step </span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;Step&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;Temperature&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> °C&quot;</span><span class="p">,</span>
                    <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Temperature (°C)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Mass (%)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Functionalization / Surface Modification Detection&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">results_df</span>


    <span class="c1"># --- Composition Application ---</span>
    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;composition&quot;</span><span class="p">:</span>
        <span class="n">initial_mass</span> <span class="o">=</span> <span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">final_mass</span> <span class="o">=</span> <span class="n">M</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># residue at high T</span>
        <span class="n">polymer_loss</span> <span class="o">=</span> <span class="n">initial_mass</span> <span class="o">-</span> <span class="n">final_mass</span>

        <span class="n">polymer_percent</span> <span class="o">=</span> <span class="p">(</span><span class="n">polymer_loss</span> <span class="o">/</span> <span class="n">initial_mass</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="n">filler_percent</span> <span class="o">=</span> <span class="p">(</span><span class="n">final_mass</span> <span class="o">/</span> <span class="n">initial_mass</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;TGA Curve&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">final_mass</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
                    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Residue ~ </span><span class="si">{</span><span class="n">final_mass</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Temperature (°C)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Mass (%)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Composition Estimation (Polymer vs Filler)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;Initial_Mass&quot;</span><span class="p">:</span> <span class="n">initial_mass</span><span class="p">,</span>
            <span class="s2">&quot;Final_Residue&quot;</span><span class="p">:</span> <span class="n">final_mass</span><span class="p">,</span>
            <span class="s2">&quot;Polymer_Content(%)&quot;</span><span class="p">:</span> <span class="n">polymer_percent</span><span class="p">,</span>
            <span class="s2">&quot;Filler_Content(%)&quot;</span><span class="p">:</span> <span class="n">filler_percent</span>
        <span class="p">}</span>
    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;DTG&quot;</span><span class="p">:</span>
        <span class="n">dM_dT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">dM_dT</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;DTG Curve (dM/dT)&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Temperature (°C)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;dM/dT (%/°C)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Derivative Thermogravimetry (DTG)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Temperature&quot;</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span> <span class="s2">&quot;dM/dT&quot;</span><span class="p">:</span> <span class="n">dM_dT</span><span class="p">})</span>
    
    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;decomposition_steps&quot;</span><span class="p">:</span>
        <span class="n">dM_dT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
    
    <span class="c1"># Detect peaks in DTG (negative peaks for weight loss)</span>
        <span class="n">peaks</span><span class="p">,</span> <span class="n">properties</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="o">-</span><span class="n">dM_dT</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
        
        <span class="c1"># Prepare DataFrame with decomposition info</span>
        <span class="n">decomposition_info</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
            <span class="s2">&quot;Step&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
            <span class="s2">&quot;Temperature&quot;</span><span class="p">:</span> <span class="n">T</span><span class="p">[</span><span class="n">peaks</span><span class="p">],</span>
            <span class="s2">&quot;Mass_at_Peak&quot;</span><span class="p">:</span> <span class="n">M</span><span class="p">[</span><span class="n">peaks</span><span class="p">],</span>
            <span class="s2">&quot;dM/dT&quot;</span><span class="p">:</span> <span class="n">dM_dT</span><span class="p">[</span><span class="n">peaks</span><span class="p">]</span>
        <span class="p">})</span>

        <span class="c1"># Plot TGA with DTG peaks highlighted</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;TGA Curve&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="n">peaks</span><span class="p">],</span> <span class="n">M</span><span class="p">[</span><span class="n">peaks</span><span class="p">],</span> <span class="s2">&quot;ro&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Decomposition Steps (DTG Peaks)&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">decomposition_info</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">Temperature</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">Mass_at_Peak</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;Step </span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">Step</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">Temperature</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> °C&quot;</span><span class="p">,</span>
                    <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Temperature (°C)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Mass (%)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Decomposition Steps Identified via DTG&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">decomposition_info</span>

    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;kinetics&quot;</span><span class="p">:</span>
        <span class="n">dM_dT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>

        <span class="c1"># Detect peaks in DTG</span>
        <span class="n">peaks</span><span class="p">,</span> <span class="n">properties</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="o">-</span><span class="n">dM_dT</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>

        <span class="c1"># Keep only peaks above 150 °C</span>
        <span class="n">peaks</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">peaks</span> <span class="k">if</span> <span class="n">T</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">150</span><span class="p">]</span>

        <span class="c1"># Quantify reaction rates (absolute value of dM/dT at peaks)</span>
        <span class="n">kinetics_info</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
            <span class="s2">&quot;Step&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
            <span class="s2">&quot;Temperature&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">T</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">peaks</span><span class="p">],</span>
            <span class="s2">&quot;Mass_at_Peak&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">M</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">peaks</span><span class="p">],</span>
            <span class="s2">&quot;Reaction_Rate_dM_dT&quot;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="n">dM_dT</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">peaks</span><span class="p">]</span>  <span class="c1"># positive values</span>
        <span class="p">})</span>

        <span class="c1"># Identify fastest decomposition (highest reaction rate)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">kinetics_info</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">fastest_idx</span> <span class="o">=</span> <span class="n">kinetics_info</span><span class="p">[</span><span class="s2">&quot;Reaction_Rate_dM_dT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
            <span class="n">fastest_step</span> <span class="o">=</span> <span class="n">kinetics_info</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">fastest_idx</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fastest_step</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Plot DTG with reaction rates</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">dM_dT</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;DTG Curve (dM/dT)&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="n">peaks</span><span class="p">],</span> <span class="n">dM_dT</span><span class="p">[</span><span class="n">peaks</span><span class="p">],</span> <span class="s2">&quot;ko&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Reaction Peaks&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">kinetics_info</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">Temperature</span><span class="p">,</span> <span class="n">dM_dT</span><span class="p">[</span><span class="n">T</span> <span class="o">==</span> <span class="n">r</span><span class="o">.</span><span class="n">Temperature</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> 
                    <span class="sa">f</span><span class="s2">&quot;Step </span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">Step</span><span class="si">}</span><span class="se">\n</span><span class="s2">Rate=</span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">Reaction_Rate_dM_dT</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fastest_step</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">fastest_step</span><span class="p">[</span><span class="s2">&quot;Temperature&quot;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
                        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Fastest Decomp: Step </span><span class="si">{</span><span class="n">fastest_step</span><span class="p">[</span><span class="s1">&#39;Step&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Temperature (°C)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;dM/dT (%/°C)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Reaction Rates / Thermal Degradation Kinetics (Above 150 °C)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;Kinetics_Info&quot;</span><span class="p">:</span> <span class="n">kinetics_info</span><span class="p">,</span>
            <span class="s2">&quot;Fastest_Decomposition&quot;</span><span class="p">:</span> <span class="n">fastest_step</span>
        <span class="p">}</span>


    <span class="c1"># --- Catalytic Effect Application ---</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;elif application == &quot;catalysis&quot;:</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        Studying catalytic effects of nanoparticles on degradation.</span>
<span class="sd">        Requires DTG analysis to identify accelerated degradation steps.</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        # Compute DTG</span>
<span class="sd">        dM_dT = np.gradient(M, T)</span>

<span class="sd">        # Detect DTG peaks</span>
<span class="sd">        peaks, properties = find_peaks(-dM_dT, prominence=0.01)</span>

<span class="sd">        # Prepare DataFrame with catalytic info</span>
<span class="sd">        catalysis_info = pd.DataFrame({</span>
<span class="sd">            &quot;Step&quot;: np.arange(1, len(peaks)+1),</span>
<span class="sd">            &quot;Temperature&quot;: T[peaks],</span>
<span class="sd">            &quot;Mass_at_Peak&quot;: M[peaks],</span>
<span class="sd">            &quot;Rate_dM_dT&quot;: -dM_dT[peaks]  # positive rate</span>
<span class="sd">        })</span>

<span class="sd">        # Plot DTG curve highlighting catalytic effects</span>
<span class="sd">        plt.figure(figsize=(8,5))</span>
<span class="sd">        plt.plot(T, dM_dT, label=&quot;DTG Curve (dM/dT)&quot;, color=&quot;red&quot;)</span>
<span class="sd">        plt.plot(T[peaks], dM_dT[peaks], &quot;ko&quot;, label=&quot;Catalytic Degradation Steps&quot;)</span>
<span class="sd">        for r in catalysis_info.itertuples():</span>
<span class="sd">            plt.text(r.Temperature, r.Rate_dM_dT,</span>
<span class="sd">                    f&quot;Step {r.Step}\nRate={r.Rate_dM_dT:.3f}&quot;,</span>
<span class="sd">                    fontsize=8, ha=&quot;center&quot;, va=&quot;bottom&quot;)</span>
<span class="sd">        plt.xlabel(&quot;Temperature (°C)&quot;)</span>
<span class="sd">        plt.ylabel(&quot;dM/dT (%/°C)&quot;)</span>
<span class="sd">        plt.title(&quot;Catalytic Effects of Nanoparticles on Degradation&quot;)</span>
<span class="sd">        plt.grid(True, linestyle=&quot;--&quot;, alpha=0.6)</span>
<span class="sd">        plt.legend()</span>
<span class="sd">        plt.show()</span>

<span class="sd">        return catalysis_info</span>
<span class="sd">    else:</span>
<span class="sd">        raise ValueError(f&quot;Application &#39;{application}&#39; not recognized.&quot;)&#39;&#39;&#39;</span>

<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;elif application == &quot;oxidation&quot;:</span>
<span class="sd">        if data_inert is None:</span>
<span class="sd">            raise ValueError(&quot;For &#39;oxidation&#39;, you must provide &#39;data_inert&#39; (TGA under inert gas).&quot;)</span>
<span class="sd">        if &quot;Temp&quot; not in data_inert.columns or &quot;Mass&quot; not in data_inert.columns:</span>
<span class="sd">            raise ValueError(&quot;&#39;data_inert&#39; must contain &#39;Temp&#39; and &#39;Mass&#39; columns.&quot;)</span>

<span class="sd">        T_inert = data_inert[&quot;Temp&quot;].values</span>
<span class="sd">        M_inert = data_inert[&quot;Mass&quot;].values</span>

<span class="sd">        # Interpolate if temperature points do not match</span>
<span class="sd">        M_inert_interp = np.interp(T, T_inert, M_inert)</span>

<span class="sd">        # Mass difference</span>
<span class="sd">        mass_diff = M - M_inert_interp</span>

<span class="sd">        plt.figure(figsize=(8,5))</span>
<span class="sd">        plt.plot(T, M, label=&quot;Oxygen (Oxidative)&quot;, color=&quot;red&quot;)</span>
<span class="sd">        plt.plot(T, M_inert_interp, label=&quot;Inert (N2/Ar)&quot;, color=&quot;blue&quot;)</span>
<span class="sd">        plt.fill_between(T, M_inert_interp, M, color=&quot;orange&quot;, alpha=0.3, label=&quot;Oxidation Loss&quot;)</span>
<span class="sd">        plt.xlabel(&quot;Temperature (°C)&quot;)</span>
<span class="sd">        plt.ylabel(&quot;Mass (%)&quot;)</span>
<span class="sd">        plt.title(&quot;Oxidation Resistance of Nanomaterial&quot;)</span>
<span class="sd">        plt.grid(True, linestyle=&quot;--&quot;, alpha=0.6)</span>
<span class="sd">        plt.legend()</span>
<span class="sd">        plt.show()</span>

<span class="sd">        # Onset of oxidation: first point where M &lt; M_inert - threshold</span>
<span class="sd">        threshold = 0.5  # % mass loss to define onset</span>
<span class="sd">        idx = np.where(M &lt; M_inert_interp - threshold)[0]</span>
<span class="sd">        if len(idx) &gt; 0:</span>
<span class="sd">            onset_temp = T[idx[0]]</span>
<span class="sd">        else:</span>
<span class="sd">            onset_temp = None</span>

<span class="sd">        return {</span>
<span class="sd">            &quot;Onset_of_Oxidation_Temperature&quot;: onset_temp,</span>
<span class="sd">            &quot;Mass_Difference_Oxygen_vs_Inert&quot;: mass_diff</span>
<span class="sd">        }</span>

<span class="sd">    else:</span>
<span class="sd">        raise ValueError(f&quot;Application &#39;{application}&#39; not recognized.&quot;)&quot;&quot;&quot;</span></div>

    <span class="c1"># --- DTG Application ---</span>
    



<div class="viewcode-block" id="UV_Visible_Analysis">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.UV_Visible_Analysis">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">UV_Visible_Analysis</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">application</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform multi-mode UV–Visible Spectroscopy analysis for optical and electronic characterization.</span>

<span class="sd">    This function provides tools for analyzing UV–Vis absorbance spectra, including</span>
<span class="sd">    visualization, Beer–Lambert law concentration estimation, peak identification,</span>
<span class="sd">    Landau maximum detection, and Tauc plot-based band gap estimation.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : pandas.DataFrame or dict</span>
<span class="sd">        Experimental UV–Vis dataset containing the columns:</span>
<span class="sd">        - &#39;Wavelength&#39; : float</span>
<span class="sd">            Wavelength values in nanometers (nm)</span>
<span class="sd">        - &#39;Absorbance&#39; : float</span>
<span class="sd">            Measured absorbance at each wavelength</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; data = pd.DataFrame({</span>
<span class="sd">        ...     &quot;Wavelength&quot;: [200, 250, 300, 350],</span>
<span class="sd">        ...     &quot;Absorbance&quot;: [0.2, 0.8, 1.1, 0.4]</span>
<span class="sd">        ... })</span>

<span class="sd">    application : str</span>
<span class="sd">        Defines the analysis mode. Supported applications:</span>

<span class="sd">        - `&quot;plot&quot;` :</span>
<span class="sd">            Plot the UV–Vis spectrum (Absorbance vs. Wavelength).</span>

<span class="sd">        - `&quot;beer_lambert&quot;` :</span>
<span class="sd">            Apply Beer–Lambert law to calculate molar concentration:</span>
<span class="sd">            A = ε × l × c, where:</span>
<span class="sd">            ε = molar extinction coefficient,</span>
<span class="sd">            l = optical path length (cm),</span>
<span class="sd">            c = concentration (M).</span>

<span class="sd">            Required keyword arguments:</span>
<span class="sd">            - `molar_extinction_coefficient` : float</span>
<span class="sd">            - `path_length` : float, optional (default=1.0)</span>

<span class="sd">        - `&quot;peak_detection&quot;` or `&quot;identify_peaks&quot;` :</span>
<span class="sd">            Detect spectral peaks using `scipy.signal.find_peaks`.</span>
<span class="sd">            Optional keyword arguments:</span>
<span class="sd">            - `height` : float, threshold for peak height.</span>
<span class="sd">            - `distance` : int, minimum number of points between peaks.</span>

<span class="sd">        - `&quot;band_gap&quot;` :</span>
<span class="sd">            Generate a Tauc plot for optical band gap determination.</span>
<span class="sd">            Uses the relation (αhν)^n vs. hν, where n = 0.5 for direct</span>
<span class="sd">            and n = 2 for indirect transitions.</span>

<span class="sd">            Keyword arguments:</span>
<span class="sd">            - `n` : float, exponent type (default=0.5)</span>

<span class="sd">        - `&quot;landau_max&quot;` :</span>
<span class="sd">            Identify the wavelength corresponding to maximum absorbance</span>
<span class="sd">            (Landau maximum). If Beer–Lambert parameters are provided,</span>
<span class="sd">            the function estimates the sample concentration at that point.</span>

<span class="sd">            Optional keyword arguments:</span>
<span class="sd">            - `molar_extinction_coefficient` : float</span>
<span class="sd">            - `path_length` : float, optional (default=1.0)</span>

<span class="sd">    Keyword Arguments</span>
<span class="sd">    -----------------</span>
<span class="sd">    molar_extinction_coefficient : float, optional</span>
<span class="sd">        Required for Beer–Lambert law or Landau Max concentration estimation.</span>
<span class="sd">    path_length : float, default=1.0</span>
<span class="sd">        Optical path length of the cuvette (in cm).</span>
<span class="sd">    height : float, optional</span>
<span class="sd">        Minimum absorbance for peak detection.</span>
<span class="sd">    distance : int, optional</span>
<span class="sd">        Minimum distance between adjacent detected peaks.</span>
<span class="sd">    n : float, default=0.5</span>
<span class="sd">        Exponent in the Tauc plot for direct/indirect band gap transitions.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    object</span>
<span class="sd">        Depends on the analysis mode:</span>

<span class="sd">        - `&quot;plot&quot;` :</span>
<span class="sd">            Displays spectrum; returns `None`.</span>
<span class="sd">        - `&quot;beer_lambert&quot;` :</span>
<span class="sd">            pandas.DataFrame with calculated concentration values.</span>
<span class="sd">        - `&quot;peak_detection&quot;` / `&quot;identify_peaks&quot;` :</span>
<span class="sd">            pandas.DataFrame listing detected peak wavelengths and absorbances.</span>
<span class="sd">        - `&quot;band_gap&quot;` :</span>
<span class="sd">            pandas.DataFrame with photon energy and Tauc Y-values.</span>
<span class="sd">        - `&quot;landau_max&quot;` :</span>
<span class="sd">            dict with wavelength, absorbance, and (if applicable) concentration.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If input format or application type is invalid.</span>
<span class="sd">    KeyError</span>
<span class="sd">        If required columns (&#39;Wavelength&#39;, &#39;Absorbance&#39;) are missing.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - Band gap energy (Eg) is estimated by extrapolating the linear portion</span>
<span class="sd">      of the Tauc plot to the energy axis.</span>
<span class="sd">    - The Landau maximum provides insights into π–π* or n–π* transitions.</span>
<span class="sd">    - Beer–Lambert analysis assumes linearity in the absorbance–concentration range.</span>
<span class="sd">    - Wavelengths must be sorted in ascending order for accurate results.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; data = pd.DataFrame({</span>
<span class="sd">    ...     &quot;Wavelength&quot;: np.linspace(200, 800, 300),</span>
<span class="sd">    ...     &quot;Absorbance&quot;: np.exp(-((np.linspace(200, 800, 300) - 400) / 50)**2)</span>
<span class="sd">    ... })</span>
<span class="sd">    &gt;&gt;&gt; UV_Visible_Analysis(data, &quot;plot&quot;)</span>
<span class="sd">    # Displays the UV–Vis spectrum.</span>

<span class="sd">    &gt;&gt;&gt; UV_Visible_Analysis(data, &quot;peak_detection&quot;, height=0.2)</span>
<span class="sd">    # Detects and highlights spectral peaks.</span>

<span class="sd">    &gt;&gt;&gt; UV_Visible_Analysis(data, &quot;beer_lambert&quot;,</span>
<span class="sd">    ...     molar_extinction_coefficient=15000, path_length=1.0)</span>
<span class="sd">    # Computes sample concentration using Beer–Lambert law.</span>

<span class="sd">    &gt;&gt;&gt; UV_Visible_Analysis(data, &quot;band_gap&quot;, n=0.5)</span>
<span class="sd">    # Displays the Tauc plot for band gap estimation.</span>

<span class="sd">    &gt;&gt;&gt; UV_Visible_Analysis(data, &quot;landau_max&quot;,</span>
<span class="sd">    ...     molar_extinction_coefficient=20000, path_length=1.0)</span>
<span class="sd">    # Identifies Landau maximum and estimates concentration.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Convert to DataFrame</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Data must be a pandas DataFrame or dict with keys &#39;Wavelength&#39; and &#39;Absorbance&#39;&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="s1">&#39;Wavelength&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">or</span> <span class="s1">&#39;Absorbance&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Data must have &#39;Wavelength&#39; and &#39;Absorbance&#39; columns&quot;</span><span class="p">)</span>
    
    <span class="c1"># ---------------- PLOTTING ----------------</span>
    <span class="k">if</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;plot&quot;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Absorbance&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;UV-Vis Spectrum&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Wavelength (nm)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Absorbance&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="c1"># ---------------- BEER-LAMBERT ----------------</span>
    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;beer_lambert&quot;</span><span class="p">:</span>
        <span class="n">epsilon</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;molar_extinction_coefficient&#39;</span><span class="p">)</span>
        <span class="n">path_length</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;path_length&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">epsilon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;For Beer–Lambert calculation, provide &#39;molar_extinction_coefficient&#39;.&quot;</span><span class="p">)</span>
        
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Concentration (M)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Absorbance&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">epsilon</span> <span class="o">*</span> <span class="n">path_length</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calculated concentrations (M):&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">,</span> <span class="s1">&#39;Absorbance&#39;</span><span class="p">,</span> <span class="s1">&#39;Concentration (M)&#39;</span><span class="p">]])</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Concentration (M)&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Absorbance&#39;</span><span class="p">],</span> <span class="s2">&quot;bo-&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Absorbance vs Concentration&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Concentration (M)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Absorbance&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">df</span>
    
    <span class="c1"># ---------------- PEAK DETECTION / IDENTIFY ----------------</span>
    <span class="k">elif</span> <span class="n">application</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;peak_detection&quot;</span><span class="p">,</span> <span class="s2">&quot;identify_peaks&quot;</span><span class="p">]:</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;distance&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        
        <span class="n">peaks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Absorbance&#39;</span><span class="p">],</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="n">distance</span><span class="p">)</span>
        <span class="n">peak_wavelengths</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">peaks</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">peak_absorbances</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Absorbance&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">peaks</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Detected peaks (Wavelength, Absorbance):&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">wl</span><span class="p">,</span> <span class="n">ab</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">peak_wavelengths</span><span class="p">,</span> <span class="n">peak_absorbances</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">wl</span><span class="si">}</span><span class="s2"> nm : </span><span class="si">{</span><span class="n">ab</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Absorbance&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">peak_wavelengths</span><span class="p">,</span> <span class="n">peak_absorbances</span><span class="p">,</span> <span class="s2">&quot;rx&quot;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Detected Peaks&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;UV-Vis Spectrum with Detected Peaks&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Wavelength (nm)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Absorbance&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Wavelength&quot;</span><span class="p">:</span> <span class="n">peak_wavelengths</span><span class="p">,</span> <span class="s2">&quot;Absorbance&quot;</span><span class="p">:</span> <span class="n">peak_absorbances</span><span class="p">})</span>
    
    <span class="c1"># ---------------- BAND GAP ----------------</span>
    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;band_gap&quot;</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>  <span class="c1"># 0.5 for direct, 2 for indirect</span>
        <span class="c1"># Convert wavelength (nm) to photon energy (eV)</span>
        <span class="n">hv</span> <span class="o">=</span> <span class="mi">1240</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>  <span class="c1"># eV</span>
        <span class="c1"># Tauc plot y-axis</span>
        <span class="n">tauc_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Absorbance&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">hv</span><span class="p">)</span> <span class="o">**</span> <span class="n">n</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hv</span><span class="p">,</span> <span class="n">tauc_y</span><span class="p">,</span> <span class="s2">&quot;bo-&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Tauc Plot for Band Gap Determination&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Photon Energy (eV)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;(Absorbance × hν)^n&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Use the linear region in the plot to extrapolate x-axis to determine band gap energy Eg (eV).&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Photon Energy (eV)&quot;</span><span class="p">:</span> <span class="n">hv</span><span class="p">,</span> <span class="s2">&quot;Tauc Y&quot;</span><span class="p">:</span> <span class="n">tauc_y</span><span class="p">})</span>
    
    <span class="c1"># ---------------- LANDAU MAX ----------------</span>
    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;landau_max&quot;</span><span class="p">:</span>
        <span class="c1"># Find max absorbance</span>
        <span class="n">idx_max</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Absorbance&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
        <span class="n">max_wavelength</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx_max</span><span class="p">,</span> <span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>
        <span class="n">max_absorbance</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx_max</span><span class="p">,</span> <span class="s1">&#39;Absorbance&#39;</span><span class="p">]</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Landau Max: </span><span class="si">{</span><span class="n">max_wavelength</span><span class="si">}</span><span class="s2"> nm with Absorbance </span><span class="si">{</span><span class="n">max_absorbance</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="n">epsilon</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;molar_extinction_coefficient&#39;</span><span class="p">)</span>
        <span class="n">path_length</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;path_length&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">concentration</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">epsilon</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">concentration</span> <span class="o">=</span> <span class="n">max_absorbance</span> <span class="o">/</span> <span class="p">(</span><span class="n">epsilon</span> <span class="o">*</span> <span class="n">path_length</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Estimated concentration at Landau Max using Beer–Lambert Law: </span><span class="si">{</span><span class="n">concentration</span><span class="si">}</span><span class="s2"> M&quot;</span><span class="p">)</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Absorbance&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">max_wavelength</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Landau Max: </span><span class="si">{</span><span class="n">max_wavelength</span><span class="si">}</span><span class="s2"> nm&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">max_wavelength</span><span class="p">],</span> <span class="p">[</span><span class="n">max_absorbance</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;UV-Vis Spectrum with Landau Max&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Wavelength (nm)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Absorbance&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;Wavelength (nm)&quot;</span><span class="p">:</span> <span class="n">max_wavelength</span><span class="p">,</span> <span class="s2">&quot;Absorbance&quot;</span><span class="p">:</span> <span class="n">max_absorbance</span><span class="p">,</span> <span class="s2">&quot;Concentration (M)&quot;</span><span class="p">:</span> <span class="n">concentration</span><span class="p">}</span>
    
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Application &#39;</span><span class="si">{</span><span class="n">application</span><span class="si">}</span><span class="s2">&#39; not implemented yet.&quot;</span><span class="p">)</span></div>




<div class="viewcode-block" id="CV">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.CV">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">CV</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">application</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform Cyclic Voltammetry (CV) data analysis for electrochemical characterization.</span>

<span class="sd">    This function provides core analytical and visualization tools for cyclic</span>
<span class="sd">    voltammetry experiments, including voltammogram plotting, oxidation/reduction</span>
<span class="sd">    peak detection, and peak shape analysis for assessing reversibility of redox</span>
<span class="sd">    processes.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : list of tuples, list of lists, or pandas.DataFrame</span>
<span class="sd">        Experimental CV dataset containing the following columns or structure:</span>
<span class="sd">        - &#39;E&#39; : float</span>
<span class="sd">            Applied potential (V vs. reference electrode)</span>
<span class="sd">        - &#39;I&#39; : float</span>
<span class="sd">            Measured current (A)</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; data = pd.DataFrame({</span>
<span class="sd">        ...     &quot;E&quot;: [-0.5, -0.3, 0.0, 0.3, 0.5],</span>
<span class="sd">        ...     &quot;I&quot;: [-0.0001, 0.0003, 0.0012, 0.0005, -0.0002]</span>
<span class="sd">        ... })</span>

<span class="sd">    application : str</span>
<span class="sd">        Defines the analysis type. Supported options include:</span>

<span class="sd">        - `&quot;plot&quot;` :</span>
<span class="sd">            Display the cyclic voltammogram (current vs. potential).</span>

<span class="sd">        - `&quot;peaks&quot;` :</span>
<span class="sd">            Detect and highlight oxidation and reduction peaks using</span>
<span class="sd">            `scipy.signal.find_peaks` with a default prominence of 0.001 A.</span>
<span class="sd">            The function identifies the most intense oxidation peak and</span>
<span class="sd">            up to two reduction peaks.</span>

<span class="sd">        - `&quot;shape&quot;` :</span>
<span class="sd">            Analyze the shape and symmetry of oxidation/reduction peaks to</span>
<span class="sd">            determine the reversibility of the redox process.</span>
<span class="sd">            It computes:</span>
<span class="sd">                - E_pa : anodic (oxidation) peak potential (V)</span>
<span class="sd">                - E_pc : cathodic (reduction) peak potential (V)</span>
<span class="sd">                - ΔE_p : peak separation (V)</span>
<span class="sd">                - |I_pc/I_pa| : peak current ratio</span>

<span class="sd">            Based on electrochemical theory:</span>
<span class="sd">            - Reversible systems exhibit ΔE_p ≈ 59 mV/n (for one-electron transfer)</span>
<span class="sd">              and |I_pc/I_pa| ≈ 1.</span>
<span class="sd">            - Quasi-reversible systems show moderate deviations.</span>
<span class="sd">            - Irreversible systems display large separations and asymmetric peaks.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">        The function primarily displays visualizations and prints analysis</span>
<span class="sd">        results directly to the console.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    TypeError</span>
<span class="sd">        If the input data format is invalid.</span>
<span class="sd">    ValueError</span>
<span class="sd">        If the specified application is not supported.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - Ensure that potentials (E) are in ascending or cyclic order for</span>
<span class="sd">      accurate peak detection.</span>
<span class="sd">    - Peak prominence and smoothing parameters can be tuned for noisy data.</span>
<span class="sd">    - The reversibility classification is heuristic and assumes one-electron</span>
<span class="sd">      transfer unless otherwise known.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; data = pd.DataFrame({</span>
<span class="sd">    ...     &quot;E&quot;: np.linspace(-0.5, 0.5, 200),</span>
<span class="sd">    ...     &quot;I&quot;: 0.001 * np.sin(4 * np.pi * np.linspace(-0.5, 0.5, 200))</span>
<span class="sd">    ... })</span>
<span class="sd">    &gt;&gt;&gt; CV(data, &quot;plot&quot;)</span>
<span class="sd">    # Displays the cyclic voltammogram.</span>

<span class="sd">    &gt;&gt;&gt; CV(data, &quot;peaks&quot;)</span>
<span class="sd">    # Detects and highlights oxidation/reduction peaks.</span>

<span class="sd">    &gt;&gt;&gt; CV(data, &quot;shape&quot;)</span>
<span class="sd">    # Computes ΔEp and |Ipc/Ipa| to infer redox reversibility.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Convert list input to DataFrame for consistency</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">])</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Data must be a list of (E,I) pairs or a pandas DataFrame.&quot;</span><span class="p">)</span>
    
    <span class="n">E</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;E&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">I</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;I&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    
    <span class="c1"># -------------------------------</span>
    <span class="c1"># Application 1: Simple CV plot</span>
    <span class="c1"># -------------------------------</span>
    <span class="k">if</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;plot&quot;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Potential (V vs Ref)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Current (A)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Cyclic Voltammogram&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="c1"># -------------------------------</span>
    <span class="c1"># Application 2: Peak detection</span>
    <span class="c1"># -------------------------------</span>
    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;peaks&quot;</span><span class="p">:</span>
        <span class="c1"># Oxidation peaks = local maxima</span>
        <span class="n">ox_peaks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>
        <span class="c1"># Reduction peaks = local minima</span>
        <span class="n">red_peaks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="o">-</span><span class="n">I</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>

        <span class="c1"># --- Select strongest peaks ---</span>
        <span class="c1"># Keep the highest oxidation peak (max current)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ox_peaks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ox_peaks</span> <span class="o">=</span> <span class="p">[</span><span class="n">ox_peaks</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">I</span><span class="p">[</span><span class="n">ox_peaks</span><span class="p">])]]</span>

        <span class="c1"># Keep the two most negative reduction peaks (lowest currents)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">red_peaks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">red_peaks</span> <span class="o">=</span> <span class="n">red_peaks</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">I</span><span class="p">[</span><span class="n">red_peaks</span><span class="p">])[:</span><span class="mi">2</span><span class="p">]]</span>

        <span class="c1"># --- Plot ---</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;CV curve&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="n">ox_peaks</span><span class="p">],</span> <span class="n">I</span><span class="p">[</span><span class="n">ox_peaks</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Oxidation peak&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="n">red_peaks</span><span class="p">],</span> <span class="n">I</span><span class="p">[</span><span class="n">red_peaks</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Reduction peaks&quot;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Potential (V vs Ref)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Current (A)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Cyclic Voltammetry with Selected Peaks&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="c1"># --- Print results ---</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Oxidation peak (Potential, Current):&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">e</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="n">ox_peaks</span><span class="p">],</span> <span class="n">I</span><span class="p">[</span><span class="n">ox_peaks</span><span class="p">]):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">e</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> V, </span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2"> A&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Reduction peaks (Potential, Current):&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">e</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="n">red_peaks</span><span class="p">],</span> <span class="n">I</span><span class="p">[</span><span class="n">red_peaks</span><span class="p">]):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">e</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> V, </span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2"> A&quot;</span><span class="p">)</span>
    
    <span class="c1"># -------------------------------</span>
    <span class="c1"># Application 3: Shape analysis</span>
    <span class="c1"># -------------------------------</span>
    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;shape&quot;</span><span class="p">:</span>
        <span class="n">ox_peaks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>
        <span class="n">red_peaks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="o">-</span><span class="n">I</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;CV curve&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="n">ox_peaks</span><span class="p">],</span> <span class="n">I</span><span class="p">[</span><span class="n">ox_peaks</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Oxidation peaks&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="n">red_peaks</span><span class="p">],</span> <span class="n">I</span><span class="p">[</span><span class="n">red_peaks</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Reduction peaks&quot;</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">e</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="n">ox_peaks</span><span class="p">],</span> <span class="n">I</span><span class="p">[</span><span class="n">ox_peaks</span><span class="p">]):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">V&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">i</span><span class="p">),</span> <span class="n">textcoords</span><span class="o">=</span><span class="s2">&quot;offset points&quot;</span><span class="p">,</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">e</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="n">red_peaks</span><span class="p">],</span> <span class="n">I</span><span class="p">[</span><span class="n">red_peaks</span><span class="p">]):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">V&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">i</span><span class="p">),</span> <span class="n">textcoords</span><span class="o">=</span><span class="s2">&quot;offset points&quot;</span><span class="p">,</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">15</span><span class="p">),</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Potential (V vs Ref)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Current (A)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Cyclic Voltammetry: Shape of Peaks (Reversibility)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Shape / Reversibility Analysis ---&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ox_peaks</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">red_peaks</span><span class="p">))):</span>
            <span class="n">E_pa</span><span class="p">,</span> <span class="n">I_pa</span> <span class="o">=</span> <span class="n">E</span><span class="p">[</span><span class="n">ox_peaks</span><span class="p">[</span><span class="n">idx</span><span class="p">]],</span> <span class="n">I</span><span class="p">[</span><span class="n">ox_peaks</span><span class="p">[</span><span class="n">idx</span><span class="p">]]</span>
            <span class="n">E_pc</span><span class="p">,</span> <span class="n">I_pc</span> <span class="o">=</span> <span class="n">E</span><span class="p">[</span><span class="n">red_peaks</span><span class="p">[</span><span class="n">idx</span><span class="p">]],</span> <span class="n">I</span><span class="p">[</span><span class="n">red_peaks</span><span class="p">[</span><span class="n">idx</span><span class="p">]]</span>
            
            <span class="n">delta_Ep</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">E_pc</span> <span class="o">-</span> <span class="n">E_pa</span><span class="p">)</span>
            <span class="n">current_ratio</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">I_pc</span><span class="p">)</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">I_pa</span><span class="p">)</span> <span class="k">if</span> <span class="n">I_pa</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Pair </span><span class="si">{</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  E_pa = </span><span class="si">{</span><span class="n">E_pa</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> V, I_pa = </span><span class="si">{</span><span class="n">I_pa</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2"> A&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  E_pc = </span><span class="si">{</span><span class="n">E_pc</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> V, I_pc = </span><span class="si">{</span><span class="n">I_pc</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2"> A&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ΔEp = </span><span class="si">{</span><span class="n">delta_Ep</span><span class="o">*</span><span class="mi">1000</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> mV&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  |Ipc/Ipa| = </span><span class="si">{</span><span class="n">current_ratio</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            
            <span class="c1"># Classification</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">delta_Ep</span> <span class="o">-</span> <span class="mf">0.0592</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.02</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">current_ratio</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.2</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  → Likely REVERSIBLE (mirror-like peaks, fast electron transfer)&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">delta_Ep</span> <span class="o">&lt;</span> <span class="mf">0.2</span> <span class="ow">and</span> <span class="mf">0.5</span> <span class="o">&lt;</span> <span class="n">current_ratio</span> <span class="o">&lt;</span> <span class="mf">1.5</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  → Likely QUASI-REVERSIBLE (moderate electron transfer)&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  → Likely IRREVERSIBLE (asymmetric peaks, slow transfer or side reactions)&quot;</span><span class="p">)</span>
    
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown application: </span><span class="si">{</span><span class="n">application</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>





<div class="viewcode-block" id="SAXS_Analysis">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.SAXS_Analysis">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">SAXS_Analysis</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">application</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform Small-Angle X-ray Scattering (SAXS) data analysis for nanostructural characterization.</span>

<span class="sd">    This function provides key analytical tools to extract structural information</span>
<span class="sd">    from SAXS profiles, including visualization, peak position detection, intensity</span>
<span class="sd">    integration, peak width (FWHM) determination, and Guinier (radius of gyration) analysis.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : pandas.DataFrame</span>
<span class="sd">        Experimental SAXS dataset containing:</span>
<span class="sd">        - &#39;q&#39; : float</span>
<span class="sd">            Scattering vector magnitude (1/nm)</span>
<span class="sd">        - &#39;I&#39; : float</span>
<span class="sd">            Scattered intensity I(q)</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; data = pd.DataFrame({</span>
<span class="sd">        ...     &quot;q&quot;: [0.01, 0.02, 0.03, 0.04],</span>
<span class="sd">        ...     &quot;I&quot;: [300, 800, 400, 200]</span>
<span class="sd">        ... })</span>

<span class="sd">    application : str</span>
<span class="sd">        Defines the type of analysis to perform. Supported options include:</span>

<span class="sd">        - `&quot;plot&quot;` :</span>
<span class="sd">            Plot I(q) vs. q to visualize the SAXS curve and scattering profile.</span>

<span class="sd">        - `&quot;peak_position&quot;` :</span>
<span class="sd">            Identify the q position of the main scattering peak and calculate</span>
<span class="sd">            the corresponding real-space characteristic spacing:</span>
<span class="sd">            d = 2π / q_peak</span>

<span class="sd">        - `&quot;peak_intensity&quot;` :</span>
<span class="sd">            Quantify the intensity and integrated area under the most intense</span>
<span class="sd">            scattering peak using numerical integration (`numpy.trapz`).</span>

<span class="sd">        - `&quot;peak_width&quot;` :</span>
<span class="sd">            Compute the full width at half maximum (FWHM) of the main scattering</span>
<span class="sd">            peak, which provides information about domain size and order distribution.</span>

<span class="sd">        - `&quot;rog&quot;` :</span>
<span class="sd">            Perform Guinier analysis (low-q region) by linear fitting of</span>
<span class="sd">            ln I(q) vs. q² to estimate the radius of gyration (Rg) and I(0):</span>
<span class="sd">                ln I(q) = ln I(0) − (Rg² * q²) / 3</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple or None</span>
<span class="sd">        Depending on the analysis:</span>
<span class="sd">        - `&quot;peak_position&quot;` → (q_peak, d_spacing)</span>
<span class="sd">        - `&quot;peak_intensity&quot;` → (I_peak, area)</span>
<span class="sd">        - `&quot;peak_width&quot;` → FWHM</span>
<span class="sd">        - `&quot;rog&quot;` → (Rg, I0)</span>
<span class="sd">        - `&quot;plot&quot;` → None</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    TypeError</span>
<span class="sd">        If the input data is not a pandas DataFrame or lacks required columns.</span>
<span class="sd">    ValueError</span>
<span class="sd">        If the specified application is not supported or no peaks are detected.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - q is defined as q = (4π/λ) sin(θ), where θ is half the scattering angle.</span>
<span class="sd">    - The characteristic spacing (d) corresponds to periodicity or average</span>
<span class="sd">      interparticle distance.</span>
<span class="sd">    - FWHM can be used to estimate crystalline order (via Scherrer-like relations).</span>
<span class="sd">    - The Guinier approximation is valid only for q·Rg &lt; 1.3.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; SAXS_Analysis(data, &quot;plot&quot;)</span>
<span class="sd">    # Displays the SAXS intensity profile.</span>

<span class="sd">    &gt;&gt;&gt; SAXS_Analysis(data, &quot;peak_position&quot;)</span>
<span class="sd">    # Prints and plots q_peak and corresponding d-spacing.</span>

<span class="sd">    &gt;&gt;&gt; SAXS_Analysis(data, &quot;peak_intensity&quot;)</span>
<span class="sd">    # Calculates peak height and integrated scattering area.</span>

<span class="sd">    &gt;&gt;&gt; SAXS_Analysis(data, &quot;peak_width&quot;)</span>
<span class="sd">    # Determines full width at half maximum (FWHM) in q-space.</span>

<span class="sd">    &gt;&gt;&gt; SAXS_Analysis(data, &quot;rog&quot;)</span>
<span class="sd">    # Performs Guinier analysis to estimate radius of gyration (Rg).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;plot&quot;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">],</span> <span class="s1">&#39;o-&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;SAXS Data&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;q (1/nm)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Intensity I(q)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;SAXS Curve&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="c1">#plt.xlim(0, 0.08)</span>
        <span class="c1">#plt.ylim(0, 4000)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;peak_position&quot;</span><span class="p">:</span>
        <span class="n">idx_max</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
        <span class="n">q_peak</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx_max</span><span class="p">,</span> <span class="s1">&#39;q&#39;</span><span class="p">]</span>
        <span class="n">I_peak</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx_max</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">]</span>
        <span class="n">d_spacing</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">q_peak</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;q_peak = </span><span class="si">{</span><span class="n">q_peak</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> 1/nm (I = </span><span class="si">{</span><span class="n">I_peak</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Characteristic spacing d = </span><span class="si">{</span><span class="n">d_spacing</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> nm&quot;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">],</span> <span class="s1">&#39;o-&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;SAXS Data&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">q_peak</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;q_peak = </span><span class="si">{</span><span class="n">q_peak</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">q_peak</span><span class="p">,</span> <span class="n">I_peak</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;d = </span><span class="si">{</span><span class="n">d_spacing</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> nm&quot;</span><span class="p">,</span> 
                 <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;q (1/nm)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Intensity I(q)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;SAXS Peak Position and Spacing&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="c1">#plt.xlim(0, 0.08)</span>
        <span class="c1">#plt.ylim(0, 4000)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">q_peak</span><span class="p">,</span> <span class="n">d_spacing</span>

    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;peak_intensity&quot;</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">scipy.signal</span><span class="w"> </span><span class="kn">import</span> <span class="n">find_peaks</span><span class="p">,</span> <span class="n">peak_widths</span>

        <span class="c1"># Find peaks</span>
        <span class="n">peaks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;⚠️ No peaks found.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

        <span class="c1"># Select the highest peak</span>
        <span class="n">idx_max</span> <span class="o">=</span> <span class="n">peaks</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">peaks</span><span class="p">])]</span>
        <span class="n">q_peak</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx_max</span><span class="p">,</span> <span class="s1">&#39;q&#39;</span><span class="p">]</span>
        <span class="n">I_peak</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx_max</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">]</span>

        <span class="c1"># Get peak width at half max</span>
        <span class="n">results_half</span> <span class="o">=</span> <span class="n">peak_widths</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">idx_max</span><span class="p">],</span> <span class="n">rel_height</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">left_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">results_half</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">right_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">results_half</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># Slice the region under the peak</span>
        <span class="n">q_region</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">left_idx</span><span class="p">:</span><span class="n">right_idx</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">I_region</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">left_idx</span><span class="p">:</span><span class="n">right_idx</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Integrate under the peak</span>
        <span class="n">area</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">I_region</span><span class="p">,</span> <span class="n">q_region</span><span class="p">)</span>

        <span class="c1"># Print results</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Peak height (I_peak) = </span><span class="si">{</span><span class="n">I_peak</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Integrated area under peak = </span><span class="si">{</span><span class="n">area</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Plot with shaded peak region</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">],</span> <span class="s1">&#39;o-&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;SAXS Data&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">q_region</span><span class="p">,</span> <span class="n">I_region</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Peak area&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">q_peak</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;q_peak = </span><span class="si">{</span><span class="n">q_peak</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">q_peak</span><span class="p">,</span> <span class="n">I_peak</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">q_peak</span><span class="p">,</span> <span class="n">I_peak</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Peak = </span><span class="si">{</span><span class="n">I_peak</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;q (1/nm)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Intensity I(q)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;SAXS Peak Intensity&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">I_peak</span><span class="p">,</span> <span class="n">area</span>

    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;peak_width&quot;</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">scipy.signal</span><span class="w"> </span><span class="kn">import</span> <span class="n">find_peaks</span><span class="p">,</span> <span class="n">peak_widths</span>
        <span class="c1"># --- Find all peaks ---</span>
        <span class="n">peaks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;⚠️ No peaks found.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># --- Select the highest peak ---</span>
        <span class="n">idx_max</span> <span class="o">=</span> <span class="n">peaks</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">peaks</span><span class="p">])]</span>
        <span class="n">q_peak</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx_max</span><span class="p">,</span> <span class="s1">&#39;q&#39;</span><span class="p">]</span>
        <span class="n">I_peak</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx_max</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">]</span>

        <span class="c1"># --- Calculate FWHM using scipy ---</span>
        <span class="n">results_half</span> <span class="o">=</span> <span class="n">peak_widths</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">idx_max</span><span class="p">],</span> <span class="n">rel_height</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

        <span class="c1"># Width in index space → convert to q units</span>
        <span class="n">FWHM</span> <span class="o">=</span> <span class="n">results_half</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  

        <span class="c1"># Left &amp; right positions at half max</span>
        <span class="n">q_left</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">results_half</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">])]</span>
        <span class="n">q_right</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">results_half</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">])]</span>

        <span class="c1"># Print results</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;q_peak = </span><span class="si">{</span><span class="n">q_peak</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> 1/nm&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;I_peak = </span><span class="si">{</span><span class="n">I_peak</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;FWHM = </span><span class="si">{</span><span class="n">FWHM</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> 1/nm&quot;</span><span class="p">)</span>

        <span class="c1"># --- Plot ---</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">],</span> <span class="s1">&#39;o-&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;SAXS Data&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">I_peak</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Half max&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">q_left</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">q_right</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">q_peak</span><span class="p">],</span> <span class="p">[</span><span class="n">I_peak</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;q_peak&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">q_peak</span><span class="p">,</span> <span class="n">I_peak</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;FWHM = </span><span class="si">{</span><span class="n">FWHM</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;q (1/nm)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Intensity I(q)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;SAXS Peak Width (FWHM)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">FWHM</span>

    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;rog&quot;</span><span class="p">:</span>
        <span class="c1"># Use low-q data (heuristic: q &lt; 0.03 1/nm)</span>
        <span class="n">low_q</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.03</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">q2</span> <span class="o">=</span> <span class="n">low_q</span><span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">lnI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">low_q</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">])</span>

        <span class="c1"># Linear regression: lnI = intercept + slope * q^2</span>
        <span class="n">coeffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">q2</span><span class="p">,</span> <span class="n">lnI</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span> <span class="o">=</span> <span class="n">coeffs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coeffs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">Rg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span> <span class="o">*</span> <span class="n">slope</span><span class="p">)</span>
        <span class="n">I0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">intercept</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Slope = </span><span class="si">{</span><span class="n">slope</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Intercept = </span><span class="si">{</span><span class="n">intercept</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Radius of gyration Rg = </span><span class="si">{</span><span class="n">Rg</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> nm&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;I(0) = </span><span class="si">{</span><span class="n">I0</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Plot Guinier plot</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">q2</span><span class="p">,</span> <span class="n">lnI</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Data (ln I vs q²)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">q2</span><span class="p">,</span> <span class="n">slope</span><span class="o">*</span><span class="n">q2</span> <span class="o">+</span> <span class="n">intercept</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Guinier Fit&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;q² (1/nm²)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;ln I(q)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Guinier Analysis&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">Rg</span><span class="p">,</span> <span class="n">I0</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Application &#39;</span><span class="si">{</span><span class="n">application</span><span class="si">}</span><span class="s2">&#39; not implemented yet.&quot;</span><span class="p">)</span></div>





<div class="viewcode-block" id="WAXS_Analysis">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.WAXS_Analysis">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">WAXS_Analysis</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">application</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform Wide-Angle X-ray Scattering (WAXS) data analysis for crystallographic and</span>
<span class="sd">    nanostructural characterization.</span>

<span class="sd">    This function analyzes WAXS diffraction patterns to determine structural</span>
<span class="sd">    information such as peak positions, d-spacings, peak widths, crystallite size,</span>
<span class="sd">    degree of crystallinity, and peak shape classification.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : pandas.DataFrame or array-like</span>
<span class="sd">        Experimental WAXS dataset containing two columns:</span>
<span class="sd">        - &#39;q&#39; : float</span>
<span class="sd">            Scattering vector (Å⁻¹) or 2θ values (degrees)</span>
<span class="sd">        - &#39;I&#39; : float</span>
<span class="sd">            Scattering intensity (a.u.)</span>
<span class="sd">        </span>
<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; data = pd.DataFrame({</span>
<span class="sd">        ...     &quot;q&quot;: [0.5, 1.0, 1.5, 2.0],</span>
<span class="sd">        ...     &quot;I&quot;: [200, 600, 300, 100]</span>
<span class="sd">        ... })</span>

<span class="sd">    application : str</span>
<span class="sd">        Defines the type of analysis to perform. Supported options include:</span>
<span class="sd">        </span>
<span class="sd">        - `&quot;plot&quot;` :</span>
<span class="sd">            Plot the WAXS pattern (Intensity vs q or 2θ).</span>

<span class="sd">        - `&quot;peak_position&quot;` :</span>
<span class="sd">            Detect the most intense diffraction peaks, compute their</span>
<span class="sd">            corresponding d-spacings using:</span>
<span class="sd">                d = 2π / q</span>
<span class="sd">            Returns a table of q values, d-spacings, and intensities.</span>

<span class="sd">        - `&quot;peak_intensity&quot;` :</span>
<span class="sd">            Determine the intensity and integrated area under the</span>
<span class="sd">            strongest diffraction peaks, useful for semi-quantitative</span>
<span class="sd">            crystallinity assessment.</span>

<span class="sd">        - `&quot;peak_width&quot;` :</span>
<span class="sd">            Compute full width at half maximum (FWHM) of main peaks and</span>
<span class="sd">            estimate crystallite size using the Scherrer equation:</span>
<span class="sd">                L = Kλ / (β cosθ)</span>
<span class="sd">            Also estimates overall percent crystallinity from integrated peak areas.</span>

<span class="sd">        - `&quot;peak_shape&quot;` :</span>
<span class="sd">            Classify peak sharpness based on FWHM(2θ) and estimate</span>
<span class="sd">            the crystallinity percentage. Sharp peaks imply high</span>
<span class="sd">            crystallinity, broad peaks indicate amorphous domains.</span>

<span class="sd">    Optional Keyword Arguments</span>
<span class="sd">    ---------------------------</span>
<span class="sd">    threshold : float, optional</span>
<span class="sd">        Minimum relative intensity (fraction of max) to detect peaks.</span>
<span class="sd">        Default = 0.1 (10% of max intensity).</span>

<span class="sd">    top_n : int, optional</span>
<span class="sd">        Number of top peaks to consider. Default = 3.</span>

<span class="sd">    wavelength : float, optional</span>
<span class="sd">        X-ray wavelength in Ångströms (required for `&quot;peak_width&quot;` and `&quot;peak_shape&quot;`).</span>

<span class="sd">    K : float, optional</span>
<span class="sd">        Scherrer constant, typically between 0.89–0.94. Default = 0.9.</span>

<span class="sd">    width_threshold : float, optional</span>
<span class="sd">        Threshold in degrees for classifying peak shapes. Default = 2.0° (2θ).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.DataFrame or tuple</span>
<span class="sd">        Depending on the analysis type:</span>
<span class="sd">        - `&quot;peak_position&quot;` → DataFrame of q, d-spacing, and intensity</span>
<span class="sd">        - `&quot;peak_intensity&quot;` → DataFrame of peak positions and intensities</span>
<span class="sd">        - `&quot;peak_width&quot;` → (DataFrame of peak properties, crystallinity_percent)</span>
<span class="sd">        - `&quot;peak_shape&quot;` → (DataFrame of peak classification, crystallinity_percent)</span>
<span class="sd">        - `&quot;plot&quot;` → None</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If an unsupported application is specified or if wavelength is missing</span>
<span class="sd">        for analyses that require it.</span>
<span class="sd">    TypeError</span>
<span class="sd">        If the input data format is invalid.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - q and 2θ are related by: q = (4π / λ) sin(θ)</span>
<span class="sd">    - d-spacing provides interplanar distances according to Bragg’s law.</span>
<span class="sd">    - Crystallite size estimation assumes negligible strain and instrumental broadening.</span>
<span class="sd">    - The degree of crystallinity is estimated from the ratio of crystalline</span>
<span class="sd">      (peak) area to total scattered intensity.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; WAXS_Analysis(data, &quot;plot&quot;)</span>
<span class="sd">    # Displays the WAXS pattern.</span>

<span class="sd">    &gt;&gt;&gt; WAXS_Analysis(data, &quot;peak_position&quot;)</span>
<span class="sd">    # Returns major peaks and corresponding d-spacings.</span>

<span class="sd">    &gt;&gt;&gt; WAXS_Analysis(data, &quot;peak_intensity&quot;)</span>
<span class="sd">    # Calculates integrated areas of main peaks.</span>

<span class="sd">    &gt;&gt;&gt; WAXS_Analysis(data, &quot;peak_width&quot;, wavelength=1.54)</span>
<span class="sd">    # Estimates FWHM, crystallite size, and crystallinity.</span>

<span class="sd">    &gt;&gt;&gt; WAXS_Analysis(data, &quot;peak_shape&quot;, wavelength=1.54)</span>
<span class="sd">    # Classifies peaks as sharp/broad and returns crystallinity percent.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Convert array-like to DataFrame</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;q&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">])</span>
    
    <span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;q&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;I&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    
    <span class="c1"># --------------------- PLOT ---------------------</span>
    <span class="k">if</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;plot&quot;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Scattering vector q (Å⁻¹) or 2θ (degrees)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Intensity (a.u.)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;WAXS Pattern&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="c1"># --------------------- PEAK POSITION ---------------------</span>
    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;peak_position&quot;</span><span class="p">:</span>
        <span class="n">q_vals</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;q&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>     <span class="c1"># q in Å⁻¹</span>
        <span class="n">intensity</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;I&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

        <span class="c1"># Peak detection</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;threshold&quot;</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>  <span class="c1"># keep peaks above 10% of max</span>
        <span class="n">peaks</span><span class="p">,</span> <span class="n">props</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">intensity</span><span class="p">)</span> <span class="o">*</span> <span class="n">threshold</span><span class="p">)</span>

        <span class="c1"># Keep only strongest peaks</span>
        <span class="n">top_n</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;top_n&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">sorted_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">props</span><span class="p">[</span><span class="s2">&quot;peak_heights&quot;</span><span class="p">])[::</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="n">top_n</span><span class="p">]</span>
        <span class="n">peaks</span> <span class="o">=</span> <span class="n">peaks</span><span class="p">[</span><span class="n">sorted_idx</span><span class="p">]</span>

        <span class="c1"># d-spacing using q (Å⁻¹)</span>
        <span class="n">d_spacings</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">/</span> <span class="n">q_vals</span><span class="p">[</span><span class="n">peaks</span><span class="p">]</span>

        <span class="c1"># Results table</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
            <span class="s2">&quot;q (Å⁻¹)&quot;</span><span class="p">:</span> <span class="n">q_vals</span><span class="p">[</span><span class="n">peaks</span><span class="p">],</span>
            <span class="s2">&quot;d_spacing (Å)&quot;</span><span class="p">:</span> <span class="n">d_spacings</span><span class="p">,</span>
            <span class="s2">&quot;Intensity&quot;</span><span class="p">:</span> <span class="n">intensity</span><span class="p">[</span><span class="n">peaks</span><span class="p">]</span>
        <span class="p">})</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;q (Å⁻¹)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Main Peaks and d-spacings:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

        <span class="c1"># Plot</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">q_vals</span><span class="p">,</span> <span class="n">intensity</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;WAXS Pattern&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">q_vals</span><span class="p">[</span><span class="n">peaks</span><span class="p">],</span> <span class="n">intensity</span><span class="p">[</span><span class="n">peaks</span><span class="p">],</span> <span class="s2">&quot;rx&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Main Peaks&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;q (Å⁻¹)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Intensity (a.u.)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;WAXS Peaks (q-based)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">results</span>
    
    <span class="c1"># --------------------- PEAK INTENSITY ---------------------</span>
    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;peak_intensity&quot;</span><span class="p">:</span>
        <span class="n">top_n</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;top_n&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>   <span class="c1"># default keep 3 strongest peaks</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;threshold&quot;</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>  <span class="c1"># 5% of max intensity</span>
        
        <span class="c1"># Peak detection</span>
        <span class="n">peaks</span><span class="p">,</span> <span class="n">props</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">threshold</span><span class="p">)</span>
        
        <span class="c1"># Keep top_n strongest peaks</span>
        <span class="n">sorted_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">props</span><span class="p">[</span><span class="s2">&quot;peak_heights&quot;</span><span class="p">])[::</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="n">top_n</span><span class="p">]</span>
        <span class="n">peaks</span> <span class="o">=</span> <span class="n">peaks</span><span class="p">[</span><span class="n">sorted_idx</span><span class="p">]</span>
        
        <span class="n">peak_positions</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">peaks</span><span class="p">]</span>
        <span class="n">peak_intensities</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">peaks</span><span class="p">]</span>
        
        <span class="c1"># Degree of crystallinity</span>
        <span class="n">Ac</span> <span class="o">=</span> <span class="n">simpson</span><span class="p">(</span><span class="n">peak_intensities</span><span class="p">,</span> <span class="n">peak_positions</span><span class="p">)</span>
        <span class="n">Aa</span> <span class="o">=</span> <span class="n">simpson</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">Ac</span>
        <span class="c1">#Xc = (Ac / (Ac + Aa)) * 100</span>
        
        <span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
            <span class="s2">&quot;Peak_2θ(deg)&quot;</span><span class="p">:</span> <span class="n">peak_positions</span><span class="p">,</span>
            <span class="s2">&quot;Intensity(a.u.)&quot;</span><span class="p">:</span> <span class="n">peak_intensities</span>
        <span class="p">})</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;Peak_2θ(deg)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Main Peak Intensities:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
        <span class="c1">#print(f&quot;\nEstimated Degree of Crystallinity (Xc): {Xc:.2f}%&quot;)</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;WAXS Pattern&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">peak_positions</span><span class="p">,</span> <span class="n">peak_intensities</span><span class="p">,</span> <span class="s2">&quot;rx&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Main Peaks&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;q&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Intensity (a.u.)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;WAXS Peaks and Intensities&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="n">results</span><span class="p">,</span> <span class="c1">#Xc</span>

<span class="c1"># --------------------- PEAK WIDTH / CRYSTALLITE SIZE ---------------------</span>
   <span class="c1"># --------------------- PEAK WIDTH + CRYSTALLINITY ---------------------</span>
    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;peak_width&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;wavelength&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please provide X-ray wavelength in Angstroms using wavelength=&lt;value&gt;.&quot;</span><span class="p">)</span>
        <span class="n">wavelength</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;wavelength&quot;</span><span class="p">]</span>
        <span class="n">K</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">)</span>
        <span class="n">top_n</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;top_n&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;threshold&quot;</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>

        <span class="c1"># Find peaks</span>
        <span class="n">peaks</span><span class="p">,</span> <span class="n">props</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">threshold</span><span class="p">)</span>
        <span class="n">sorted_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">props</span><span class="p">[</span><span class="s2">&quot;peak_heights&quot;</span><span class="p">])[::</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="n">top_n</span><span class="p">]</span>
        <span class="n">peaks</span> <span class="o">=</span> <span class="n">peaks</span><span class="p">[</span><span class="n">sorted_idx</span><span class="p">]</span>
        <span class="n">q_peaks</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">peaks</span><span class="p">]</span>   <span class="c1"># x is q (Å⁻¹)</span>

        <span class="c1"># FWHM calculation</span>
        <span class="n">results_half</span> <span class="o">=</span> <span class="n">peak_widths</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">peaks</span><span class="p">,</span> <span class="n">rel_height</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">FWHM_points</span> <span class="o">=</span> <span class="n">results_half</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dq</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>   <span class="c1"># step size in q</span>
        <span class="n">FWHM_q</span> <span class="o">=</span> <span class="n">FWHM_points</span> <span class="o">*</span> <span class="n">dq</span>   <span class="c1"># convert width in index → width in q</span>

        <span class="c1"># Convert q to theta (radians)</span>
        <span class="n">theta_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">((</span><span class="n">q_peaks</span> <span class="o">*</span> <span class="n">wavelength</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>

        <span class="c1"># Convert FWHM in q to FWHM in radians of 2θ</span>
        <span class="c1"># Approximation: d(2θ)/dq = λ / (2 cosθ)</span>
        <span class="n">FWHM_rad</span> <span class="o">=</span> <span class="p">(</span><span class="n">wavelength</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_rad</span><span class="p">)))</span> <span class="o">*</span> <span class="n">FWHM_q</span>

        <span class="c1"># Scherrer equation</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">K</span> <span class="o">*</span> <span class="n">wavelength</span> <span class="o">/</span> <span class="p">(</span><span class="n">FWHM_rad</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_rad</span><span class="p">))</span>

        <span class="c1"># Peak areas</span>
        <span class="n">peak_areas</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">peaks</span><span class="p">):</span>
            <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">results_half</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">results_half</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
            <span class="n">peak_area</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">left</span><span class="p">:</span><span class="n">right</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">left</span><span class="p">:</span><span class="n">right</span><span class="p">])</span>
            <span class="n">peak_areas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">peak_area</span><span class="p">)</span>

        <span class="n">total_area</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">crystallinity_percent</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">peak_areas</span><span class="p">)</span> <span class="o">/</span> <span class="n">total_area</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>

        <span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
            <span class="s2">&quot;q (Å⁻¹)&quot;</span><span class="p">:</span> <span class="n">q_peaks</span><span class="p">,</span>
            <span class="s2">&quot;Theta (deg)&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">theta_rad</span><span class="p">),</span>
            <span class="s2">&quot;FWHM(q)&quot;</span><span class="p">:</span> <span class="n">FWHM_q</span><span class="p">,</span>
            <span class="s2">&quot;Crystallite_Size(Å)&quot;</span><span class="p">:</span> <span class="n">L</span><span class="p">,</span>
            <span class="s2">&quot;Peak_Area&quot;</span><span class="p">:</span> <span class="n">peak_areas</span>
        <span class="p">})</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;q (Å⁻¹)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Main Peak Widths, Crystallite Sizes, and Areas:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Estimated Percent Crystallinity = </span><span class="si">{</span><span class="n">crystallinity_percent</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

        <span class="c1"># Plot</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;WAXS Pattern&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">q_peaks</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="n">peaks</span><span class="p">],</span> <span class="s2">&quot;rx&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Main Peaks&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">peaks</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">results_half</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]):</span><span class="nb">int</span><span class="p">(</span><span class="n">results_half</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">])],</span>
                            <span class="n">y</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">results_half</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]):</span><span class="nb">int</span><span class="p">(</span><span class="n">results_half</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">])],</span>
                            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Peak </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> Area&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;q (Å⁻¹)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Intensity (a.u.)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;WAXS Peaks with FWHM &amp; Crystallinity&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">results</span><span class="p">,</span> <span class="n">crystallinity_percent</span>


       <span class="c1"># --------------------- PEAK SHAPE / BACKGROUND ---------------------</span>
    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;peak_shape&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;wavelength&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please provide X-ray wavelength in Angstroms using wavelength=&lt;value&gt;.&quot;</span><span class="p">)</span>
        <span class="n">wavelength</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;wavelength&quot;</span><span class="p">]</span>
        
        <span class="n">top_n</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;top_n&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;threshold&quot;</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
        
        <span class="c1"># Peak detection</span>
        <span class="n">peaks</span><span class="p">,</span> <span class="n">props</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">threshold</span><span class="p">)</span>
        <span class="n">sorted_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">props</span><span class="p">[</span><span class="s2">&quot;peak_heights&quot;</span><span class="p">])[::</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="n">top_n</span><span class="p">]</span>
        <span class="n">peaks</span> <span class="o">=</span> <span class="n">peaks</span><span class="p">[</span><span class="n">sorted_idx</span><span class="p">]</span>
        <span class="n">q_peaks</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">peaks</span><span class="p">]</span>

        <span class="c1"># FWHM in q-units</span>
        <span class="n">results_half</span> <span class="o">=</span> <span class="n">peak_widths</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">peaks</span><span class="p">,</span> <span class="n">rel_height</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">dq</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">FWHM_q</span> <span class="o">=</span> <span class="n">results_half</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">dq</span>

        <span class="c1"># Convert q → theta</span>
        <span class="n">theta_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">((</span><span class="n">q_peaks</span> <span class="o">*</span> <span class="n">wavelength</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>

        <span class="c1"># Convert FWHM(q) → FWHM in 2θ (radians), then to degrees</span>
        <span class="n">FWHM_rad</span> <span class="o">=</span> <span class="p">(</span><span class="n">wavelength</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_rad</span><span class="p">)))</span> <span class="o">*</span> <span class="n">FWHM_q</span>
        <span class="n">FWHM_deg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">FWHM_rad</span><span class="p">)</span>

        <span class="c1"># Peak areas &amp; crystallinity</span>
        <span class="n">peak_areas</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">peaks</span><span class="p">):</span>
            <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">results_half</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">results_half</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
            <span class="n">peak_area</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">left</span><span class="p">:</span><span class="n">right</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">left</span><span class="p">:</span><span class="n">right</span><span class="p">])</span>
            <span class="n">peak_areas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">peak_area</span><span class="p">)</span>
        <span class="n">total_area</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">crystallinity_percent</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">peak_areas</span><span class="p">)</span> <span class="o">/</span> <span class="n">total_area</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>

        <span class="c1"># Classification</span>
        <span class="n">width_threshold</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;width_threshold&quot;</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)</span>  <span class="c1"># default 2° 2θ</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;Sharp (Highly Crystalline)&quot;</span> <span class="k">if</span> <span class="n">w</span> <span class="o">&lt;</span> <span class="n">width_threshold</span> <span class="k">else</span>
            <span class="s2">&quot;Broad (Mostly Amorphous)&quot;</span>
            <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">FWHM_deg</span>
        <span class="p">]</span>
        
        <span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
            <span class="s2">&quot;q (Å⁻¹)&quot;</span><span class="p">:</span> <span class="n">q_peaks</span><span class="p">,</span>
            <span class="s2">&quot;Theta (deg)&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">theta_rad</span><span class="p">),</span>
            <span class="s2">&quot;FWHM(2θ deg)&quot;</span><span class="p">:</span> <span class="n">FWHM_deg</span><span class="p">,</span>
            <span class="s2">&quot;Shape&quot;</span><span class="p">:</span> <span class="n">shape</span><span class="p">,</span>
            <span class="s2">&quot;Peak_Area&quot;</span><span class="p">:</span> <span class="n">peak_areas</span>
        <span class="p">})</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;q (Å⁻¹)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Main Peak Shapes (θ-based):&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Estimated Percent Crystallinity = </span><span class="si">{</span><span class="n">crystallinity_percent</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
        
        <span class="c1"># Plot</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;WAXS Pattern&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">q_peaks</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="n">peaks</span><span class="p">],</span> <span class="s2">&quot;rx&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Main Peaks&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">peaks</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">results_half</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]):</span><span class="nb">int</span><span class="p">(</span><span class="n">results_half</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">])],</span>
                            <span class="n">y</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">results_half</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]):</span><span class="nb">int</span><span class="p">(</span><span class="n">results_half</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">])],</span>
                            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Peak </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> Area&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;q (Å⁻¹)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Intensity (a.u.)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;WAXS Peak Shapes (θ-based)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="n">results</span><span class="p">,</span> <span class="n">crystallinity_percent</span>


    
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Application &#39;</span><span class="si">{</span><span class="n">application</span><span class="si">}</span><span class="s2">&#39; not supported yet.&quot;</span><span class="p">)</span></div>








<div class="viewcode-block" id="NMR_Analysis">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.NMR_Analysis">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">NMR_Analysis</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">application</span><span class="p">,</span><span class="n">peak_regions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">peak_info</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Analyze and visualize ¹H NMR spectra for different applications.</span>

<span class="sd">    This function provides multiple modes:</span>
<span class="sd">    1. Plotting the raw NMR spectrum (`&#39;plot&#39;`).</span>
<span class="sd">    2. Plotting the spectrum with integrated peak steps (`&#39;plot_with_integrals&#39;`).</span>
<span class="sd">    3. Estimating mole fractions of compounds in a mixture (`&#39;mixture_composition&#39;`).</span>
<span class="sd">    4. Calculating percentage impurity of a compound (`&#39;calculate_impurity&#39;`).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pd.DataFrame</span>
<span class="sd">        DataFrame containing NMR data with columns:</span>
<span class="sd">        - &#39;ppm&#39; : chemical shift values (x-axis)</span>
<span class="sd">        - &#39;Spectrum&#39; : intensity values (y-axis)</span>
<span class="sd">    application : str</span>
<span class="sd">        Mode of operation. Options:</span>
<span class="sd">        - &#39;plot&#39; : generates a professional NMR spectrum plot.</span>
<span class="sd">        - &#39;plot_with_integrals&#39; : generates a plot with integral steps (requires `peak_regions`).</span>
<span class="sd">        - &#39;mixture_composition&#39; : calculates mole fractions of compounds (requires `peak_info`).</span>
<span class="sd">        - &#39;calculate_impurity&#39; : calculates impurity percentage (requires `peak_info` with main and impurity info).</span>
<span class="sd">    peak_regions : dict, optional</span>
<span class="sd">        Dictionary specifying integration regions for peaks (required for `&#39;plot_with_integrals&#39;`).</span>
<span class="sd">        Format: {region_name: (start_ppm, end_ppm)}</span>
<span class="sd">    peak_info : dict, optional</span>
<span class="sd">        Dictionary with compound information for mixture analysis or impurity calculation.</span>
<span class="sd">        For `&#39;mixture_composition&#39;`:</span>
<span class="sd">            {compound_name: {&#39;region&#39;: (start_ppm, end_ppm), &#39;protons&#39;: int}}</span>
<span class="sd">        For `&#39;calculate_impurity&#39;`:</span>
<span class="sd">            {</span>
<span class="sd">                &#39;main_compound&#39;: {&#39;region&#39;: (start, end), &#39;protons&#39;: int},</span>
<span class="sd">                &#39;impurity&#39;: {&#39;region&#39;: (start, end), &#39;protons&#39;: int}</span>
<span class="sd">            }</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">        The function either displays plots or prints calculated results.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    # 1. Simple plot of NMR spectrum</span>
<span class="sd">    &gt;&gt;&gt; NMR_Analysis(df, application=&#39;plot&#39;)</span>

<span class="sd">    # 2. Plot spectrum with integrals</span>
<span class="sd">    &gt;&gt;&gt; peak_regions = {&#39;peak1&#39;: (7.0, 7.5), &#39;peak2&#39;: (3.5, 4.0)}</span>
<span class="sd">    &gt;&gt;&gt; NMR_Analysis(df, application=&#39;plot_with_integrals&#39;, peak_regions=peak_regions)</span>

<span class="sd">    # 3. Mixture composition analysis</span>
<span class="sd">    &gt;&gt;&gt; peak_info = {</span>
<span class="sd">    ...     &#39;CompoundA&#39;: {&#39;region&#39;: (7.0, 7.5), &#39;protons&#39;: 5},</span>
<span class="sd">    ...     &#39;CompoundB&#39;: {&#39;region&#39;: (3.5, 4.0), &#39;protons&#39;: 3}</span>
<span class="sd">    ... }</span>
<span class="sd">    &gt;&gt;&gt; NMR_Analysis(df, application=&#39;mixture_composition&#39;, peak_info=peak_info)</span>
<span class="sd">    --- Mixture Composition ---</span>
<span class="sd">    Mole Fraction of CompoundA: 0.62</span>
<span class="sd">    Mole Fraction of CompoundB: 0.38</span>

<span class="sd">    # 4. Impurity calculation</span>
<span class="sd">    &gt;&gt;&gt; peak_info = {</span>
<span class="sd">    ...     &#39;main_compound&#39;: {&#39;region&#39;: (7.0, 7.5), &#39;protons&#39;: 5},</span>
<span class="sd">    ...     &#39;impurity&#39;: {&#39;region&#39;: (3.5, 4.0), &#39;protons&#39;: 1}</span>
<span class="sd">    ... }</span>
<span class="sd">    &gt;&gt;&gt; NMR_Analysis(df, application=&#39;calculate_impurity&#39;, peak_info=peak_info)</span>
<span class="sd">    --- Impurity Analysis ---</span>
<span class="sd">    Main Compound Integral per Proton: 0.1234</span>
<span class="sd">    Impurity Integral per Proton: 0.0123</span>
<span class="sd">    Estimated Impurity: 9.09%</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;plot&#39;</span><span class="p">:</span>
        <span class="c1"># Create the plot</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ppm&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Spectrum&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="c1"># Customize the plot for a professional look</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;¹H NMR Spectrum&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Chemical Shift (ppm)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Intensity&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_xaxis</span><span class="p">()</span>  <span class="c1"># Invert the x-axis, which is standard for NMR spectra</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
        
        <span class="c1"># Add a light gray background to the plot area</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s1">&#39;#f7f7f7&#39;</span><span class="p">)</span>
        
        <span class="c1"># Remove the top and right spines for a cleaner look</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;plot_with_integrals&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">peak_regions</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: &#39;peak_regions&#39; dictionary must be provided for &#39;plot_with_integrals&#39; application.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">integrals</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">region</span><span class="p">,</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span> <span class="ow">in</span> <span class="n">peak_regions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">peak_data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ppm&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">start</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ppm&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">end</span><span class="p">)]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">peak_data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="c1"># Use the new simpson function</span>
                <span class="n">area</span> <span class="o">=</span> <span class="n">simpson</span><span class="p">(</span><span class="n">peak_data</span><span class="p">[</span><span class="s1">&#39;Spectrum&#39;</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="n">peak_data</span><span class="p">[</span><span class="s1">&#39;ppm&#39;</span><span class="p">])</span>
                <span class="n">integrals</span><span class="p">[</span><span class="n">region</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">area</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">integrals</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No peaks found in the defined regions.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">min_integral</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">integrals</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">proton_ratios</span> <span class="o">=</span> <span class="p">{</span><span class="n">region</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">area</span> <span class="o">/</span> <span class="n">min_integral</span><span class="p">)</span> <span class="k">for</span> <span class="n">region</span><span class="p">,</span> <span class="n">area</span> <span class="ow">in</span> <span class="n">integrals</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

        <span class="c1"># Start plotting with integral steps</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        
        <span class="c1"># Plot the NMR spectrum</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ppm&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Spectrum&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;NMR Spectrum (scaled)&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Chemical Shift (ppm)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Intensity (a.u.)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">invert_xaxis</span><span class="p">()</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s1">&#39;#f7f7f7&#39;</span><span class="p">)</span>
        
        <span class="c1"># Create a second y-axis for the integral</span>
        <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
        
        <span class="c1"># Build the integral step plot</span>
        <span class="n">integral_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
        
        <span class="c1"># Use a list to store the total integral for each step</span>
        <span class="n">total_integral_steps</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="k">for</span> <span class="n">region</span><span class="p">,</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span> <span class="ow">in</span> <span class="n">peak_regions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">ratio</span> <span class="o">=</span> <span class="n">proton_ratios</span><span class="p">[</span><span class="n">region</span><span class="p">]</span>
            
            <span class="c1"># Find the index of the start of the current peak region</span>
            <span class="n">start_idx</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;ppm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">end</span><span class="p">)</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
            
            <span class="c1"># Add the new integral value to the step list</span>
            <span class="n">total_integral_steps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">total_integral_steps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ratio</span><span class="p">)</span>
            
            <span class="c1"># Update the integral step for the points after the peak</span>
            <span class="n">integral_y</span><span class="p">[</span><span class="n">start_idx</span><span class="p">:]</span> <span class="o">=</span> <span class="n">total_integral_steps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            
            <span class="c1"># Add annotation for the integral</span>
            <span class="n">mid_ppm</span> <span class="o">=</span> <span class="p">(</span><span class="n">start</span> <span class="o">+</span> <span class="n">end</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">Delta$Integral = </span><span class="si">{</span><span class="n">ratio</span><span class="si">}</span><span class="s2"> H&quot;</span><span class="p">,</span> 
                         <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">mid_ppm</span><span class="p">,</span> <span class="n">total_integral_steps</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">ratio</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
                         <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span>
                         <span class="n">textcoords</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span>
                         <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                         <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                         <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
                         <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
            
        <span class="c1"># Plot the integral steps</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ppm&#39;</span><span class="p">],</span> <span class="n">integral_y</span><span class="p">,</span> <span class="n">drawstyle</span><span class="o">=</span><span class="s1">&#39;steps-post&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Integral (stepped)&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Integral (H units)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        
        <span class="c1"># Set titles and legends</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Annotated Simulated ¹H NMR Spectrum - Integrals&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">bbox_transform</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;mixture_composition&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">peak_info</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: &#39;peak_info&#39; dictionary with compound and proton information is required.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">integrals_per_proton</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">compound</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">peak_info</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">region</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">]</span>
            <span class="n">protons</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;protons&#39;</span><span class="p">]</span>
            
            <span class="n">peak_data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ppm&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">region</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ppm&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">region</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="n">peak_data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">integral</span> <span class="o">=</span> <span class="n">simpson</span><span class="p">(</span><span class="n">peak_data</span><span class="p">[</span><span class="s1">&#39;Spectrum&#39;</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="n">peak_data</span><span class="p">[</span><span class="s1">&#39;ppm&#39;</span><span class="p">])</span>
                <span class="n">integral_per_proton</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">integral</span><span class="p">)</span> <span class="o">/</span> <span class="n">protons</span>
                <span class="n">integrals_per_proton</span><span class="p">[</span><span class="n">compound</span><span class="p">]</span> <span class="o">=</span> <span class="n">integral_per_proton</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: No data found for </span><span class="si">{</span><span class="n">compound</span><span class="si">}</span><span class="s2"> in the specified region </span><span class="si">{</span><span class="n">region</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
                <span class="n">integrals_per_proton</span><span class="p">[</span><span class="n">compound</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Calculate total integral per proton to find mole fractions</span>
        <span class="n">total_integral_per_proton</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">integrals_per_proton</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        
        <span class="k">if</span> <span class="n">total_integral_per_proton</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Could not determine composition. Check peak regions and data.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">mole_fractions</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">compound</span><span class="p">:</span> <span class="p">(</span><span class="n">value</span> <span class="o">/</span> <span class="n">total_integral_per_proton</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">compound</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">integrals_per_proton</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Mixture Composition ---&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">compound</span><span class="p">,</span> <span class="n">mole_fraction</span> <span class="ow">in</span> <span class="n">mole_fractions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mole Fraction of </span><span class="si">{</span><span class="n">compound</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">mole_fraction</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>




    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;calculate_impurity&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">peak_info</span> <span class="ow">or</span> <span class="s1">&#39;main_compound&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">peak_info</span> <span class="ow">or</span> <span class="s1">&#39;impurity&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">peak_info</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: &#39;peak_info&#39; must contain keys for &#39;main_compound&#39; and &#39;impurity&#39;.&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="n">main_info</span> <span class="o">=</span> <span class="n">peak_info</span><span class="p">[</span><span class="s1">&#39;main_compound&#39;</span><span class="p">]</span>
        <span class="n">impurity_info</span> <span class="o">=</span> <span class="n">peak_info</span><span class="p">[</span><span class="s1">&#39;impurity&#39;</span><span class="p">]</span>
        
        <span class="c1"># Calculate integral per proton for the main compound</span>
        <span class="n">main_peak_data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ppm&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">main_info</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ppm&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">main_info</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">main_peak_data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">main_integral</span> <span class="o">=</span> <span class="n">simpson</span><span class="p">(</span><span class="n">main_peak_data</span><span class="p">[</span><span class="s1">&#39;Spectrum&#39;</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="n">main_peak_data</span><span class="p">[</span><span class="s1">&#39;ppm&#39;</span><span class="p">])</span>
            <span class="n">main_integral_per_proton</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">main_integral</span><span class="p">)</span> <span class="o">/</span> <span class="n">main_info</span><span class="p">[</span><span class="s1">&#39;protons&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: Main compound peak not found.&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="c1"># Calculate integral per proton for the impurity</span>
        <span class="n">impurity_peak_data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ppm&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">impurity_info</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ppm&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">impurity_info</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">impurity_peak_data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">impurity_integral</span> <span class="o">=</span> <span class="n">simpson</span><span class="p">(</span><span class="n">impurity_peak_data</span><span class="p">[</span><span class="s1">&#39;Spectrum&#39;</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="n">impurity_peak_data</span><span class="p">[</span><span class="s1">&#39;ppm&#39;</span><span class="p">])</span>
            <span class="n">impurity_integral_per_proton</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">impurity_integral</span><span class="p">)</span> <span class="o">/</span> <span class="n">impurity_info</span><span class="p">[</span><span class="s1">&#39;protons&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: Impurity peak not found.&quot;</span><span class="p">)</span>
            <span class="k">return</span>
            
        <span class="c1"># Calculate total integral (on a per-proton basis)</span>
        <span class="n">total_integral_per_proton</span> <span class="o">=</span> <span class="n">main_integral_per_proton</span> <span class="o">+</span> <span class="n">impurity_integral_per_proton</span>
        
        <span class="k">if</span> <span class="n">total_integral_per_proton</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Could not calculate impurity percentage. Check peak regions and data.&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="c1"># Calculate percentage impurity</span>
        <span class="n">percent_impurity</span> <span class="o">=</span> <span class="p">(</span><span class="n">impurity_integral_per_proton</span> <span class="o">/</span> <span class="n">total_integral_per_proton</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Impurity Analysis ---&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Main Compound Integral per Proton: </span><span class="si">{</span><span class="n">main_integral_per_proton</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Impurity Integral per Proton: </span><span class="si">{</span><span class="n">impurity_integral_per_proton</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Estimated Impurity: </span><span class="si">{</span><span class="n">percent_impurity</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

    
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Application &#39;</span><span class="si">{</span><span class="n">application</span><span class="si">}</span><span class="s2">&#39; is not supported.&quot;</span><span class="p">)</span></div>

    




<div class="viewcode-block" id="BET_Analysis">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.BET_Analysis">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">BET_Analysis</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">application</span><span class="p">,</span> <span class="n">mass_of_sample</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cross_sectional_area</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Pa</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">total_surface_area</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">pore_volume</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform BET (Brunauer–Emmett–Teller) analysis on adsorption data, including surface area </span>
<span class="sd">    determination, pore volume, and pore radius calculations.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pd.DataFrame</span>
<span class="sd">        DataFrame containing adsorption data with columns:</span>
<span class="sd">        - &#39;Relative Pressure (P/P0)&#39; : relative pressure of adsorbate</span>
<span class="sd">        - &#39;Adsorbed Volume (cm3/g STP)&#39; : adsorbed gas volume</span>
<span class="sd">    application : str</span>
<span class="sd">        Mode of operation. Options:</span>
<span class="sd">        - &#39;plot_isotherm&#39; : plots the adsorption isotherm.</span>
<span class="sd">        - &#39;calculate_surface_area&#39; : plots BET plot and calculates the specific surface area.</span>
<span class="sd">        - &#39;pore_volume_calculation&#39; : calculates the total pore volume.</span>
<span class="sd">        - &#39;pore_radius_calculations&#39; : calculates average pore radius.</span>
<span class="sd">    mass_of_sample : float, optional</span>
<span class="sd">        Mass of the sample in grams. Required for &#39;calculate_surface_area&#39;.</span>
<span class="sd">    cross_sectional_area : float, optional</span>
<span class="sd">        Cross-sectional area of adsorbate molecule (m^2). Required for &#39;calculate_surface_area&#39;.</span>
<span class="sd">    T : float, optional</span>
<span class="sd">        Ambient temperature in Kelvin. Required for &#39;pore_volume_calculation&#39;.</span>
<span class="sd">    Pa : float, optional</span>
<span class="sd">        Ambient pressure in Pa. Required for &#39;pore_volume_calculation&#39;.</span>
<span class="sd">    total_surface_area : float, optional</span>
<span class="sd">        Total surface area (St in m^2) for pore radius calculation. Required for &#39;pore_radius_calculations&#39;.</span>
<span class="sd">    pore_volume : float, optional</span>
<span class="sd">        Total pore volume (V_liq) in m^3/g. Can be used instead of recalculating from data.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict or None</span>
<span class="sd">        Depending on the application, returns a dictionary with calculated values:</span>
<span class="sd">        - &#39;calculate_surface_area&#39; : {&#39;slope&#39;: m, &#39;intercept&#39;: b, &#39;v_m&#39;: vm, &#39;constant&#39;: c, &#39;sbet&#39;: SBET}</span>
<span class="sd">        - &#39;pore_volume_calculation&#39; : {&#39;pore_volume&#39;: V_liq}</span>
<span class="sd">        - &#39;pore_radius_calculations&#39; : {&#39;pore_radius_nm&#39;: r_p}</span>
<span class="sd">        Returns None for simple plots or if calculations fail.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    # 1. Plot adsorption isotherm</span>
<span class="sd">    &gt;&gt;&gt; BET_Analysis(df, application=&#39;plot_isotherm&#39;)</span>

<span class="sd">    # 2. Calculate BET surface area</span>
<span class="sd">    &gt;&gt;&gt; BET_Analysis(df, application=&#39;calculate_surface_area&#39;, mass_of_sample=0.05, cross_sectional_area=0.162e-18)</span>
<span class="sd">    --- BET Surface Area Calculation ---</span>
<span class="sd">    Slope (m): 10.1234</span>
<span class="sd">    Y-intercept (b): 2.3456</span>
<span class="sd">    Monolayer Adsorbed Volume (vm): 0.1234 cm^3/g STP</span>
<span class="sd">    BET Constant (c): 5.32</span>
<span class="sd">    Specific Surface Area (SBET): 45.67 m^2/g</span>

<span class="sd">    # 3. Calculate pore volume</span>
<span class="sd">    &gt;&gt;&gt; BET_Analysis(df, application=&#39;pore_volume_calculation&#39;, T=77, Pa=101325)</span>
<span class="sd">    --- Pore Volume Calculation ---</span>
<span class="sd">    Volume of gas adsorbed (V_ads): 150.0 cm^3/g STP</span>
<span class="sd">    Total Pore Volume (V_liq): 0.000150 m^3/g</span>

<span class="sd">    # 4. Calculate average pore radius</span>
<span class="sd">    &gt;&gt;&gt; BET_Analysis(df, application=&#39;pore_radius_calculations&#39;, total_surface_area=45.67, pore_volume=0.000150)</span>
<span class="sd">    --- Pore Radius Calculation ---</span>
<span class="sd">    Total Pore Volume (V_liq): 0.000150 m^3/g</span>
<span class="sd">    Total Surface Area (S): 45.67 m^2</span>
<span class="sd">    Average Pore Radius (r_p): 6.57 nm</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Molar volume of liquid adsorbate (Vm) for N2 at 77K</span>
    <span class="n">Vm</span> <span class="o">=</span> <span class="mf">34.65</span>  <span class="c1"># cm^3/mol</span>
    
    <span class="k">if</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;plot_isotherm&#39;</span><span class="p">:</span>
        <span class="c1"># Simple plot of Adsorption Isotherm</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Relative Pressure (P/P0)&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Adsorbed Volume (cm3/g STP)&#39;</span><span class="p">],</span> <span class="s1">&#39;o-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Relative Pressure ($P/P_0$)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Adsorbed Volume ($cm^3/g$ STP)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Adsorption Isotherm&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;calculate_surface_area&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mass_of_sample</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">cross_sectional_area</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: &#39;mass_of_sample&#39; and &#39;cross_sectional_area&#39; must be provided for this application.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Prepare data for the BET plot</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Relative Pressure (P/P0)&#39;</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Adsorbed Volume (cm3/g STP)&#39;</span><span class="p">]</span>
        
        <span class="c1"># Calculate the y-axis values for the BET plot</span>
        <span class="c1"># y = 1 / (v * ((p0/p) - 1)) = (1 / (v * ((1/p) - 1)))</span>
        <span class="n">bet_y</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">v</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="n">p</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        
        <span class="c1"># Plot the BET plot</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">bet_y</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkgreen&#39;</span><span class="p">)</span>
        
        <span class="c1"># Fit a linear regression line to the data</span>
        <span class="c1"># We need to filter for the linear region (typically P/P0 from ~0.05 to ~0.35)</span>
        <span class="n">linear_region</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Relative Pressure (P/P0)&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.05</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Relative Pressure (P/P0)&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.35</span><span class="p">)]</span>
        <span class="n">p_linear</span> <span class="o">=</span> <span class="n">linear_region</span><span class="p">[</span><span class="s1">&#39;Relative Pressure (P/P0)&#39;</span><span class="p">]</span>
        <span class="n">v_linear</span> <span class="o">=</span> <span class="n">linear_region</span><span class="p">[</span><span class="s1">&#39;Adsorbed Volume (cm3/g STP)&#39;</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">p_linear</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">bet_y_linear</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">v_linear</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="n">p_linear</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">m</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">p_linear</span><span class="p">,</span> <span class="n">bet_y_linear</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            
            <span class="c1"># Plot the linear fit</span>
            <span class="n">x_fit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">p_linear</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">p_linear</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">100</span><span class="p">)</span>
            <span class="n">y_fit</span> <span class="o">=</span> <span class="n">m</span> <span class="o">*</span> <span class="n">x_fit</span> <span class="o">+</span> <span class="n">b</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_fit</span><span class="p">,</span> <span class="n">y_fit</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Linear Fit: y = </span><span class="si">{</span><span class="n">m</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">x + </span><span class="si">{</span><span class="n">b</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            
            <span class="c1"># Label the plot</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Relative Pressure ($P/P_0$)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$</span><span class="se">\\</span><span class="s1">frac</span><span class="si">{1}</span><span class="s1">{v</span><span class="se">\\</span><span class="s1">left(</span><span class="se">\\</span><span class="s1">frac</span><span class="si">{P_0}{P}</span><span class="s1">-1</span><span class="se">\\</span><span class="s1">right)}$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;BET Linear Plot&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

            <span class="c1"># Calculate vm and c from the slope (m) and y-intercept (b)</span>
            <span class="c1"># m = (c-1) / (vm * c)</span>
            <span class="c1"># b = 1 / (vm * c)</span>
            <span class="n">vm</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>
            <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">m</span> <span class="o">/</span> <span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            
            <span class="c1"># Calculate total surface area (St)</span>
            <span class="c1"># St = (vm * N * s) / V  where V is molar volume at STP</span>
            <span class="n">N_avogadro</span> <span class="o">=</span> <span class="mf">6.022e23</span>  <span class="c1"># molecules/mol</span>
            <span class="n">V_molar_STP</span> <span class="o">=</span> <span class="mi">22414</span> <span class="c1"># cm^3/mol</span>
            <span class="n">St</span> <span class="o">=</span> <span class="p">(</span><span class="n">vm</span> <span class="o">*</span> <span class="n">N_avogadro</span> <span class="o">*</span> <span class="n">cross_sectional_area</span><span class="p">)</span> <span class="o">/</span> <span class="n">V_molar_STP</span>
            
            <span class="c1"># Calculate specific surface area (SBET)</span>
            <span class="c1"># SBET = St / a</span>
            <span class="n">SBET</span> <span class="o">=</span> <span class="n">St</span> <span class="o">/</span> <span class="n">mass_of_sample</span>
            
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- BET Surface Area Calculation ---&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Slope (m): </span><span class="si">{</span><span class="n">m</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Y-intercept (b): </span><span class="si">{</span><span class="n">b</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Monolayer Adsorbed Volume (vm): </span><span class="si">{</span><span class="n">vm</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> cm^3/g STP&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BET Constant (c): </span><span class="si">{</span><span class="n">c</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Specific Surface Area (SBET): </span><span class="si">{</span><span class="n">SBET</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> m^2/g&quot;</span><span class="p">)</span>
            <span class="n">results</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;slope&#39;</span><span class="p">:</span> <span class="n">m</span> <span class="p">,</span> <span class="s1">&#39;intercept&#39;</span> <span class="p">:</span> <span class="n">b</span><span class="p">,</span> <span class="s1">&#39;v_m&#39;</span><span class="p">:</span> <span class="n">vm</span> <span class="p">,</span> <span class="s1">&#39;constant&#39;</span> <span class="p">:</span> <span class="n">c</span> <span class="p">,</span> <span class="s1">&#39;sbet&#39;</span><span class="p">:</span><span class="n">SBET</span><span class="p">}</span>
            <span class="k">return</span> <span class="n">results</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: No data found in the linear region (0.05 &lt; P/P0 &lt; 0.35).&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;pore_volume_calculation&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">T</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">Pa</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: &#39;T&#39; (temperature in K) and &#39;Pa&#39; (ambient pressure in Pa) are required.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Find the adsorbed volume at the highest relative pressure (closest to unity)</span>
        <span class="n">high_pressure_data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">V_ads</span> <span class="o">=</span> <span class="n">high_pressure_data</span><span class="p">[</span><span class="s1">&#39;Adsorbed Volume (cm3/g STP)&#39;</span><span class="p">]</span>
        
        <span class="c1"># Molar volume of liquid N2 at 77K is approximately 34.65 cm^3/mol</span>
        <span class="c1"># Using the ideal gas law to convert V_ads (STP) to moles</span>
        <span class="n">R</span> <span class="o">=</span> <span class="mf">8.314</span> <span class="c1"># J/(mol·K)</span>
        <span class="c1"># Convert V_ads from cm^3 to m^3 for unit consistency (1 m^3 = 1,000,000 cm^3)</span>
        <span class="n">V_ads_m3</span> <span class="o">=</span> <span class="n">V_ads</span> <span class="o">/</span> <span class="mf">1e6</span>
        
        <span class="c1"># Molar volume of gas at STP (273.15K, 101325Pa)</span>
        <span class="n">V_gas_STP</span> <span class="o">=</span> <span class="mf">22.414e-3</span> <span class="c1"># m^3/mol</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">V_ads_m3</span> <span class="o">/</span> <span class="n">V_gas_STP</span> <span class="c1"># moles</span>
        
        <span class="c1"># Calculate V_liq using the formula V_liq = n * Vm</span>
        <span class="n">V_liq</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">Vm</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">)</span> <span class="c1"># m^3/g</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Pore Volume Calculation ---&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Volume of gas adsorbed (V_ads): </span><span class="si">{</span><span class="n">V_ads</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> cm^3/g STP&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total Pore Volume (V_liq): </span><span class="si">{</span><span class="n">V_liq</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2"> m^3/g&quot;</span><span class="p">)</span>
        <span class="n">results</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;pore_volume&#39;</span><span class="p">:</span> <span class="n">V_liq</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">results</span>
        
    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;pore_radius_calculations&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">total_surface_area</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: &#39;total_surface_area&#39; (St) is required to calculate pore radius. Please run &#39;calculate_surface_area&#39; first.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># A more direct approach is to have the user pass the V_liq</span>
        <span class="c1"># For this function, let&#39;s assume V_liq is passed or calculated within.</span>
        <span class="k">if</span> <span class="s1">&#39;pore_volume&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="n">pore_volume</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: Pore volume calculation must be performed first.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1">#V_liq_final = df[&#39;pore_volume&#39;].iloc[-1]</span>

        <span class="n">V_liq_final</span><span class="o">=</span><span class="n">pore_volume</span> 
        
        <span class="c1"># rp = 2 * V_liq / S</span>
        <span class="n">r_p</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">V_liq_final</span><span class="p">)</span> <span class="o">/</span> <span class="n">total_surface_area</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Pore Radius Calculation ---&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total Pore Volume (V_liq): </span><span class="si">{</span><span class="n">V_liq_final</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2"> m^3/g&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total Surface Area (S): </span><span class="si">{</span><span class="n">total_surface_area</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> m^2&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Average Pore Radius (r_p): </span><span class="si">{</span><span class="n">r_p</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1e9</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> nm&quot;</span><span class="p">)</span>

        <span class="n">results</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;pore_radius_nm&#39;</span><span class="p">:</span> <span class="n">r_p</span> <span class="o">*</span> <span class="mf">1e9</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">results</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Application &#39;</span><span class="si">{</span><span class="n">application</span><span class="si">}</span><span class="s2">&#39; is not supported.&quot;</span><span class="p">)</span></div>









<span class="c1"># ---- Reader (same as before) ----</span>
<div class="viewcode-block" id="read_msa">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.read_msa">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">read_msa</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">energy</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">data_section</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#SPECTRUM&quot;</span><span class="p">):</span>
                <span class="n">data_section</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">data_section</span> <span class="ow">and</span> <span class="n">line</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">):</span>
                <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">energy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                    <span class="n">counts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">energy</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span></div>



<span class="c1"># Characteristic X-ray line energies (keV) – simplified reference values</span>
<span class="n">EDS_element_lines</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="mf">0.277</span><span class="p">,</span>   <span class="c1"># Kα</span>
    <span class="s2">&quot;N&quot;</span><span class="p">:</span> <span class="mf">0.392</span><span class="p">,</span>   <span class="c1"># Kα</span>
    <span class="s2">&quot;O&quot;</span><span class="p">:</span> <span class="mf">0.525</span><span class="p">,</span>   <span class="c1"># Kα</span>
    <span class="s2">&quot;F&quot;</span><span class="p">:</span> <span class="mf">0.677</span><span class="p">,</span>   <span class="c1"># Kα</span>
    <span class="s2">&quot;Na&quot;</span><span class="p">:</span> <span class="mf">1.041</span><span class="p">,</span>  <span class="c1"># Kα</span>
    <span class="s2">&quot;Mg&quot;</span><span class="p">:</span> <span class="mf">1.254</span><span class="p">,</span>  <span class="c1"># Kα</span>
    <span class="s2">&quot;Al&quot;</span><span class="p">:</span> <span class="mf">1.486</span><span class="p">,</span>  <span class="c1"># Kα</span>
    <span class="s2">&quot;Si&quot;</span><span class="p">:</span> <span class="mf">1.740</span><span class="p">,</span>  <span class="c1"># Kα</span>
    <span class="s2">&quot;P&quot;</span><span class="p">:</span> <span class="mf">2.013</span><span class="p">,</span>   <span class="c1"># Kα</span>
    <span class="s2">&quot;S&quot;</span><span class="p">:</span> <span class="mf">2.307</span><span class="p">,</span>   <span class="c1"># Kα</span>
    <span class="s2">&quot;Cl&quot;</span><span class="p">:</span> <span class="mf">2.622</span><span class="p">,</span>  <span class="c1"># Kα</span>
    <span class="s2">&quot;K&quot;</span><span class="p">:</span> <span class="mf">3.312</span><span class="p">,</span>   <span class="c1"># Kα</span>
    <span class="s2">&quot;Ca&quot;</span><span class="p">:</span> <span class="mf">3.690</span><span class="p">,</span>  <span class="c1"># Kα</span>
    <span class="s2">&quot;Ti&quot;</span><span class="p">:</span> <span class="mf">4.508</span><span class="p">,</span>  <span class="c1"># Kα</span>
    <span class="s2">&quot;V&quot;</span><span class="p">:</span> <span class="mf">4.952</span><span class="p">,</span>   <span class="c1"># Kα</span>
    <span class="s2">&quot;Cr&quot;</span><span class="p">:</span> <span class="mf">5.414</span><span class="p">,</span>  <span class="c1"># Kα</span>
    <span class="s2">&quot;Mn&quot;</span><span class="p">:</span> <span class="mf">5.899</span><span class="p">,</span>  <span class="c1"># Kα</span>
    <span class="s2">&quot;Fe&quot;</span><span class="p">:</span> <span class="mf">6.404</span><span class="p">,</span>  <span class="c1"># Kα</span>
    <span class="s2">&quot;Co&quot;</span><span class="p">:</span> <span class="mf">6.930</span><span class="p">,</span>  <span class="c1"># Kα</span>
    <span class="s2">&quot;Ni&quot;</span><span class="p">:</span> <span class="mf">7.471</span><span class="p">,</span>  <span class="c1"># Kα</span>
    <span class="s2">&quot;Cu&quot;</span><span class="p">:</span> <span class="mf">8.041</span><span class="p">,</span>  <span class="c1"># Kα</span>
    <span class="s2">&quot;Zn&quot;</span><span class="p">:</span> <span class="mf">8.638</span><span class="p">,</span>  <span class="c1"># Kα</span>
    <span class="s2">&quot;Zr&quot;</span><span class="p">:</span> <span class="mf">15.775</span><span class="p">,</span> <span class="c1"># Kα</span>
    <span class="s2">&quot;Ag&quot;</span><span class="p">:</span> <span class="mf">22.162</span><span class="p">,</span> <span class="c1"># Kα</span>
    <span class="s2">&quot;Sn&quot;</span><span class="p">:</span> <span class="mf">25.271</span><span class="p">,</span> <span class="c1"># Kα</span>
    <span class="s2">&quot;Au&quot;</span><span class="p">:</span> <span class="mf">9.713</span><span class="p">,</span>  <span class="c1"># Mα (often observed in SEM)</span>
    <span class="s2">&quot;Pb&quot;</span><span class="p">:</span> <span class="mf">10.55</span><span class="p">,</span>  <span class="c1"># Mα</span>
<span class="p">}</span>

<span class="c1"># Atomic weights (IUPAC 2019, rounded)</span>
<span class="n">EDS_atomic_weights</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="mf">12.01</span><span class="p">,</span>
    <span class="s2">&quot;N&quot;</span><span class="p">:</span> <span class="mf">14.01</span><span class="p">,</span>
    <span class="s2">&quot;O&quot;</span><span class="p">:</span> <span class="mf">16.00</span><span class="p">,</span>
    <span class="s2">&quot;F&quot;</span><span class="p">:</span> <span class="mf">19.00</span><span class="p">,</span>
    <span class="s2">&quot;Na&quot;</span><span class="p">:</span> <span class="mf">22.99</span><span class="p">,</span>
    <span class="s2">&quot;Mg&quot;</span><span class="p">:</span> <span class="mf">24.31</span><span class="p">,</span>
    <span class="s2">&quot;Al&quot;</span><span class="p">:</span> <span class="mf">26.98</span><span class="p">,</span>
    <span class="s2">&quot;Si&quot;</span><span class="p">:</span> <span class="mf">28.09</span><span class="p">,</span>
    <span class="s2">&quot;P&quot;</span><span class="p">:</span> <span class="mf">30.97</span><span class="p">,</span>
    <span class="s2">&quot;S&quot;</span><span class="p">:</span> <span class="mf">32.06</span><span class="p">,</span>
    <span class="s2">&quot;Cl&quot;</span><span class="p">:</span> <span class="mf">35.45</span><span class="p">,</span>
    <span class="s2">&quot;K&quot;</span><span class="p">:</span> <span class="mf">39.10</span><span class="p">,</span>
    <span class="s2">&quot;Ca&quot;</span><span class="p">:</span> <span class="mf">40.08</span><span class="p">,</span>
    <span class="s2">&quot;Ti&quot;</span><span class="p">:</span> <span class="mf">47.87</span><span class="p">,</span>
    <span class="s2">&quot;V&quot;</span><span class="p">:</span> <span class="mf">50.94</span><span class="p">,</span>
    <span class="s2">&quot;Cr&quot;</span><span class="p">:</span> <span class="mf">52.00</span><span class="p">,</span>
    <span class="s2">&quot;Mn&quot;</span><span class="p">:</span> <span class="mf">54.94</span><span class="p">,</span>
    <span class="s2">&quot;Fe&quot;</span><span class="p">:</span> <span class="mf">55.85</span><span class="p">,</span>
    <span class="s2">&quot;Co&quot;</span><span class="p">:</span> <span class="mf">58.93</span><span class="p">,</span>
    <span class="s2">&quot;Ni&quot;</span><span class="p">:</span> <span class="mf">58.69</span><span class="p">,</span>
    <span class="s2">&quot;Cu&quot;</span><span class="p">:</span> <span class="mf">63.55</span><span class="p">,</span>
    <span class="s2">&quot;Zn&quot;</span><span class="p">:</span> <span class="mf">65.38</span><span class="p">,</span>
    <span class="s2">&quot;Zr&quot;</span><span class="p">:</span> <span class="mf">91.22</span><span class="p">,</span>
    <span class="s2">&quot;Ag&quot;</span><span class="p">:</span> <span class="mf">107.87</span><span class="p">,</span>
    <span class="s2">&quot;Sn&quot;</span><span class="p">:</span> <span class="mf">118.71</span><span class="p">,</span>
    <span class="s2">&quot;Au&quot;</span><span class="p">:</span> <span class="mf">196.97</span><span class="p">,</span>
    <span class="s2">&quot;Pb&quot;</span><span class="p">:</span> <span class="mf">207.2</span><span class="p">,</span>
<span class="p">}</span>


<div class="viewcode-block" id="EDS_Analysis">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.EDS_Analysis">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">EDS_Analysis</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">application</span><span class="p">,</span> <span class="n">elements</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">,</span><span class="s2">&quot;O&quot;</span><span class="p">,</span><span class="s2">&quot;Fe&quot;</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform analysis on Energy Dispersive X-ray Spectroscopy (EDS) data.</span>

<span class="sd">    This function can plot the EDS spectrum, return raw data, quantify elemental composition,</span>
<span class="sd">    or detect peaks in the spectrum.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    file_path : str</span>
<span class="sd">        Path to the EDS data file in `.msa` format.</span>
<span class="sd">    application : str</span>
<span class="sd">        Mode of operation:</span>
<span class="sd">        - &#39;plot&#39; : Plot the EDS spectrum.</span>
<span class="sd">        - &#39;data&#39; : Return raw energy and counts arrays.</span>
<span class="sd">        - &#39;quantify&#39; : Estimate elemental weight and atomic percentages.</span>
<span class="sd">        - &#39;find_peak&#39; : Detect peaks in the spectrum and plot them.</span>
<span class="sd">    elements : list of str, optional</span>
<span class="sd">        List of elements to quantify when application=&#39;quantify&#39;. Default is [&quot;C&quot;,&quot;O&quot;,&quot;Fe&quot;].</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    varies</span>
<span class="sd">        - If application=&#39;data&#39; : tuple (energy, counts) as numpy arrays.</span>
<span class="sd">        - If application=&#39;quantify&#39; : dict with keys:</span>
<span class="sd">            - &#39;weight_percent&#39; : dict of elements and their weight percentages</span>
<span class="sd">            - &#39;atomic_percent&#39; : dict of elements and their atomic percentages</span>
<span class="sd">        - If application=&#39;find_peak&#39; : list of tuples [(energy_keV, counts), ...] for detected peaks.</span>
<span class="sd">        - If application=&#39;plot&#39; : None (displays plot only).</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If the &#39;application&#39; argument is not one of &#39;plot&#39;, &#39;data&#39;, &#39;quantify&#39;, or &#39;find_peak&#39;.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    # 1. Plot the EDS spectrum</span>
<span class="sd">    &gt;&gt;&gt; EDS_Analysis(&quot;sample.msa&quot;, application=&#39;plot&#39;)</span>

<span class="sd">    # 2. Get raw energy and counts data</span>
<span class="sd">    &gt;&gt;&gt; energy, counts = EDS_Analysis(&quot;sample.msa&quot;, application=&#39;data&#39;)</span>

<span class="sd">    # 3. Quantify elemental composition</span>
<span class="sd">    &gt;&gt;&gt; results = EDS_Analysis(&quot;sample.msa&quot;, application=&#39;quantify&#39;, elements=[&quot;C&quot;,&quot;O&quot;,&quot;Fe&quot;])</span>
<span class="sd">    &gt;&gt;&gt; results[&#39;weight_percent&#39;]</span>
<span class="sd">    {&#39;C&#39;: 12.3, &#39;O&#39;: 30.1, &#39;Fe&#39;: 57.6}</span>
<span class="sd">    &gt;&gt;&gt; results[&#39;atomic_percent&#39;]</span>
<span class="sd">    {&#39;C&#39;: 35.2, &#39;O&#39;: 40.8, &#39;Fe&#39;: 24.0}</span>

<span class="sd">    # 4. Find and plot peaks</span>
<span class="sd">    &gt;&gt;&gt; peaks = EDS_Analysis(&quot;sample.msa&quot;, application=&#39;find_peak&#39;)</span>
<span class="sd">    &gt;&gt;&gt; peaks</span>
<span class="sd">    [(0.28, 100), (0.53, 250), (6.40, 1200)]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">energy</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">read_msa</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;plot&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">energy</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Energy (keV)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Counts (Intensity)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;EDS Spectrum&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">energy</span><span class="p">,</span> <span class="n">counts</span>

    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;quantify&#39;</span><span class="p">:</span>
        <span class="n">intensities</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
            <span class="n">peak_e</span> <span class="o">=</span> <span class="n">EDS_element_lines</span><span class="p">[</span><span class="n">el</span><span class="p">]</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">energy</span> <span class="o">&gt;</span> <span class="n">peak_e</span> <span class="o">-</span> <span class="mf">0.05</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">energy</span> <span class="o">&lt;</span> <span class="n">peak_e</span> <span class="o">+</span> <span class="mf">0.05</span><span class="p">)</span>
            <span class="n">intensities</span><span class="p">[</span><span class="n">el</span><span class="p">]</span> <span class="o">=</span>  <span class="n">counts</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        
        <span class="c1"># --- Placeholder ZAF factors ---</span>
        <span class="n">zaf_factors</span> <span class="o">=</span> <span class="p">{</span><span class="n">el</span><span class="p">:</span> <span class="mf">1.0</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">}</span>
        <span class="n">corrected</span> <span class="o">=</span> <span class="p">{</span><span class="n">el</span><span class="p">:</span> <span class="n">intensities</span><span class="p">[</span><span class="n">el</span><span class="p">]</span> <span class="o">*</span> <span class="n">zaf_factors</span><span class="p">[</span><span class="n">el</span><span class="p">]</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">}</span>
        
        <span class="c1"># --- Normalize to weight % ---</span>
        <span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">corrected</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">corrected</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span>
        <span class="n">weight_percent</span> <span class="o">=</span> <span class="p">{</span><span class="n">el</span><span class="p">:</span> <span class="p">(</span><span class="n">val</span><span class="o">/</span><span class="n">total</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span> <span class="k">for</span> <span class="n">el</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">corrected</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        
        <span class="c1"># --- Convert to atomic % ---</span>
        <span class="n">mols</span> <span class="o">=</span> <span class="p">{</span><span class="n">el</span><span class="p">:</span> <span class="n">weight_percent</span><span class="p">[</span><span class="n">el</span><span class="p">]</span><span class="o">/</span><span class="n">EDS_atomic_weights</span><span class="p">[</span><span class="n">el</span><span class="p">]</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">}</span>
        <span class="n">total_mol</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">mols</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">mols</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span>
        <span class="n">atomic_percent</span> <span class="o">=</span> <span class="p">{</span><span class="n">el</span><span class="p">:</span> <span class="p">(</span><span class="n">val</span><span class="o">/</span><span class="n">total_mol</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span> <span class="k">for</span> <span class="n">el</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">mols</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">wt</span><span class="o">=</span><span class="n">weight_percent</span>
        <span class="n">at</span><span class="o">=</span><span class="n">atomic_percent</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;weight_percent&quot;</span><span class="p">:</span> <span class="n">wt</span><span class="p">,</span> <span class="s2">&quot;atomic_percent&quot;</span><span class="p">:</span> <span class="n">at</span><span class="p">}</span>

    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;find_peak&#39;</span><span class="p">:</span>
        <span class="c1"># Use scipy to find peaks</span>
        <span class="n">peaks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span><span class="o">*</span><span class="mf">0.05</span><span class="p">)</span>  <span class="c1"># &gt;5% of max</span>
        <span class="n">peak_positions</span> <span class="o">=</span> <span class="n">energy</span><span class="p">[</span><span class="n">peaks</span><span class="p">]</span>
        <span class="n">peak_heights</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="n">peaks</span><span class="p">]</span>

        <span class="c1"># Plot peaks</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">energy</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">peak_positions</span><span class="p">,</span> <span class="n">peak_heights</span><span class="p">,</span> <span class="s2">&quot;rx&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Detected Peaks&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Energy (keV)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Counts (Intensity)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;EDS Spectrum with Peaks&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="c1"># Return peak list</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">peak_positions</span><span class="p">,</span> <span class="n">peak_heights</span><span class="p">))</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid application. Use &#39;plot&#39;, &#39;data&#39;, &#39;quantify&#39;, or &#39;find_peak&#39;.&quot;</span><span class="p">)</span></div>












<span class="c1"># Reference binding energies for elements (expand as needed)</span>
<span class="n">ELEMENT_BINDING_ENERGIES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;C 1s&#39;</span><span class="p">:</span> <span class="mf">285.0</span><span class="p">,</span>
    <span class="s1">&#39;O 1s&#39;</span><span class="p">:</span> <span class="mf">532.0</span><span class="p">,</span>
    <span class="s1">&#39;Ti 2p&#39;</span><span class="p">:</span> <span class="mf">458.5</span><span class="p">,</span>
    <span class="s1">&#39;Mo 3d&#39;</span><span class="p">:</span> <span class="mf">232.0</span><span class="p">,</span>
    <span class="s1">&#39;S 2p&#39;</span><span class="p">:</span> <span class="mf">164.0</span><span class="p">,</span>
<span class="p">}</span>

<div class="viewcode-block" id="XPS_Analysis">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.XPS_Analysis">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">XPS_Analysis</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">application</span><span class="o">=</span><span class="s1">&#39;plot&#39;</span><span class="p">,</span> <span class="n">sensitivity_factors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
                 <span class="n">peak_prominence</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">peak_distance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">smoothing_window</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">smoothing_poly</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform X-ray Photoelectron Spectroscopy (XPS) data analysis.</span>

<span class="sd">    This function allows for plotting the XPS spectrum, returning raw data, performing</span>
<span class="sd">    surface composition analysis based on sensitivity factors, and detecting peaks with optional smoothing.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pd.DataFrame</span>
<span class="sd">        XPS data containing columns &#39;eV&#39; (binding energy) and &#39;Counts / s&#39; (intensity).</span>
<span class="sd">    application : str, optional</span>
<span class="sd">        Mode of operation (default=&#39;plot&#39;):</span>
<span class="sd">        - &#39;plot&#39; : Plot the XPS spectrum.</span>
<span class="sd">        - &#39;data&#39; : Return raw energy and counts arrays.</span>
<span class="sd">        - &#39;composition&#39; : Estimate atomic composition using peak areas and sensitivity factors.</span>
<span class="sd">        - &#39;peak_detection&#39; : Detect peaks, optionally smooth the spectrum, and plot.</span>
<span class="sd">    sensitivity_factors : dict, optional</span>
<span class="sd">        Element-specific sensitivity factors required for &#39;composition&#39; application.</span>
<span class="sd">        Example: {&#39;C&#39;: 1.0, &#39;O&#39;: 2.93, &#39;Fe&#39;: 3.5}</span>
<span class="sd">    tolerance : float, optional</span>
<span class="sd">        Binding energy tolerance in eV for peak assignment (default=1.5 eV).</span>
<span class="sd">    peak_prominence : float, optional</span>
<span class="sd">        Minimum prominence of peaks for detection (used in &#39;composition&#39; and &#39;peak_detection&#39;).</span>
<span class="sd">    peak_distance : int, optional</span>
<span class="sd">        Minimum distance between peaks in number of points (used in &#39;composition&#39; and &#39;peak_detection&#39;).</span>
<span class="sd">    smoothing_window : int, optional</span>
<span class="sd">        Window length for Savitzky-Golay smoothing (must be odd, default=11).</span>
<span class="sd">    smoothing_poly : int, optional</span>
<span class="sd">        Polynomial order for Savitzky-Golay smoothing (default=3).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    varies</span>
<span class="sd">        - If application=&#39;plot&#39; : None (displays plot only)</span>
<span class="sd">        - If application=&#39;data&#39; : tuple (energy, counts) as numpy arrays</span>
<span class="sd">        - If application=&#39;composition&#39; : dict of atomic percentages {element: atomic %}</span>
<span class="sd">        - If application=&#39;peak_detection&#39; : list of dicts with peak information, e.g.</span>
<span class="sd">          [{&#39;energy&#39;: eV, &#39;counts&#39;: intensity, &#39;smoothed_counts&#39;: value, </span>
<span class="sd">            &#39;width&#39;: FWHM, &#39;start_energy&#39;: eV_start, &#39;end_energy&#39;: eV_end}, ...]</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        - If &#39;df&#39; does not contain required columns</span>
<span class="sd">        - If &#39;application&#39; is invalid</span>
<span class="sd">        - If sensitivity_factors are not provided for &#39;composition&#39;</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    # 1. Plot XPS spectrum</span>
<span class="sd">    &gt;&gt;&gt; XPS_Analysis(df, application=&#39;plot&#39;)</span>

<span class="sd">    # 2. Get raw data</span>
<span class="sd">    &gt;&gt;&gt; energy, counts = XPS_Analysis(df, application=&#39;data&#39;)</span>

<span class="sd">    # 3. Compute atomic composition</span>
<span class="sd">    &gt;&gt;&gt; sensitivity_factors = {&#39;C&#39;: 1.0, &#39;O&#39;: 2.93, &#39;Fe&#39;: 3.5}</span>
<span class="sd">    &gt;&gt;&gt; composition = XPS_Analysis(df, application=&#39;composition&#39;, sensitivity_factors=sensitivity_factors)</span>
<span class="sd">    &gt;&gt;&gt; composition</span>
<span class="sd">    {&#39;C&#39;: 45.3, &#39;O&#39;: 32.1, &#39;Fe&#39;: 22.6}</span>

<span class="sd">    # 4. Detect peaks and plot</span>
<span class="sd">    &gt;&gt;&gt; peaks_info = XPS_Analysis(df, application=&#39;peak_detection&#39;, peak_prominence=50, smoothing_window=11)</span>
<span class="sd">    &gt;&gt;&gt; peaks_info[0]</span>
<span class="sd">    {&#39;energy&#39;: 284.8, &#39;counts&#39;: 1200, &#39;smoothed_counts&#39;: 1185, &#39;width&#39;: 1.2, &#39;start_energy&#39;: 284.0, &#39;end_energy&#39;: 285.6}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;eV&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">or</span> <span class="s1">&#39;Counts / s&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;DataFrame must contain &#39;eV&#39; and &#39;Counts / s&#39; columns&quot;</span><span class="p">)</span>
    
    <span class="n">energy</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;eV&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Counts / s&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    
    <span class="k">if</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;plot&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">energy</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Binding Energy (eV)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Counts / s&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;XPS Spectrum&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span>
    
    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">energy</span><span class="p">,</span> <span class="n">counts</span>
    
    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;composition&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sensitivity_factors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Sensitivity factors must be provided&quot;</span><span class="p">)</span>
        
        <span class="c1"># Find peaks</span>
        <span class="n">peaks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="n">peak_prominence</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="n">peak_distance</span><span class="p">)</span>
        <span class="n">peak_energies</span> <span class="o">=</span> <span class="n">energy</span><span class="p">[</span><span class="n">peaks</span><span class="p">]</span>
        <span class="n">peak_counts</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="n">peaks</span><span class="p">]</span>
        
        <span class="c1"># Assign peaks to elements</span>
        <span class="n">assigned_peaks</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">elem</span><span class="p">,</span> <span class="n">ref_energy</span> <span class="ow">in</span> <span class="n">ELEMENT_BINDING_ENERGIES</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">matched</span> <span class="o">=</span> <span class="p">[(</span><span class="n">e</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">peak_energies</span><span class="p">,</span> <span class="n">peak_counts</span><span class="p">)</span>
                       <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">e</span> <span class="o">-</span> <span class="n">ref_energy</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tolerance</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">matched</span><span class="p">:</span>
                <span class="n">areas</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">e_peak</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">matched</span><span class="p">:</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">energy</span> <span class="o">&gt;=</span> <span class="n">e_peak</span> <span class="o">-</span> <span class="n">tolerance</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">energy</span> <span class="o">&lt;=</span> <span class="n">e_peak</span> <span class="o">+</span> <span class="n">tolerance</span><span class="p">)</span>
                    <span class="n">area</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">energy</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
                    <span class="n">areas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">area</span><span class="p">)</span>
                <span class="n">assigned_peaks</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">areas</span><span class="p">)</span> <span class="o">/</span> <span class="n">sensitivity_factors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        
        <span class="n">total_corrected</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">assigned_peaks</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">atomic_percentages</span> <span class="o">=</span> <span class="p">{</span><span class="n">elem</span><span class="p">:</span> <span class="p">(</span><span class="n">area</span><span class="o">/</span><span class="n">total_corrected</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span> <span class="k">for</span> <span class="n">elem</span><span class="p">,</span> <span class="n">area</span> <span class="ow">in</span> <span class="n">assigned_peaks</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">return</span> <span class="n">atomic_percentages</span>
    
    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;peak_detection&#39;</span><span class="p">:</span>
        <span class="c1"># Smooth spectrum</span>
        <span class="n">smoothed_counts</span> <span class="o">=</span> <span class="n">savgol_filter</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">window_length</span><span class="o">=</span><span class="n">smoothing_window</span><span class="p">,</span> <span class="n">polyorder</span><span class="o">=</span><span class="n">smoothing_poly</span><span class="p">)</span>
        
        <span class="c1"># Detect peaks</span>
        <span class="n">peaks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">smoothed_counts</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="n">peak_prominence</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="n">peak_distance</span><span class="p">)</span>
        <span class="n">widths_result</span> <span class="o">=</span> <span class="n">peak_widths</span><span class="p">(</span><span class="n">smoothed_counts</span><span class="p">,</span> <span class="n">peaks</span><span class="p">,</span> <span class="n">rel_height</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        
        <span class="c1"># Collect peak info</span>
        <span class="n">peaks_info</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">peaks</span><span class="p">):</span>
            <span class="n">peak_dict</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;energy&#39;</span><span class="p">:</span> <span class="n">energy</span><span class="p">[</span><span class="n">p</span><span class="p">],</span>
                <span class="s1">&#39;counts&#39;</span><span class="p">:</span> <span class="n">counts</span><span class="p">[</span><span class="n">p</span><span class="p">],</span>
                <span class="s1">&#39;smoothed_counts&#39;</span><span class="p">:</span> <span class="n">smoothed_counts</span><span class="p">[</span><span class="n">p</span><span class="p">],</span>
                <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="n">widths_result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;start_energy&#39;</span><span class="p">:</span> <span class="n">energy</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">widths_result</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">])],</span>
                <span class="s1">&#39;end_energy&#39;</span><span class="p">:</span> <span class="n">energy</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">widths_result</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">])]</span>
            <span class="p">}</span>
            <span class="n">peaks_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">peak_dict</span><span class="p">)</span>
        
        <span class="c1"># Plot spectrum with detected peaks</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">energy</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Raw Spectrum&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">energy</span><span class="p">,</span> <span class="n">smoothed_counts</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Smoothed Spectrum&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">energy</span><span class="p">[</span><span class="n">peaks</span><span class="p">],</span> <span class="n">smoothed_counts</span><span class="p">[</span><span class="n">peaks</span><span class="p">],</span> <span class="s1">&#39;rx&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Detected Peaks&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Binding Energy (eV)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Counts / s&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;XPS Spectrum with Detected Peaks&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="n">peaks_info</span>
    
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid application. Use &#39;plot&#39;, &#39;data&#39;, &#39;composition&#39;, or &#39;peak_detection&#39;.&quot;</span><span class="p">)</span></div>










<span class="c1"># Physical constants</span>
<span class="n">h</span> <span class="o">=</span> <span class="mf">6.62607015e-34</span>  <span class="c1"># Planck constant (J·s)</span>
<span class="n">c</span> <span class="o">=</span> <span class="mf">3e8</span>             <span class="c1"># Speed of light (m/s)</span>
<span class="n">e</span> <span class="o">=</span> <span class="mf">1.602176634e-19</span> <span class="c1"># Electron charge (J/eV)</span>

<div class="viewcode-block" id="Photoluminescence_analysis">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.Photoluminescence_analysis">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Photoluminescence_analysis</span><span class="p">(</span><span class="n">data_frame</span><span class="p">,</span> <span class="n">application</span><span class="o">=</span><span class="s2">&quot;plot&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform photoluminescence (PL) data analysis and visualization.</span>

<span class="sd">    This function analyzes a PL spectrum, identifies the main emission peak, </span>
<span class="sd">    calculates bandgap energy, estimates FWHM, and provides various plots.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data_frame : pd.DataFrame</span>
<span class="sd">        DataFrame containing PL spectrum data with columns:</span>
<span class="sd">        - &#39;wavelength&#39; : wavelength in nanometers (nm)</span>
<span class="sd">        - &#39;intensity&#39; : emission intensity (arbitrary units)</span>
<span class="sd">    application : str, optional</span>
<span class="sd">        Specifies the type of analysis or visualization (default=&#39;plot&#39;):</span>
<span class="sd">        - &#39;plot&#39; : Plot the full PL spectrum.</span>
<span class="sd">        - &#39;peak_position&#39; : Identify and return the wavelength of the main peak.</span>
<span class="sd">        - &#39;peak_intensity&#39; : Identify and return the intensity of the main peak.</span>
<span class="sd">        - &#39;bandgap_energy&#39; : Calculate bandgap energy (eV) from the peak wavelength.</span>
<span class="sd">        - &#39;fwhm&#39; : Calculate and return the full width at half maximum (FWHM) in nm.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    varies</span>
<span class="sd">        - &#39;plot&#39; : None (displays a plot)</span>
<span class="sd">        - &#39;peak_position&#39; : float, wavelength of main peak in nm</span>
<span class="sd">        - &#39;peak_intensity&#39; : float, intensity of main peak</span>
<span class="sd">        - &#39;bandgap_energy&#39; : float, bandgap energy in eV</span>
<span class="sd">        - &#39;fwhm&#39; : float, full width at half maximum in nm</span>
<span class="sd">        - {} : empty dictionary if no peak is detected or invalid application</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        - If the DataFrame does not contain required columns.</span>
<span class="sd">        - If an invalid application string is provided.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - Bandgap energy is calculated using Eg = h*c / λ, where:</span>
<span class="sd">        h : Planck constant (J·s)</span>
<span class="sd">        c : speed of light (m/s)</span>
<span class="sd">        λ : peak wavelength (m)</span>
<span class="sd">        e : elementary charge (C)</span>
<span class="sd">    - FWHM is estimated using linear interpolation and root-finding.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    # 1. Plot PL spectrum</span>
<span class="sd">    &gt;&gt;&gt; Photoluminescence_analysis(df, application=&quot;plot&quot;)</span>

<span class="sd">    # 2. Get peak wavelength</span>
<span class="sd">    &gt;&gt;&gt; peak_wl = Photoluminescence_analysis(df, application=&quot;peak_position&quot;)</span>
<span class="sd">    &gt;&gt;&gt; print(f&quot;Peak wavelength: {peak_wl:.2f} nm&quot;)</span>

<span class="sd">    # 3. Get peak intensity</span>
<span class="sd">    &gt;&gt;&gt; peak_int = Photoluminescence_analysis(df, application=&quot;peak_intensity&quot;)</span>
<span class="sd">    &gt;&gt;&gt; print(f&quot;Peak intensity: {peak_int:.3f}&quot;)</span>

<span class="sd">    # 4. Calculate bandgap energy</span>
<span class="sd">    &gt;&gt;&gt; Eg = Photoluminescence_analysis(df, application=&quot;bandgap_energy&quot;)</span>
<span class="sd">    &gt;&gt;&gt; print(f&quot;Bandgap: {Eg:.3f} eV&quot;)</span>

<span class="sd">    # 5. Calculate FWHM</span>
<span class="sd">    &gt;&gt;&gt; fwhm = Photoluminescence_analysis(df, application=&quot;fwhm&quot;)</span>
<span class="sd">    &gt;&gt;&gt; print(f&quot;FWHM: {fwhm:.2f} nm&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">wavelength</span> <span class="o">=</span> <span class="n">data_frame</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">intensity</span> <span class="o">=</span> <span class="n">data_frame</span><span class="p">[</span><span class="s1">&#39;intensity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

    <span class="c1"># Find main peak</span>
    <span class="n">peaks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">intensity</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No clear peak detected.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{}</span>
    <span class="n">main_peak_idx</span> <span class="o">=</span> <span class="n">peaks</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">intensity</span><span class="p">[</span><span class="n">peaks</span><span class="p">])]</span>
    <span class="n">peak_wavelength</span> <span class="o">=</span> <span class="n">wavelength</span><span class="p">[</span><span class="n">main_peak_idx</span><span class="p">]</span>
    <span class="n">peak_intensity</span> <span class="o">=</span> <span class="n">intensity</span><span class="p">[</span><span class="n">main_peak_idx</span><span class="p">]</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;peak_wavelength_nm&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">peak_wavelength</span><span class="p">),</span>
        <span class="s2">&quot;peak_intensity&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">peak_intensity</span><span class="p">),</span>
        <span class="s2">&quot;bandgap_energy_eV&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;fwhm_nm&quot;</span><span class="p">:</span> <span class="kc">None</span>
    <span class="p">}</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">intensity</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;PL Spectrum&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;plot&quot;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Photoluminescence Spectrum&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Wavelength (nm)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Intensity (a.u.)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        

    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;peak_position&quot;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">peak_wavelength</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> 
                    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Peak = </span><span class="si">{</span><span class="n">peak_wavelength</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> nm&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;PL Spectrum - Peak Position&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Wavelength (nm)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Intensity (a.u.)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;peak_wavelength_nm&#39;</span><span class="p">]</span>

    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;peak_intensity&quot;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">peak_intensity</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> 
                    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Peak Intensity = </span><span class="si">{</span><span class="n">peak_intensity</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">peak_wavelength</span><span class="p">,</span> <span class="n">peak_intensity</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;PL Spectrum - Peak Intensity&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Wavelength (nm)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Intensity (a.u.)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;peak_intensity&#39;</span><span class="p">]</span>

    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;bandgap_energy&quot;</span><span class="p">:</span>
        <span class="n">Eg</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span> <span class="o">*</span> <span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">peak_wavelength</span> <span class="o">*</span> <span class="mf">1e-9</span><span class="p">)</span> <span class="o">/</span> <span class="n">e</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;bandgap_energy_eV&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">Eg</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">peak_wavelength</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;purple&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> 
                    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Eg ≈ </span><span class="si">{</span><span class="n">Eg</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> eV&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;PL Spectrum - Bandgap Energy&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Wavelength (nm)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Intensity (a.u.)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;bandgap_energy_eV&#39;</span><span class="p">]</span>

    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;fwhm&quot;</span><span class="p">:</span>
        <span class="n">half_max</span> <span class="o">=</span> <span class="n">peak_intensity</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">f_interp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">intensity</span> <span class="o">-</span> <span class="n">half_max</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;extrapolate&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">left</span> <span class="o">=</span> <span class="n">brentq</span><span class="p">(</span><span class="n">f_interp</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">peak_wavelength</span><span class="p">)</span>
            <span class="n">right</span> <span class="o">=</span> <span class="n">brentq</span><span class="p">(</span><span class="n">f_interp</span><span class="p">,</span> <span class="n">peak_wavelength</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">fwhm</span> <span class="o">=</span> <span class="n">right</span> <span class="o">-</span> <span class="n">left</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;fwhm_nm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">fwhm</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">half_max</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> 
                        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;FWHM = </span><span class="si">{</span><span class="n">fwhm</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> nm&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="s2">&quot;FWHM not found&quot;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;PL Spectrum - FWHM&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Wavelength (nm)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Intensity (a.u.)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;fwhm_nm&#39;</span><span class="p">]</span>


    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid application. Choose from: &#39;plot&#39;, &#39;peak_position&#39;, &#39;peak_intensity&#39;, &#39;bandgap_energy&#39;, &#39;fwhm&#39;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{}</span></div>









<div class="viewcode-block" id="Dynamic_Light_Scattering_Analysis">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.Dynamic_Light_Scattering_Analysis">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Dynamic_Light_Scattering_Analysis</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">application</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Analyze and visualize Dynamic Light Scattering (DLS) data.</span>

<span class="sd">    This function provides professional plotting of DLS data and</span>
<span class="sd">    extraction of key metrics such as the particle size corresponding</span>
<span class="sd">    to the maximum intensity.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pandas.DataFrame</span>
<span class="sd">        Input DataFrame containing DLS data. Expected columns include:</span>
<span class="sd">        - &#39;Size (nm)&#39; : Particle size in nanometers</span>
<span class="sd">        - &#39;Intensity (%)&#39; : Corresponding intensity in percentage</span>
<span class="sd">        - &#39;Lag time (µs)&#39; : Lag time for autocorrelation measurements</span>
<span class="sd">        - &#39;Autocorrelation&#39; : Autocorrelation function values</span>
<span class="sd">    application : str, optional</span>
<span class="sd">        Type of analysis to perform:</span>
<span class="sd">        - &#39;plot&#39; : Generate professional plots based on available columns.</span>
<span class="sd">            - If &#39;Size (nm)&#39; and &#39;Intensity (%)&#39; exist, plots Intensity vs Size.</span>
<span class="sd">            - If &#39;Lag time (µs)&#39; and &#39;Autocorrelation&#39; exist, plots Autocorrelation vs Lag time.</span>
<span class="sd">        - &#39;max_intensity&#39; : Returns the particle size corresponding to maximum intensity.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict or None</span>
<span class="sd">        - If `application=&#39;max_intensity&#39;`:</span>
<span class="sd">            Dictionary with keys:</span>
<span class="sd">            - &quot;Peak Size (nm)&quot; : particle size at maximum intensity</span>
<span class="sd">            - &quot;Peak Intensity (%)&quot; : intensity at that size</span>
<span class="sd">        - If `application=&#39;plot&#39;` or None, returns None and displays plots.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        - If required columns are missing for the selected application.</span>
<span class="sd">        - If `application` is invalid (not &#39;plot&#39; or &#39;max_intensity&#39;).</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    # 1. Plot DLS Intensity vs Size</span>
<span class="sd">    &gt;&gt;&gt; Dynamic_Light_Scattering_Analysis(df, application=&quot;plot&quot;)</span>

<span class="sd">    # 2. Plot Autocorrelation vs Lag time</span>
<span class="sd">    &gt;&gt;&gt; Dynamic_Light_Scattering_Analysis(df_with_autocorr, application=&quot;plot&quot;)</span>

<span class="sd">    # 3. Get particle size at maximum intensity</span>
<span class="sd">    &gt;&gt;&gt; result = Dynamic_Light_Scattering_Analysis(df, application=&quot;max_intensity&quot;)</span>
<span class="sd">    &gt;&gt;&gt; print(result)</span>
<span class="sd">    {&#39;Peak Size (nm)&#39;: 120.5, &#39;Peak Intensity (%)&#39;: 85.2}</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;plot&quot;</span><span class="p">:</span>
        
        <span class="c1"># Set professional style</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;whitegrid&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="s2">&quot;talk&quot;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;deep&quot;</span><span class="p">)</span>

        <span class="c1"># Plot Intensity vs Size</span>
        <span class="k">if</span> <span class="s1">&#39;Intensity (%)&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="s1">&#39;Size (nm)&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Size (nm)&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Intensity (%)&#39;</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Size (nm)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Intensity (%)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Dynamic Light Scattering: Intensity vs Size&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="c1"># Plot Autocorrelation vs Lag time</span>
        <span class="k">elif</span> <span class="s1">&#39;Lag time (µs)&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="s1">&#39;Autocorrelation&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Lag time (µs)&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Autocorrelation&#39;</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:orange&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Lag time (µs)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Autocorrelation&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Dynamic Light Scattering: Autocorrelation vs Lag time&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DataFrame columns not recognized for plotting.&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;max_intensity&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;Intensity (%)&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="s1">&#39;Size (nm)&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">max_idx</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Intensity (%)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
            <span class="n">peak_size</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">max_idx</span><span class="p">,</span> <span class="s1">&#39;Size (nm)&#39;</span><span class="p">]</span>
            <span class="n">peak_intensity</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">max_idx</span><span class="p">,</span> <span class="s1">&#39;Intensity (%)&#39;</span><span class="p">]</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;Peak Size (nm)&quot;</span><span class="p">:</span> <span class="n">peak_size</span><span class="p">,</span> <span class="s2">&quot;Peak Intensity (%)&quot;</span><span class="p">:</span> <span class="n">peak_intensity</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DataFrame must contain &#39;Size (nm)&#39; and &#39;Intensity (%)&#39; columns for max_intensity.&quot;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid application. Use &#39;plot&#39; or &#39;max_intensity&#39;.&quot;</span><span class="p">)</span></div>








<div class="viewcode-block" id="Auger_Electron_Spectroscopy_analysis">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.Auger_Electron_Spectroscopy_analysis">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Auger_Electron_Spectroscopy_analysis</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">application</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sensitivity_factors</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Analyze and visualize Auger Electron Spectroscopy (AES) data.</span>

<span class="sd">    This function provides options to plot AES spectra, detect peak positions, </span>
<span class="sd">    and estimate atomic percentages using sensitivity factors.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pandas.DataFrame</span>
<span class="sd">        Input DataFrame containing AES data. Must include columns:</span>
<span class="sd">        - &#39;Energy (eV)&#39; : Electron energy values in eV</span>
<span class="sd">        - &#39;Intensity (Counts)&#39; : Corresponding measured intensity</span>
<span class="sd">    application : str, optional</span>
<span class="sd">        Type of analysis to perform:</span>
<span class="sd">        - &#39;plot&#39; : Generates a professional plot of Intensity vs Energy.</span>
<span class="sd">        - &#39;peak_position&#39; : Detects peaks and returns their energy positions and intensities.</span>
<span class="sd">        - &#39;atomic&#39; : Calculates atomic percentages based on provided sensitivity factors.</span>
<span class="sd">    sensitivity_factors : dict, optional</span>
<span class="sd">        Dictionary mapping element symbols to their sensitivity factors.</span>
<span class="sd">        Example: {&#39;C&#39;: 0.25, &#39;O&#39;: 0.66, &#39;Fe&#39;: 2.5}.</span>
<span class="sd">        Required if `application=&#39;atomic&#39;`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict or list or None</span>
<span class="sd">        - If `application=&#39;plot&#39;` : None (displays plot)</span>
<span class="sd">        - If `application=&#39;peak_position&#39;` : dict with keys:</span>
<span class="sd">            - &quot;Peak Positions (eV)&quot; : numpy array of peak energies</span>
<span class="sd">            - &quot;Peak Intensities (Counts)&quot; : numpy array of peak intensities</span>
<span class="sd">        - If `application=&#39;atomic&#39;` : list of dicts for each element, e.g.:</span>
<span class="sd">            [{&quot;Element&quot;: &quot;C&quot;, &quot;Atomic %&quot;: 25.4}, {&quot;Element&quot;: &quot;O&quot;, &quot;Atomic %&quot;: 74.6}]</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If `application=&#39;atomic&#39;` and `sensitivity_factors` is not provided.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    # 1. Plot AES spectrum</span>
<span class="sd">    &gt;&gt;&gt; Auger_Electron_Spectroscopy_analysis(df, application=&#39;plot&#39;)</span>

<span class="sd">    # 2. Detect peak positions</span>
<span class="sd">    &gt;&gt;&gt; peaks = Auger_Electron_Spectroscopy_analysis(df, application=&#39;peak_position&#39;)</span>
<span class="sd">    &gt;&gt;&gt; print(peaks)</span>
<span class="sd">    {&#39;Peak Positions (eV)&#39;: array([280, 530]), &#39;Peak Intensities (Counts)&#39;: array([150, 200])}</span>

<span class="sd">    # 3. Estimate atomic composition</span>
<span class="sd">    &gt;&gt;&gt; sensitivity = {&#39;C&#39;: 0.25, &#39;O&#39;: 0.66, &#39;Fe&#39;: 2.5}</span>
<span class="sd">    &gt;&gt;&gt; composition = Auger_Electron_Spectroscopy_analysis(df, application=&#39;atomic&#39;, sensitivity_factors=sensitivity)</span>
<span class="sd">    &gt;&gt;&gt; print(composition)</span>
<span class="sd">    [{&#39;Element&#39;: &#39;C&#39;, &#39;Atomic %&#39;: 30.5}, {&#39;Element&#39;: &#39;O&#39;, &#39;Atomic %&#39;: 69.5}]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;plot&quot;</span><span class="p">:</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;whitegrid&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="s2">&quot;talk&quot;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;deep&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Energy (eV)&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Intensity (Counts)&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:blue&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.8</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Energy (eV)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Intensity (Counts)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;AES Spectrum: Energy vs Intensity&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;peak_position&quot;</span><span class="p">:</span>
        <span class="c1"># Detect peaks</span>
        <span class="n">peaks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Intensity (Counts)&#39;</span><span class="p">],</span> <span class="n">height</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Intensity (Counts)&#39;</span><span class="p">]))</span>
        <span class="n">peak_positions</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Energy (eV)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">peaks</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">peak_intensities</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Intensity (Counts)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">peaks</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;Peak Positions (eV)&quot;</span><span class="p">:</span> <span class="n">peak_positions</span><span class="p">,</span>
            <span class="s2">&quot;Peak Intensities (Counts)&quot;</span><span class="p">:</span> <span class="n">peak_intensities</span>
        <span class="p">}</span>

    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s2">&quot;atomic&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sensitivity_factors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please provide sensitivity_factors dictionary for atomic analysis.&quot;</span><span class="p">)</span>

        <span class="c1"># Detect peaks (areas approximation by trapezoidal integration around peaks)</span>
        <span class="n">peaks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Intensity (Counts)&#39;</span><span class="p">],</span> <span class="n">height</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Intensity (Counts)&#39;</span><span class="p">]))</span>
        <span class="n">peak_positions</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Energy (eV)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">peaks</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">peak_intensities</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Intensity (Counts)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">peaks</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">corrected_areas</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">total</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="c1"># Loop through elements in sensitivity_factors and assign peaks (user maps manually in real AES)</span>
        <span class="k">for</span> <span class="n">element</span><span class="p">,</span> <span class="n">S</span> <span class="ow">in</span> <span class="n">sensitivity_factors</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Approximate peak area (here we just use intensity, could integrate around peak in real analysis)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">peak_intensities</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">A</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">peak_intensities</span><span class="p">)</span>  <span class="c1"># simplified peak area ~ max intensity</span>
                <span class="n">corrected_area</span> <span class="o">=</span> <span class="n">A</span> <span class="o">/</span> <span class="n">S</span>
                <span class="n">corrected_areas</span><span class="p">[</span><span class="n">element</span><span class="p">]</span> <span class="o">=</span> <span class="n">corrected_area</span>
                <span class="n">total</span> <span class="o">+=</span> <span class="n">corrected_area</span>

        <span class="c1"># Calculate atomic percentages</span>
        <span class="k">for</span> <span class="n">element</span><span class="p">,</span> <span class="n">corrected_area</span> <span class="ow">in</span> <span class="n">corrected_areas</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">Ci</span> <span class="o">=</span> <span class="p">(</span><span class="n">corrected_area</span> <span class="o">/</span> <span class="n">total</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span> <span class="k">if</span> <span class="n">total</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;Element&quot;</span><span class="p">:</span> <span class="n">element</span><span class="p">,</span> <span class="s2">&quot;Atomic %&quot;</span><span class="p">:</span> <span class="n">Ci</span><span class="p">})</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid application. Use &#39;plot&#39;, &#39;peak_position&#39;, or &#39;atomic&#39;.&quot;</span><span class="p">)</span></div>






<span class="c1">#================================================================</span>
<span class="c1">#================================================================</span>
<span class="c1">#================================================================</span>
<span class="c1">#================================================================</span>
<span class="c1">#================================================================</span>
<span class="c1">#================================================================</span>
<span class="c1">#================================================================</span>
<span class="c1">#================================================================</span>





<div class="viewcode-block" id="Tensile_Analysis">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.Tensile_Analysis">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Tensile_Analysis</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">gauge_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                           <span class="n">application</span><span class="o">=</span><span class="s1">&#39;plot-force&#39;</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters:</span>
<span class="sd">    - dataframe: raw data from Excel (Force vs Displacement)</span>
<span class="sd">    - gauge_length: Initial length of the sample in mm</span>
<span class="sd">    - width: Width of the sample in mm</span>
<span class="sd">    - thickness: Thickness of the sample in mm</span>
<span class="sd">    - application: &#39;plot-force&#39; or &#39;plot-stress&#39;</span>
<span class="sd">    - save: True to save the plot</span>
<span class="sd">    - show_peaks: True to annotate peaks (e.g. UTS)</span>
<span class="sd">    - fname: Filename to save if save=True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dataframe</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="s1">&#39;1 _ 1&#39;</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">dataframe</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="s1">&#39;Unnamed: 3&#39;</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">dataframe</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">dataframe</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">dataframe</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


    <span class="n">d2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dataframe</span><span class="p">)</span>
    <span class="n">d2</span><span class="o">=</span><span class="n">d2</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    
    <span class="n">force</span> <span class="o">=</span> <span class="n">d2</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>       <span class="c1"># in N</span>
    <span class="n">displacement</span> <span class="o">=</span> <span class="n">d2</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># in mm</span>

    <span class="c1"># Cross-sectional Area (mm²)</span>
    <span class="n">area</span> <span class="o">=</span> <span class="n">width</span> <span class="o">*</span> <span class="n">thickness</span>

    <span class="c1"># Compute strain and stress</span>
    <span class="n">strain</span> <span class="o">=</span> <span class="n">displacement</span> <span class="o">/</span> <span class="nb">int</span><span class="p">(</span><span class="n">gauge_length</span><span class="p">)</span>
    <span class="n">stress</span> <span class="o">=</span> <span class="n">force</span> <span class="o">/</span> <span class="nb">int</span><span class="p">(</span><span class="n">area</span><span class="p">)</span>  <span class="c1"># in MPa</span>

    <span class="c1"># Plotting</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.dpi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">600</span>

    <span class="k">if</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;plot-force&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">displacement</span><span class="p">,</span> <span class="n">force</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Force vs Displacement&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Displacement (mm)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Force (N)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Tensile Test - Force vs Displacement&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">save</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;stress_strain&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;eps&#39;</span><span class="p">)</span>
        
        
    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;plot-stress&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">strain</span><span class="p">,</span> <span class="n">stress</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Stress vs Strain&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Strain&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Stress (MPa)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Tensile Test - Stress vs Strain&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">save</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;stress_strain&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;eps&#39;</span><span class="p">)</span>


    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;UTS&#39;</span> <span class="p">:</span>
        <span class="n">uts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">stress</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ultimate Tensile Strength (UTS): </span><span class="si">{</span><span class="n">uts</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MPa&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">uts</span>
        
    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;Young Modulus&#39;</span><span class="p">:</span>
        <span class="n">linear_region</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">strain</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">)</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">strain</span><span class="p">[:</span><span class="n">linear_region</span><span class="p">],</span> <span class="n">stress</span><span class="p">[:</span><span class="n">linear_region</span><span class="p">],</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Young’s Modulus (E): </span><span class="si">{</span><span class="n">E</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MPa&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">E</span>

        
    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;Fracture Stress&#39;</span><span class="p">:</span>
        
        <span class="n">stress_at_break</span> <span class="o">=</span> <span class="n">stress</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fracture Stress: </span><span class="si">{</span><span class="n">stress_at_break</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MPa&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">stress_at_break</span>
        
    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;Strain at break&#39;</span><span class="p">:</span>
       
        <span class="n">strain_at_break</span> <span class="o">=</span> <span class="n">strain</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Strain at Break: </span><span class="si">{</span><span class="n">strain_at_break</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">strain_at_break</span></div>

    
    


<div class="viewcode-block" id="FtirAnalysis">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.FtirAnalysis">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">FtirAnalysis</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">application</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters:</span>
<span class="sd">    - dataframe: pandas.DataFrame</span>
<span class="sd">        Raw FTIR data (expects one column with tab-separated values &#39;X Y&#39;).</span>
<span class="sd">    - application: str</span>
<span class="sd">        One of [&#39;plot&#39;, &#39;peak&#39;].</span>
<span class="sd">        &#39;plot&#39; will generate an FTIR plot.</span>
<span class="sd">        &#39;peak&#39; will detect and return peak positions and properties.</span>
<span class="sd">    - prominence: float, default=0.5</span>
<span class="sd">        Required prominence of peaks (used in peak detection).</span>
<span class="sd">    - distance: int, default=10</span>
<span class="sd">        Minimum horizontal distance (in number of samples) between peaks.</span>
<span class="sd">    - save: bool, default=False</span>
<span class="sd">        If True, save the generated plot.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">xValues</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">yValues</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="p">)):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;X</span><span class="se">\t</span><span class="s1">Y&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">xValues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">yValues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;plot&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.dpi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">600</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xValues</span><span class="p">,</span> <span class="n">yValues</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;FTIR Result&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Wavenumber (cm⁻¹)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Transmittance (a.u.)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">4000</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;ftir&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;eps&#39;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;peak&#39;</span><span class="p">:</span>
        <span class="n">peaks</span><span class="p">,</span> <span class="n">properties</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">yValues</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="n">prominence</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="n">distance</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">peaks</span><span class="p">,</span> <span class="n">properties</span></div>




   
    
<div class="viewcode-block" id="FTIR">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.FTIR">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">FTIR</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span><span class="n">application</span><span class="p">,</span><span class="n">prominence</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    OLD Version V1.00</span>


<span class="sd">    &#39;&#39;&#39;</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    xx=[]</span>
<span class="sd">    yy=[]</span>
<span class="sd">    for i in range(0,len(data1)):</span>
<span class="sd">        b=data1[&#39;X\tY&#39;][i].split()</span>
<span class="sd">        xx.append(float(b[0]))</span>
<span class="sd">        yy.append(float(b[1]))</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">    if application==&#39;plot&#39;:</span>
<span class="sd">    </span>
<span class="sd">        plt.figure(figsize=(10, 6))  # Set the figure size (width: 10 inches, height: 6 inches)</span>
<span class="sd">        plt.rcParams[&quot;figure.dpi&quot;] = 600 </span>
<span class="sd">        plt.plot(xx,yy,c=&#39;k&#39;)</span>
<span class="sd">        plt.title(&#39;FTIR Result&#39;,size=20)</span>
<span class="sd">        plt.xlabel(&#39;Wavenumber (cm-1)&#39;)</span>
<span class="sd">        plt.ylabel(&#39;Transmitance(a.u.&#39;)</span>
<span class="sd">        plt.xlim(4000,400)</span>
<span class="sd">        plt.ylim(28,40)</span>
<span class="sd">        #plt.invert_xaxis()</span>
<span class="sd">        ax=plt.gca()</span>
<span class="sd">        ax.tick_params(axis=&#39;both&#39;,which=&#39;both&#39;,direction=&#39;in&#39;,bottom=True,top=False,left=True,right=False)</span>
<span class="sd">        plt.show()</span>
<span class="sd">        </span>
<span class="sd">        if save==True:</span>
<span class="sd">            plt.savefig(&#39;ftir&#39;,dpi=600,format=&#39;eps&#39;)</span>
<span class="sd">    </span>
<span class="sd">    elif application==&#39;peak&#39;:</span>
<span class="sd">        peaks, properties = find_peaks(yy, prominence=prominence, distance=distance)</span>
<span class="sd">        </span>
<span class="sd">        return peaks, properties</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: This function is deprecated. Please use &quot;FtirAnalysis&quot; instead.&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span></div>

        
    


<div class="viewcode-block" id="XrdZno">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.XrdZno">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">XrdZno</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">application</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters:</span>
<span class="sd">    - dataframe: pandas.DataFrame</span>
<span class="sd">        Data containing XRD data. Expected columns: [&#39;Angle&#39;, &#39;Det1Disc1&#39;].</span>
<span class="sd">    - application: str</span>
<span class="sd">        One of [&#39;plot&#39;, &#39;FWHM&#39;, &#39;Scherrer&#39;].</span>
<span class="sd">        &#39;plot&#39;      → Draw the XRD pattern.</span>
<span class="sd">        &#39;FWHM&#39;      → Calculate Full Width at Half Maximum.</span>
<span class="sd">        &#39;Scherrer&#39;  → Calculate crystallite size using Scherrer equation.</span>

<span class="sd">    Returns:</span>
<span class="sd">    - float or None</span>
<span class="sd">        Returns FWHM (float) if application=&#39;FWHM&#39;.</span>
<span class="sd">        Returns crystallite size (float) if application=&#39;Scherrer&#39;.</span>
<span class="sd">        Returns None if application=&#39;plot&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;Angle&#39;</span><span class="p">])</span>
    <span class="n">intensities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;Det1Disc1&#39;</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;plot&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">intensities</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;XRD Pattern&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;2θ (degrees)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Intensity&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">application</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;FWHM&#39;</span><span class="p">,</span> <span class="s1">&#39;Scherrer&#39;</span><span class="p">]:</span>
        <span class="n">maxIntensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">intensities</span><span class="p">)</span>
        <span class="n">halfMax</span> <span class="o">=</span> <span class="n">maxIntensity</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">intensities</span><span class="p">)</span> <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;=</span> <span class="n">halfMax</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">leftIndex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
            <span class="n">rightIndex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
            <span class="n">fwhm</span> <span class="o">=</span> <span class="n">angles</span><span class="p">[</span><span class="n">rightIndex</span><span class="p">]</span> <span class="o">-</span> <span class="n">angles</span><span class="p">[</span><span class="n">leftIndex</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;FWHM&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">fwhm</span>

            <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;Scherrer&#39;</span><span class="p">:</span>
                <span class="n">mean2theta</span> <span class="o">=</span> <span class="n">angles</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="n">mean2theta</span> <span class="o">/</span> <span class="mi">2</span>

                <span class="n">fwhmRad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">fwhm</span><span class="p">)</span>
                <span class="n">thetaRad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>

                <span class="n">crystalSize</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.9</span> <span class="o">*</span> <span class="mf">1.5406</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">fwhmRad</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">thetaRad</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">crystalSize</span></div>



    
<div class="viewcode-block" id="XRD_ZnO">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.XRD_ZnO">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">XRD_ZnO</span><span class="p">(</span><span class="n">XRD</span><span class="p">,</span><span class="n">application</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    </span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    XRD : DataFrame</span>
<span class="sd">        Data containing XRD data.</span>
<span class="sd">    application : str</span>
<span class="sd">        Type of application &#39;plot&#39;,&#39;FWHM&#39;,&#39;Scherrer&#39;.</span>
<span class="sd">        plot:To draw the figure.</span>
<span class="sd">        FWHM:Width at Half Maximum.</span>
<span class="sd">        Scherrer:To calculate the crystallite size.</span>

<span class="sd">    Returns</span>
<span class="sd">    FWHM,Scherrer</span>
<span class="sd">    -------</span>
<span class="sd">    None.</span>

<span class="sd">    &#39;&#39;&#39;</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Angles=np.array(XRD[&#39;Angle&#39;])</span>
<span class="sd">    Intensities=np.array(XRD[&#39;Det1Disc1&#39;])</span>
<span class="sd">    if  application==&#39;plot&#39;:</span>
<span class="sd">        plt.plot(Angles,Intensities,c=&#39;red&#39;)</span>
<span class="sd">        plt.title(&#39;XRD Pattern&#39;)</span>
<span class="sd">        plt.xlabel(&#39;2theta (degrees)&#39;)</span>
<span class="sd">        plt.ylabel(&#39;Intensity&#39;)</span>
<span class="sd">        plt.show()</span>
<span class="sd">    elif application in [&#39;FWHM&#39;, &#39;Scherrer&#39;]:</span>
<span class="sd">        max_intensity = np.max(Intensities)</span>
<span class="sd">        half_max = max_intensity / 2</span>
<span class="sd">        indices = []</span>
<span class="sd">        half_max = max_intensity / 2</span>
<span class="sd">        for i in range(len(Intensities)):</span>
<span class="sd">           if Intensities[i] &gt;= half_max:</span>
<span class="sd">               indices.append(i)</span>

<span class="sd">        </span>
<span class="sd">        if len(indices) &gt; 0:</span>
<span class="sd">            left_index = np.min(indices)</span>
<span class="sd">            right_index = np.max(indices)</span>
<span class="sd">       </span>
<span class="sd">    </span>
<span class="sd">            FWHM = Angles[right_index] - Angles[left_index]</span>
<span class="sd">            if application == &#39;FWHM&#39;:</span>
<span class="sd">                return FWHM</span>
<span class="sd">           </span>
<span class="sd">            elif application ==&#39;Scherrer&#39;:</span>
<span class="sd">                mean_2theta = Angles[indices].mean()</span>


<span class="sd">                theta = mean_2theta / 2</span>
<span class="sd">                FWHM_rad = ((3.14/180)*FWHM)</span>
<span class="sd">                theta_rad = ((3.14/180)*theta)  </span>
<span class="sd">                crystal_size = (0.9 * 1.5406) / (FWHM_rad * np.cos(theta_rad))</span>
<span class="sd">                </span>
<span class="sd">                return crystal_size</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: This function is deprecated. Please use &quot;XrdZno&quot; instead.&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span></div>



    
    
<div class="viewcode-block" id="PressureVolumeIdealGases">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.PressureVolumeIdealGases">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">PressureVolumeIdealGases</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">application</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters:</span>
<span class="sd">    - dataframe: pandas.DataFrame</span>
<span class="sd">        Must contain &#39;pressure&#39; and &#39;volume&#39; columns.</span>
<span class="sd">    - application: str</span>
<span class="sd">        One of [&#39;plot&#39;, &#39;min pressure&#39;, &#39;max pressure&#39;, &#39;min volume&#39;, </span>
<span class="sd">                &#39;max volume&#39;, &#39;average pressure&#39;, &#39;average volume&#39;, &#39;temperature&#39;].</span>

<span class="sd">    Returns:</span>
<span class="sd">    - float, pandas.Series, or None</span>
<span class="sd">        Depending on the selected application.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;plot&#39;</span><span class="p">:</span>
        <span class="n">pressure</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;pressure&#39;</span><span class="p">]</span>
        <span class="n">volume</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">volume</span><span class="p">,</span> <span class="n">pressure</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Volume-Pressure Chart&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Volume&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pressure&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;min pressure&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;pressure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;max pressure&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;pressure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;min volume&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;max volume&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;average pressure&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;pressure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;average volume&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;temperature&#39;</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">R</span> <span class="o">=</span> <span class="mf">0.821</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;pressure&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="n">R</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid application selected.&quot;</span><span class="p">)</span></div>



    
    
    
    
<div class="viewcode-block" id="EnergieAnalysis">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.EnergieAnalysis">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">EnergieAnalysis</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">application</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters:</span>
<span class="sd">    - dataframe: pandas.DataFrame</span>
<span class="sd">        Must contain motor energy data with columns </span>
<span class="sd">        [&#39;Angle[°]&#39;, &#39;Energie&#39;, &#39;Power[mW]&#39;, &#39;Time for a Cycle&#39;].</span>
<span class="sd">    - application: str</span>
<span class="sd">        One of [&#39;draw&#39;, &#39;calculate&#39;].</span>
<span class="sd">        &#39;draw&#39;      → Plot energy vs angle.</span>
<span class="sd">        &#39;calculate&#39; → Calculate total consumption energy in Ws.</span>

<span class="sd">    Returns:</span>
<span class="sd">    - float or None</span>
<span class="sd">        Energy consumption in Ws if application=&#39;calculate&#39;.</span>
<span class="sd">        None if application=&#39;draw&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;plot&#39;</span><span class="p">:</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;Angle[°]&#39;</span><span class="p">]</span>
        <span class="n">energy</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;Energie&#39;</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Energy of OTT Motor (185000 Cycles)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Angle [°]&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Consumption Energy&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;calculate&#39;</span><span class="p">:</span>
        <span class="n">dataframe</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[[</span><span class="s1">&#39;Angle[°]&#39;</span><span class="p">,</span> <span class="s1">&#39;Power[mW]&#39;</span><span class="p">,</span> <span class="s1">&#39;Time for a Cycle&#39;</span><span class="p">,</span> <span class="s1">&#39;Energie&#39;</span><span class="p">]]</span>
        <span class="n">summ</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;Energie&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">summ</span> <span class="o">=</span> <span class="p">(</span><span class="n">summ</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span>  <span class="c1"># Convert to Ws</span>
        <span class="k">return</span> <span class="n">summ</span></div>








<div class="viewcode-block" id="Stress_Strain1">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.Stress_Strain1">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Stress_Strain1</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">operation</span><span class="p">,</span><span class="n">L0</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span><span class="n">D0</span><span class="o">=</span><span class="mi">9</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    This function gets data and an operation .</span>
<span class="sd">    It plots Stress-Strain curve if the oepration is plot </span>
<span class="sd">    and finds the UTS value (which is the ultimate tensile strength) otherwise.</span>
<span class="sd">    ------------------------------</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : DataFrame</span>
<span class="sd">       It has 2 columns: DL(which is length in mm) &amp; F (which is the force in N).</span>
<span class="sd">    operation :</span>
<span class="sd">       It tells the function to whether PLOT the curve or find the UTS valu. </span>
<span class="sd">       </span>
<span class="sd">     L0: initial length of the sample</span>
<span class="sd">     D0: initial diameter of the sample</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    The Stress-Strain curve or the amount of UTS</span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">A0</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">D0</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;e&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;DL&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">L0</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;F&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">A0</span>
    <span class="k">if</span> <span class="n">operation</span> <span class="o">==</span> <span class="s1">&#39;PLOT&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;e&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;S vs e Plot&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s1">&#39;UTS&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Please enter proper operation&quot;</span><span class="p">)</span>
        <span class="k">return</span></div>








<div class="viewcode-block" id="Stress_Strain2">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.Stress_Strain2">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Stress_Strain2</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span><span class="n">which</span><span class="p">,</span><span class="n">count</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This function claculates the stress and strain</span>
<span class="sd">    Parameters from load and elongation data</span>
<span class="sd">    ----------</span>
<span class="sd">    input_file : .csv format</span>
<span class="sd">        the file must be inserted in csv.</span>
<span class="sd">    whcih : str</span>
<span class="sd">        please say which work we do ( plot or calculate?).</span>
<span class="sd">    count: int</span>
<span class="sd">        please enter the yarn count in Tex</span>
<span class="sd">    remember: gauge length has been set in 250 mm</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1">#convert the file</span>
    <span class="n">mydf</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">which</span><span class="o">==</span><span class="s1">&#39;plot&#39;</span><span class="p">:</span>
       
        <span class="n">stress</span><span class="o">=</span><span class="n">mydf</span><span class="p">[</span><span class="s1">&#39;Load&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">count</span>
        <span class="n">strain</span><span class="o">=</span><span class="n">mydf</span><span class="p">[</span><span class="s1">&#39;Extension&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">250</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">stress</span><span class="p">,</span><span class="n">strain</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;stress-strain curve&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;stress&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;strain&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    
    <span class="k">if</span> <span class="n">which</span><span class="o">==</span><span class="s1">&#39;max stress&#39;</span><span class="p">:</span>
        <span class="n">stress_max</span><span class="o">=</span><span class="n">mydf</span><span class="p">[</span><span class="s1">&#39;stress&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">stress_max</span>

    <span class="k">if</span> <span class="n">which</span><span class="o">==</span><span class="s1">&#39;max strain&#39;</span><span class="p">:</span>
        <span class="n">strain_max</span><span class="o">=</span><span class="n">mydf</span><span class="p">[</span><span class="s1">&#39;strain&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">strain_max</span></div>

    
    
<div class="viewcode-block" id="Stress_Strain3">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.Stress_Strain3">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Stress_Strain3</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
    <span class="n">stress</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;Stress (MPa)&#39;</span><span class="p">]</span>
    <span class="n">strain</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;Strain (%)&#39;</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;plot&#39;</span><span class="p">:</span>
        <span class="c1"># Plotting data</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">strain</span><span class="p">,</span> <span class="n">stress</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;royalblue&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Stress-Strain Curve&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Stress-Strain Curve&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Strain (%)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Stress (MPa)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">strain</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">stress</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
   
    <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;max stress&#39;</span><span class="p">:</span>
        <span class="c1"># Calculation of the maximum stress</span>
        <span class="n">stress_max</span> <span class="o">=</span> <span class="n">stress</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">stress_max</span>
    
    <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;young modulus&#39;</span><span class="p">:</span>
        <span class="c1"># Calculation of Young&#39;s Modulus</span>
        <span class="n">slope_intercept</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">strain</span><span class="p">,</span> <span class="n">stress</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">slope_intercept</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>


<div class="viewcode-block" id="Stress_Strain4">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.Stress_Strain4">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Stress_Strain4</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">D0</span><span class="p">,</span> <span class="n">L0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This function uses the data file</span>
<span class="sd">    that contains length and force, calculates the engineering, true</span>
<span class="sd">    and yielding stress and strain and also draws a graph of these.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    D0(mm): First Qatar to calculate stress</span>
<span class="sd">    L0(mm): First Length to canculate strain</span>
<span class="sd">    F(N): The force applied to the object during this test</span>
<span class="sd">    DL(mm): Length changes</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    Depending on the operation selected,</span>
<span class="sd">    it returns calculated values, plots,</span>
<span class="sd">    advanced analysis, or saves results.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        
    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;File not found. Please check the file path.&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">A0</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">D0</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>

    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;stress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;F (N)&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">A0</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;strain&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;DL (mm)&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">L0</span><span class="p">)</span> <span class="o">/</span> <span class="n">L0</span>

    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;true_stress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;F (N)&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">A0</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;true_strain&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;strain&#39;</span><span class="p">])</span>

    <span class="n">yield_point</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;stress&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()]</span>
    <span class="n">permanent_strain</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;strain&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;strain&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;stress&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Engineering Stress-Strain&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;true_strain&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;true_stress&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;True Stress-Strain&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">yield_point</span><span class="p">[</span><span class="s1">&#39;strain&#39;</span><span class="p">],</span> <span class="n">yield_point</span><span class="p">[</span><span class="s1">&#39;stress&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Yield Point&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Yield Point: Strain=</span><span class="si">{</span><span class="n">yield_point</span><span class="p">[</span><span class="s1">&#39;strain&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, Stress=</span><span class="si">{</span><span class="n">yield_point</span><span class="p">[</span><span class="s1">&#39;stress&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">yield_point</span><span class="p">[</span><span class="s1">&#39;strain&#39;</span><span class="p">],</span> <span class="n">yield_point</span><span class="p">[</span><span class="s1">&#39;stress&#39;</span><span class="p">]),</span> <span class="n">textcoords</span><span class="o">=</span><span class="s2">&quot;offset points&quot;</span><span class="p">,</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Strain&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Stress (MPa)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Stress-Strain Curve&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Columns in the data:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">First few rows of the data:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Yield Point Information:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">yield_point</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Permanent Strain:&quot;</span><span class="p">,</span> <span class="n">permanent_strain</span><span class="p">)</span></div>





<div class="viewcode-block" id="Stress_Strain5">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.Stress_Strain5">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Stress_Strain5</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
    <span class="n">stress</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;Stress (MPa)&#39;</span><span class="p">]</span>
    <span class="n">strain</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;Strain (%)&#39;</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;plot&#39;</span><span class="p">:</span>
        <span class="c1"># Plotting data</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">strain</span><span class="p">,</span> <span class="n">stress</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;royalblue&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Stress-Strain Curve&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Stress-Strain Curve&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Strain (%)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Stress (MPa)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">strain</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">stress</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
   
    <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;max stress&#39;</span><span class="p">:</span>
        <span class="c1"># Calculation of the maximum stress</span>
        <span class="n">stress_max</span> <span class="o">=</span> <span class="n">stress</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">stress_max</span>
    
    <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;young modulus&#39;</span><span class="p">:</span>
        <span class="c1"># Calculation of Young&#39;s Modulus</span>
        <span class="n">slope_intercept</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">strain</span><span class="p">,</span> <span class="n">stress</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">slope_intercept</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>






<div class="viewcode-block" id="Stress_Strain6">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.Stress_Strain6">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Stress_Strain6</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">application</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    this function converts F and dD to Stress and Strain by thickness(1.55mm), width(3.2mm) and parallel length(35mm).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : DataFrame</span>
<span class="sd">        this DataFrame contains F(N) and dD(mm) received from the tensil test machine.</span>
<span class="sd">    application : str</span>
<span class="sd">        application determines the expected output of Stress_Strain function.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    int, float or plot</span>
<span class="sd">        return may be elongation at break, strength or a plot.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">stress</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;F&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mf">1.55</span><span class="o">*</span><span class="mf">3.2</span><span class="p">)])</span>
    <span class="n">strain</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;dD&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">35</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">application</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;ELONGATION AT BREAK&#39;</span><span class="p">:</span>
        <span class="n">elongation_at_break</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">strain</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">elongation_at_break</span><span class="p">,</span><span class="s1">&#39;%&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">elongation_at_break</span>
    <span class="k">elif</span> <span class="n">application</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;STRENGTH&#39;</span><span class="p">:</span>
        <span class="n">strength</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">stress</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">strength</span><span class="p">,</span><span class="s1">&#39;N/mm2&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">strength</span>
    <span class="k">elif</span> <span class="n">application</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;PLOT&#39;</span><span class="p">:</span>
        <span class="n">myfont_title</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span><span class="s1">&#39;sans-serif&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">20</span><span class="p">}</span>
        <span class="n">myfont_lables</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span><span class="s1">&#39;Tahoma&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;green&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">16</span><span class="p">}</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">strain</span><span class="p">,</span><span class="n">stress</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Stress-Strain&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="n">myfont_title</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Strain(%)&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="n">myfont_lables</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Stress(N/mm2)&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="n">myfont_lables</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>




<div class="viewcode-block" id="AerospaceAnalysis">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.AerospaceAnalysis">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">AerospaceAnalysis</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">application</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dataframe : pandas.DataFrame</span>
<span class="sd">        Must contain two columns: [&#39;Newton&#39;, &#39;Area&#39;].</span>
<span class="sd">        Values should be in Newtons (N) and square meters (m²).</span>
<span class="sd">    application : str</span>
<span class="sd">        One of [&#39;plot&#39;, &#39;maxPressure&#39;].</span>
<span class="sd">        &#39;plot&#39;        → Plot Newton vs Area.</span>
<span class="sd">        &#39;maxPressure&#39; → Return maximum pressure value.</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    float or None</span>
<span class="sd">        Maximum pressure if application=&#39;maxPressure&#39;.</span>
<span class="sd">        None if application=&#39;plot&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Ensure proper DataFrame format</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Pressure&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Newton&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Area&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;plot&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Area&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Newton&#39;</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Area (m²)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Force (N)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Force vs Area&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;maxPressure&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Pressure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span></div>




<div class="viewcode-block" id="XRD_Analysis">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.XRD_Analysis">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">XRD_Analysis</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="n">which</span><span class="p">,</span><span class="n">peak</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    </span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    file : str</span>
<span class="sd">        the variable in which you saved the .cvs file path         </span>
<span class="sd">    which : str</span>
<span class="sd">        which operation you want to perform on the file      </span>
<span class="sd">    peak : float, optional</span>
<span class="sd">        2θ for the peak you want to analyse. The default is 0.     </span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fwhm : float</span>
<span class="sd">        value of FWHM for the peak you specified.</span>

<span class="sd">    &#39;&#39;&#39;</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    </span>
<span class="sd">    df=pd.read_csv(file)</span>
<span class="sd">    npar=pd.DataFrame.to_numpy(df)</span>

<span class="sd">    if which==&#39;plot&#39;:</span>
<span class="sd">        angle=df[&#39;angle&#39;]</span>
<span class="sd">        intensity=df[&#39;intensity&#39;]</span>
<span class="sd">        plt.plot(angle,intensity,color=&#39;k&#39;)</span>
<span class="sd">        font_title={&#39;family&#39;:&#39;serif&#39;,&#39;color&#39;:&#39;blue&#39;,&#39;size&#39;:20}</span>
<span class="sd">        plt.title(&#39;XRD pattern&#39;,fontdict=font_title)</span>
<span class="sd">        font_label={&#39;family&#39;:&#39;times new roman&#39;,&#39;color&#39;:&#39;black&#39;,&#39;size&#39;:15}</span>
<span class="sd">        plt.xlabel(&#39;angle (2θ)&#39;,fontdict=font_label)</span>
<span class="sd">        plt.ylabel(&#39;intensity (a.u.)&#39;,fontdict=font_label)</span>
<span class="sd">        plt.grid(axis=&#39;x&#39;,which=&#39;both&#39;)</span>
<span class="sd">        plt.xticks(np.arange(0,max(angle),5))</span>
<span class="sd">        plt.xlim([np.min(npar,axis=0)[0], np.max(npar,axis=0)[0]])</span>
<span class="sd">        plt.yticks([])</span>
<span class="sd">        plt.ylim([0, 1.1*np.max(npar,axis=0)[1]])</span>
<span class="sd">        plt.tick_params(axis=&#39;x&#39;,direction=&#39;in&#39;)</span>
<span class="sd">        plt.show()</span>
<span class="sd">        return None</span>
<span class="sd">    elif which==&#39;fwhm&#39;:</span>
<span class="sd">        diff=int((npar[1,0]-npar[0,0])*1000)/2000</span>
<span class="sd">        for i in range(int(len(npar)/2)+1):</span>
<span class="sd">            if -diff&lt;npar[i,0]-peak&lt;diff:</span>
<span class="sd">                pl=i</span>
<span class="sd">                ph=i</span>
<span class="sd">                p=i</span>
<span class="sd">                break</span>
<span class="sd">        while pl&gt;0:</span>
<span class="sd">            if ((npar[pl,1]-npar[pl-1,1])/(npar[pl-1,1]-npar[pl-2,1]))&gt;1.04 and (npar[pl-1,1]-np.min(npar,axis=0)[1])/(np.max(npar,axis=0)[1]-np.min(npar,axis=0)[1])&lt;0.4:</span>
<span class="sd">                in_low_1=npar[pl-1,1]</span>
<span class="sd">                break</span>
<span class="sd">            pl=pl-1</span>
<span class="sd">        while ph&gt;0:</span>
<span class="sd">            if ((npar[ph+2,1]-npar[ph+1,1])/(npar[ph+1,1]-npar[ph,1]))&lt;0.96 and (npar[ph+1,1]-np.min(npar,axis=0)[1])/(np.max(npar,axis=0)[1]-np.min(npar,axis=0)[1])&lt;0.4:</span>
<span class="sd">                in_low_2=npar[ph+1,1]</span>
<span class="sd">                break</span>
<span class="sd">            ph=ph+1</span>
<span class="sd">        in_low=(in_low_1+in_low_2)/2</span>
<span class="sd">        h=npar[p,1]-in_low</span>
<span class="sd">        hm=in_low+h/2</span>
<span class="sd">        diff_in=[]</span>
<span class="sd">        hm_i=[]</span>
<span class="sd">        for l in range(len(npar)-1):</span>
<span class="sd">            diff_in.append((npar[l+1,1]-npar[l,1])/2)</span>
<span class="sd">        for j in range(2):</span>
<span class="sd">            for k in range(int(len(npar)/2)+1):</span>
<span class="sd">                c=((-1)**j)*k</span>
<span class="sd">                if abs(npar[p+c,1]-hm)&lt;abs(max(diff_in)):</span>
<span class="sd">                    hm_i.append(p+c)</span>
<span class="sd">                    break</span>
<span class="sd">        fwhm=npar[hm_i[0],0]-npar[hm_i[1],0]</span>
<span class="sd">        return fwhm</span>
<span class="sd">    else:</span>
<span class="sd">        print(&#39;The which argument not valid&#39;)</span>
<span class="sd">        return None</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: This function is deprecated. Please use &quot;XrdAnalysis&quot; instead.&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span></div>





<div class="viewcode-block" id="XrdAnalysis">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.XrdAnalysis">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">XrdAnalysis</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">which</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">peak</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform XRD (X-ray Diffraction) analysis on a given DataFrame containing &#39;angle&#39; and &#39;intensity&#39;.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pd.DataFrame</span>
<span class="sd">        A pandas DataFrame with at least two columns: &#39;angle&#39; and &#39;intensity&#39;.</span>
<span class="sd">    which : str</span>
<span class="sd">        Operation to perform on the DataFrame. Options:</span>
<span class="sd">        - &#39;plot&#39; : Plots the XRD pattern.</span>
<span class="sd">        - &#39;fwhm&#39; : Calculates the Full Width at Half Maximum (FWHM) for a given peak.</span>
<span class="sd">    peak : float, optional</span>
<span class="sd">        The 2θ angle of the peak to analyze. Default is 0.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fwhm : float or None</span>
<span class="sd">        - If which == &#39;fwhm&#39;, returns the FWHM value of the specified peak.</span>
<span class="sd">        - If which == &#39;plot&#39;, returns None.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; data = pd.DataFrame({&#39;angle&#39;: [20, 21, 22, 23, 24],</span>
<span class="sd">    ...                      &#39;intensity&#39;: [5, 20, 50, 20, 5]})</span>
<span class="sd">    &gt;&gt;&gt; xrdAnalysis(data, which=&#39;plot&#39;)   # Plots the XRD pattern</span>
<span class="sd">    &gt;&gt;&gt; xrdAnalysis(data, which=&#39;fwhm&#39;, peak=22)</span>
<span class="sd">    0.5</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">npar</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">which</span> <span class="o">==</span> <span class="s1">&#39;plot&#39;</span><span class="p">:</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span>
        <span class="n">intensity</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;intensity&#39;</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">intensity</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="n">font_title</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;serif&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">}</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;XRD pattern&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font_title</span><span class="p">)</span>
        <span class="n">font_label</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;times new roman&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">}</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;angle (2θ)&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font_label</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;intensity (a.u.)&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font_label</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">npar</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">npar</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">npar</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">elif</span> <span class="n">which</span> <span class="o">==</span> <span class="s1">&#39;fwhm&#39;</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">npar</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">npar</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2000</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">npar</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="o">-</span><span class="n">diff</span> <span class="o">&lt;</span> <span class="n">npar</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">peak</span> <span class="o">&lt;</span> <span class="n">diff</span><span class="p">:</span>
                <span class="n">pl</span> <span class="o">=</span> <span class="n">i</span>
                <span class="n">ph</span> <span class="o">=</span> <span class="n">i</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">i</span>
                <span class="k">break</span>
        <span class="k">while</span> <span class="n">pl</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">npar</span><span class="p">[</span><span class="n">pl</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">npar</span><span class="p">[</span><span class="n">pl</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">npar</span><span class="p">[</span><span class="n">pl</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">npar</span><span class="p">[</span><span class="n">pl</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span> <span class="o">&gt;</span> <span class="mf">1.04</span> <span class="ow">and</span> \
               <span class="p">(</span><span class="n">npar</span><span class="p">[</span><span class="n">pl</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">npar</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">npar</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">npar</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">0.4</span><span class="p">:</span>
                <span class="n">in_low_1</span> <span class="o">=</span> <span class="n">npar</span><span class="p">[</span><span class="n">pl</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                <span class="k">break</span>
            <span class="n">pl</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="n">ph</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">npar</span><span class="p">[</span><span class="n">ph</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">npar</span><span class="p">[</span><span class="n">ph</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">npar</span><span class="p">[</span><span class="n">ph</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">npar</span><span class="p">[</span><span class="n">ph</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span> <span class="o">&lt;</span> <span class="mf">0.96</span> <span class="ow">and</span> \
               <span class="p">(</span><span class="n">npar</span><span class="p">[</span><span class="n">ph</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">npar</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">npar</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">npar</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">0.4</span><span class="p">:</span>
                <span class="n">in_low_2</span> <span class="o">=</span> <span class="n">npar</span><span class="p">[</span><span class="n">ph</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                <span class="k">break</span>
            <span class="n">ph</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">in_low</span> <span class="o">=</span> <span class="p">(</span><span class="n">in_low_1</span> <span class="o">+</span> <span class="n">in_low_2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">npar</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">in_low</span>
        <span class="n">hm</span> <span class="o">=</span> <span class="n">in_low</span> <span class="o">+</span> <span class="n">h</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">diff_in</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">hm_i</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">npar</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">diff_in</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">npar</span><span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">npar</span><span class="p">[</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">npar</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">c</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="n">j</span><span class="p">)</span> <span class="o">*</span> <span class="n">k</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">npar</span><span class="p">[</span><span class="n">p</span> <span class="o">+</span> <span class="n">c</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">hm</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">diff_in</span><span class="p">)):</span>
                    <span class="n">hm_i</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span>
                    <span class="k">break</span>
        <span class="n">fwhm</span> <span class="o">=</span> <span class="n">npar</span><span class="p">[</span><span class="n">hm_i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">npar</span><span class="p">[</span><span class="n">hm_i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">fwhm</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid argument for &#39;which&#39;. Use &#39;plot&#39; or &#39;fwhm&#39;.&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="LN_S_E">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.LN_S_E">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">LN_S_E</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">operation</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function analyzes the elastic part of a true stress-strain curve.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pandas.DataFrame</span>
<span class="sd">        Must contain 2 columns:</span>
<span class="sd">        - &#39;DL&#39; : elongation (length change in mm)</span>
<span class="sd">        - &#39;F&#39;  : force in Newtons</span>

<span class="sd">    operation : str</span>
<span class="sd">        - &#39;PLOT&#39; : plots the elastic region of the true stress-strain curve</span>
<span class="sd">        - &#39;YOUNG_MODULUS&#39; : calculates and returns Young&#39;s Modulus (E)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None if operation=&#39;PLOT&#39;</span>
<span class="sd">    float if operation=&#39;YOUNG_MODULUS&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># ---- Material Test Constants ----</span>
    <span class="n">L0</span> <span class="o">=</span> <span class="mi">40</span>  <span class="c1"># initial gauge length (mm)</span>
    <span class="n">D0</span> <span class="o">=</span> <span class="mi">9</span>   <span class="c1"># initial diameter (mm)</span>
    <span class="n">A0</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">D0</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># initial cross-sectional area (mm^2)</span>

    <span class="c1"># ---- Engineering Strain &amp; Stress ----</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;e&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;DL&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">L0</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;F&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">A0</span>

    <span class="c1"># ---- True Strain &amp; True Stress ----</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;eps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;e&#39;</span><span class="p">])</span>      <span class="c1"># true strain</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;sig&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;e&#39;</span><span class="p">])</span>  <span class="c1"># true stress</span>

    <span class="c1"># ---- Select Elastic Region (strain 0.04–0.08) ----</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;eps&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.04</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;eps&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.08</span><span class="p">)</span>
    <span class="n">elastic_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;eps&#39;</span><span class="p">,</span> <span class="s1">&#39;sig&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># ---- Log Transform ----</span>
    <span class="n">elastic_df</span><span class="p">[</span><span class="s1">&#39;ln_eps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">elastic_df</span><span class="p">[</span><span class="s1">&#39;eps&#39;</span><span class="p">])</span>
    <span class="n">elastic_df</span><span class="p">[</span><span class="s1">&#39;ln_sig&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">elastic_df</span><span class="p">[</span><span class="s1">&#39;sig&#39;</span><span class="p">])</span>

    <span class="c1"># ---- Perform Requested Operation ----</span>
    <span class="k">if</span> <span class="n">operation</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;PLOT&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">elastic_df</span><span class="p">[</span><span class="s1">&#39;ln_eps&#39;</span><span class="p">],</span> <span class="n">elastic_df</span><span class="p">[</span><span class="s1">&#39;ln_sig&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Elastic Region&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;ln(eps)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;ln(sig)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Elastic Part of Stress-Strain Curve&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">operation</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;YOUNG_MODULUS&#39;</span><span class="p">:</span>
        <span class="c1"># Fit linear regression to ln(sig) ~ ln(eps)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">elastic_df</span><span class="p">[</span><span class="s1">&#39;ln_eps&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">elastic_df</span><span class="p">[</span><span class="s1">&#39;ln_sig&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="n">intercept</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">intercept_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># log(E)</span>
        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">intercept</span><span class="p">)</span>       <span class="c1"># Young&#39;s modulus in same units</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid operation. Use &#39;PLOT&#39; or &#39;YOUNG_MODULUS&#39;.&quot;</span><span class="p">)</span></div>




<div class="viewcode-block" id="old_LN_S_E">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.old_LN_S_E">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">old_LN_S_E</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">operation</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function analyzes the elastic part of a true stress-strain curve.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pandas.DataFrame</span>
<span class="sd">        Must contain 2 columns:</span>
<span class="sd">        - &#39;DL&#39; : elongation (length change in mm)</span>
<span class="sd">        - &#39;F&#39;  : force in Newtons</span>

<span class="sd">    operation : str</span>
<span class="sd">        - &#39;PLOT&#39; : plots the elastic region of the true stress-strain curve</span>
<span class="sd">        - &#39;YOUNG_MODULUS&#39; : calculates and returns Young&#39;s Modulus (E)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None if operation=&#39;PLOT&#39;</span>
<span class="sd">    float if operation=&#39;YOUNG_MODULUS&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    L0 = 40</span>
<span class="sd">    D0 = 9</span>
<span class="sd">    A0 = math.pi / 4 * (D0 ** 2)</span>
<span class="sd">    df[&#39;e&#39;] = df[&#39;DL&#39;] / L0</span>
<span class="sd">    df[&#39;S&#39;] = df[&#39;F&#39;] / A0</span>
<span class="sd">    df[&#39;eps&#39;] = np.log(1 + df[&#39;e&#39;])</span>
<span class="sd">    df[&#39;sig&#39;] = df[&#39;S&#39;] * (1 + df[&#39;e&#39;])</span>
<span class="sd">    filtered_index = df[(df[&#39;eps&#39;] &gt;= 0.04) &amp; (df[&#39;eps&#39;] &lt;= 0.08)].index</span>
<span class="sd">    &quot;the elastic part of the curve is where the true strain(eps) is from 0.04 to 0.08&quot;</span>

<span class="sd">    df[&#39;selected_ln_eps&#39;] = np.nan</span>

<span class="sd">    df.loc[filtered_index, &#39;selected_ln_eps&#39;] = df.loc[filtered_index, &#39;eps&#39;]</span>
<span class="sd">    df[&#39;selected_ln_eps&#39;] = np.where(~df[&#39;selected_ln_eps&#39;].isna(), np.log(df[&#39;selected_ln_eps&#39;]), df[&#39;selected_ln_eps&#39;])</span>
<span class="sd">    df[&#39;selected_ln_sig&#39;] = np.nan</span>

<span class="sd">    df.loc[filtered_index, &#39;selected_ln_sig&#39;] = df.loc[filtered_index, &#39;sig&#39;]</span>
<span class="sd">    df[&#39;selected_ln_sig&#39;] = np.where(~df[&#39;selected_ln_sig&#39;].isna(), np.log(df[&#39;selected_ln_sig&#39;]), df[&#39;selected_ln_sig&#39;])</span>


<span class="sd">    if operation == &#39;PLOT&#39;:</span>
<span class="sd">        plt.scatter(df[&#39;selected_ln_eps&#39;].dropna(), df[&#39;selected_ln_sig&#39;].dropna())</span>
<span class="sd">        plt.xlabel(&#39;ln_eps&#39;)</span>
<span class="sd">        plt.ylabel(&#39;ln_sig&#39;)</span>
<span class="sd">        plt.title(&#39;ln(sig) vs ln(eps) Plot&#39;)</span>
<span class="sd">        plt.grid(True)</span>
<span class="sd">        plt.show()</span>
<span class="sd">    elif operation == &#39;YOUNG_MODULUS&#39;:</span>
<span class="sd">        X = df[&#39;selected_ln_eps&#39;].dropna().values.reshape(-1, 1)  # Independent variable</span>
<span class="sd">        y = df[&#39;selected_ln_sig&#39;].dropna().values.reshape(-1, 1)  # Dependent variable</span>
<span class="sd">        model = LinearRegression()</span>
<span class="sd">        model.fit(X, y)</span>
<span class="sd">        intercept = model.intercept_[0]</span>
<span class="sd">        return math.exp(intercept)</span>
<span class="sd">        </span>
<span class="sd">    else: </span>
<span class="sd">        print(&quot;Please enter proper operation&quot;)</span>
<span class="sd">        return</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: This function is deprecated. Please use &quot;LN_S_E&quot; instead.&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span></div>






<div class="viewcode-block" id="Oxygen_HeatCapacity_Analysis">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.Oxygen_HeatCapacity_Analysis">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Oxygen_HeatCapacity_Analysis</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate enthalpy and entropy of oxygen from heat capacity data</span>
<span class="sd">    and plot Cp, enthalpy, and entropy versus temperature.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pandas.DataFrame</span>
<span class="sd">        DataFrame containing at least two columns:</span>
<span class="sd">        - &#39;T&#39;: Temperature values</span>
<span class="sd">        - &#39;Cp&#39;: Heat capacity at constant pressure</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.DataFrame</span>
<span class="sd">        Original DataFrame with added &#39;Enthalpy&#39; and &#39;Entropy&#39; columns.</span>
<span class="sd">    Also shows plots of:</span>
<span class="sd">        - Heat capacity vs temperature</span>
<span class="sd">        - Enthalpy and entropy vs temperature</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; df = pd.DataFrame({&#39;T&#39;:[100,200,300],&#39;Cp&#39;:[0.9,1.1,1.3]})</span>
<span class="sd">    &gt;&gt;&gt; Oxygen_HeatCapacity_Analysis(df)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Ensure temperature is sorted</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Calculate enthalpy as cumulative sum of Cp*dT (approximation)</span>
    <span class="n">dT</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Temperature differences</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Enthalpy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Cp&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">dT</span><span class="p">)</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>

    <span class="c1"># Calculate entropy as cumulative sum of Cp/T*dT (numerical approximation)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Entropy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Cp&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">dT</span><span class="p">)</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>

    <span class="c1"># Plotting</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    
    <span class="c1"># Heat capacity vs temperature</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Cp&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Temperature (T)&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Heat Capacity (Cp)&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Heat Capacity vs Temperature&#39;</span><span class="p">)</span>

    <span class="c1"># Enthalpy and entropy vs temperature</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Enthalpy&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Enthalpy&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Entropy&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Entropy&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Temperature (T)&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Enthalpy and Entropy&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Enthalpy and Entropy vs Temperature&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">df</span></div>








<div class="viewcode-block" id="Compression_TestAnalysis">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.Compression_TestAnalysis">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Compression_TestAnalysis</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">operator</span><span class="p">,</span> <span class="n">sample_name</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Analyze compression test data: plot stress-strain curve or calculate maximum strength.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pandas.DataFrame</span>
<span class="sd">        Compression test data containing at least two columns:</span>
<span class="sd">        - &#39;e&#39;: strain</span>
<span class="sd">        - &#39;S (Mpa)&#39;: stress in MPa</span>
<span class="sd">    operator : str</span>
<span class="sd">        Action to perform on data:</span>
<span class="sd">        - &#39;plot&#39;: plots stress-strain diagram</span>
<span class="sd">        - &#39;S_max&#39;: returns maximum stress</span>
<span class="sd">        - &#39;S_max/Density&#39;: returns specific maximum stress (requires density != 0)</span>
<span class="sd">    sample_name : str</span>
<span class="sd">        Name of the sample (used for plot label)</span>
<span class="sd">    density : float, optional</span>
<span class="sd">        Density of the sample (needed for &#39;S_max/Density&#39;). Default is 0.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float or None</span>
<span class="sd">        Maximum stress if operator is &#39;S_max&#39;.</span>
<span class="sd">        Specific maximum stress if operator is &#39;S_max/Density&#39;.</span>
<span class="sd">        None if operator is &#39;plot&#39;.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; df = pd.DataFrame({&#39;e&#39;:[0,0.01,0.02],&#39;S (Mpa)&#39;:[10,20,15]})</span>
<span class="sd">    &gt;&gt;&gt; Compression_TestAnalysis(df, &#39;S_max&#39;, &#39;Sample1&#39;)</span>
<span class="sd">    20</span>
<span class="sd">    &gt;&gt;&gt; Compression_TestAnalysis(df, &#39;plot&#39;, &#39;Sample1&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check required columns exist</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">{</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;S (Mpa)&#39;</span><span class="p">}</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;DataFrame must contain &#39;e&#39; and &#39;S (Mpa)&#39; columns.&quot;</span><span class="p">)</span>

    <span class="n">e</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;e&#39;</span><span class="p">]</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;S (Mpa)&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">operator</span> <span class="o">==</span> <span class="s2">&quot;S_max&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">S</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s2">&quot;S_max/Density&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">density</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Density must be non-zero for &#39;S_max/Density&#39; calculation.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">S</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">/</span> <span class="n">density</span>

    <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s2">&quot;plot&quot;</span><span class="p">:</span>
        <span class="n">font_label</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;Times New Roman&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">}</span>
        <span class="n">font_legend</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;Times New Roman&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">13</span><span class="p">}</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">sample_name</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Strain (e)&quot;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font_label</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Stress (S MPa)&quot;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font_label</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">autoscale</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="n">font_legend</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">spine</span> <span class="ow">in</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">spine</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Operator must be one of &#39;plot&#39;, &#39;S_max&#39;, &#39;S_max/Density&#39;.&quot;</span><span class="p">)</span></div>





<div class="viewcode-block" id="DMTA_TestAnalysis">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.DMTA_TestAnalysis">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">DMTA_TestAnalysis</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">operator</span><span class="p">,</span> <span class="n">sample_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Analyze DMTA test data: find maxima or plot storage modulus, loss modulus, and tanδ.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pandas.DataFrame</span>
<span class="sd">        DMTA test data containing at least these columns:</span>
<span class="sd">        - &#39;Frequency (Hz)&#39;</span>
<span class="sd">        - &quot;E&#39;-Storage Modulus (Mpa)&quot;</span>
<span class="sd">        - Column 13 (loss modulus) or specify proper column</span>
<span class="sd">        - &#39;Tanδ&#39;</span>
<span class="sd">    operator : str</span>
<span class="sd">        Action to perform on data:</span>
<span class="sd">        - &#39;storage_max&#39;: returns maximum storage modulus</span>
<span class="sd">        - &#39;loss_max&#39;: returns maximum loss modulus</span>
<span class="sd">        - &#39;tan_max&#39;: returns maximum Tanδ</span>
<span class="sd">        - &#39;plot_storage&#39;, &#39;plot_loss&#39;, &#39;plot_tan&#39;: plots corresponding data</span>
<span class="sd">    sample_name : str</span>
<span class="sd">        Name of the sample (used for plot label)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float or None</span>
<span class="sd">        Maximum value for storage, loss, or Tanδ if requested.</span>
<span class="sd">        None if plotting.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; df = pd.DataFrame({</span>
<span class="sd">    ... &#39;Frequency (Hz)&#39;:[1,10,100],</span>
<span class="sd">    ... &quot;E&#39;-Storage Modulus (Mpa)&quot;:[100,150,200],</span>
<span class="sd">    ... df.columns[13]:[10,20,30],  # Loss modulus column</span>
<span class="sd">    ... &#39;Tanδ&#39;:[0.1,0.15,0.2]})</span>
<span class="sd">    &gt;&gt;&gt; DMTA_TestAnalysis(df, &#39;storage_max&#39;, &#39;Sample1&#39;)</span>
<span class="sd">    200</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check required columns exist</span>
    <span class="n">required_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">,</span> <span class="s2">&quot;E&#39;-Storage Modulus (Mpa)&quot;</span><span class="p">,</span> <span class="s2">&quot;Tanδ&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">required_cols</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DataFrame must contain &#39;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">&#39; column.&quot;</span><span class="p">)</span>
    <span class="c1"># Assuming 14th column is loss modulus</span>
    <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">14</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;DataFrame must have at least 14 columns to access Loss Modulus.&quot;</span><span class="p">)</span>
    
    <span class="n">frequency</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">]</span>
    <span class="n">storage_modulus</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;E&#39;-Storage Modulus (Mpa)&quot;</span><span class="p">]</span>
    <span class="n">loss_modulus</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">13</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">tan_delta</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Tanδ&quot;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">plot_data</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">y_label</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper function to reduce repeated plotting code.&quot;&quot;&quot;</span>
        <span class="n">font_label</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;Times New Roman&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">}</span>
        <span class="n">font_legend</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;Times New Roman&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">13</span><span class="p">}</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">sample_name</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font_label</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">y_label</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font_label</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">autoscale</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="n">font_legend</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">spine</span> <span class="ow">in</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">spine</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># Operator handling</span>
    <span class="k">if</span> <span class="n">operator</span> <span class="o">==</span> <span class="s2">&quot;storage_max&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">storage_modulus</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s2">&quot;loss_max&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">loss_modulus</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s2">&quot;tan_max&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tan_delta</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s2">&quot;plot_storage&quot;</span><span class="p">:</span>
        <span class="n">plot_data</span><span class="p">(</span><span class="n">frequency</span><span class="p">,</span> <span class="n">storage_modulus</span><span class="p">,</span> <span class="s2">&quot;E&#39;-Storage Modulus (Mpa)&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s2">&quot;plot_loss&quot;</span><span class="p">:</span>
        <span class="n">plot_data</span><span class="p">(</span><span class="n">frequency</span><span class="p">,</span> <span class="n">loss_modulus</span><span class="p">,</span> <span class="s2">&quot;E&#39;&#39;-Loss Modulus (Mpa)&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s2">&quot;plot_tan&quot;</span><span class="p">:</span>
        <span class="n">plot_data</span><span class="p">(</span><span class="n">frequency</span><span class="p">,</span> <span class="n">tan_delta</span><span class="p">,</span> <span class="s2">&quot;Tanδ&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Operator must be one of &#39;storage_max&#39;,&#39;loss_max&#39;,&#39;tan_max&#39;,&#39;plot_storage&#39;,&#39;plot_loss&#39;,&#39;plot_tan&#39;.&quot;</span><span class="p">)</span></div>






<div class="viewcode-block" id="Find_MaxVerticalVelocity">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.Find_MaxVerticalVelocity">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Find_MaxVerticalVelocity</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find the maximum vertical flow velocity and its location from simulation data,</span>
<span class="sd">    and plot velocity versus position.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pandas.DataFrame</span>
<span class="sd">        DataFrame containing at least two columns:</span>
<span class="sd">        - &#39;x(m)&#39;: position in meters</span>
<span class="sd">        - &#39;u(m/s)&#39;: vertical velocity in m/s</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple</span>
<span class="sd">        (maximum velocity, location of maximum velocity)</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">    &gt;&gt;&gt; df = pd.DataFrame({&#39;x(m)&#39;:[0,0.5,1.0],&#39;u(m/s)&#39;:[0.1,0.3,0.2]})</span>
<span class="sd">    &gt;&gt;&gt; Find_MaxVerticalVelocity(df)</span>
<span class="sd">    The maximum value of Flow Velocity for this problem is: 0.3</span>
<span class="sd">    Also this maximum value occurs in this location: 0.5</span>
<span class="sd">    (0.3, 0.5)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check required columns exist</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">{</span><span class="s1">&#39;x(m)&#39;</span><span class="p">,</span> <span class="s1">&#39;u(m/s)&#39;</span><span class="p">}</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;DataFrame must contain &#39;x(m)&#39; and &#39;u(m/s)&#39; columns.&quot;</span><span class="p">)</span>
    
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;x(m)&#39;</span><span class="p">])</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;u(m/s)&#39;</span><span class="p">])</span>

    <span class="c1"># Find maximum velocity and its location</span>
    <span class="n">u_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
    <span class="n">index_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
    <span class="n">loc_max</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">index_max</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The maximum value of Flow Velocity for this problem is: </span><span class="si">{</span><span class="n">u_max</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Also this maximum value occurs in this location: </span><span class="si">{</span><span class="n">loc_max</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Plot velocity vs position</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Flow Velocity&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="s1">&#39;Times New Roman&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x (m)&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;u velocity (m/s)&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">u_max</span><span class="p">,</span> <span class="n">loc_max</span></div>


        
<div class="viewcode-block" id="SolidificationStart">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.SolidificationStart">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">SolidificationStart</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">temp_sol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determine if solidification has started based on temperature profile,</span>
<span class="sd">    and plot temperature along the centerline.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pandas.DataFrame</span>
<span class="sd">        DataFrame containing at least two columns:</span>
<span class="sd">        - &#39;x(m)&#39;: position in meters</span>
<span class="sd">        - &#39;T(K)&#39;: temperature in Kelvin</span>
<span class="sd">    temp_sol : float</span>
<span class="sd">        Solidus temperature of the material in Kelvin.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">        True if solidification has started (temperature &lt;= solidus temperature),</span>
<span class="sd">        False otherwise.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">    &gt;&gt;&gt; df = pd.DataFrame({&#39;x(m)&#39;:[0,0.5,1],&#39;T(K)&#39;:[1600,1550,1500]})</span>
<span class="sd">    &gt;&gt;&gt; SolidificationStart(df, 1520)</span>
<span class="sd">    The solidification process has started.</span>
<span class="sd">    True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check required columns exist</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">{</span><span class="s1">&#39;x(m)&#39;</span><span class="p">,</span> <span class="s1">&#39;T(K)&#39;</span><span class="p">}</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;DataFrame must contain &#39;x(m)&#39; and &#39;T(K)&#39; columns.&quot;</span><span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;x(m)&#39;</span><span class="p">])</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;T(K)&#39;</span><span class="p">])</span>

    <span class="c1"># Plot temperature profile</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Temperature Profile&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="s1">&#39;Times New Roman&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x (m)&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Temperature (K)&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="n">temp_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">temp_min</span> <span class="o">&gt;</span> <span class="n">temp_sol</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The solidification process has not started yet.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The solidification process has started.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>





<div class="viewcode-block" id="Water_Hardness">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.Water_Hardness">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Water_Hardness</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluate water hardness based on metal content and pyrogenic compounds,</span>
<span class="sd">    filter out unsuitable water, calculate hardness (ppm), and plot results.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pandas.DataFrame</span>
<span class="sd">        DataFrame containing at least the following columns:</span>
<span class="sd">        - &#39;name&#39;: sample name</span>
<span class="sd">        - &#39;Cu&#39;, &#39;Ni&#39;, &#39;Zn&#39;, &#39;pyro&#39;, &#39;Cya&#39;, &#39;Mg&#39;, &#39;Ca&#39;</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple</span>
<span class="sd">        - Filtered DataFrame with suitable water samples</span>
<span class="sd">        - List of DataFrames containing names of unavailable water samples</span>
<span class="sd">        - Displays a bar plot of water hardness (ppm) vs sample names</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">    &gt;&gt;&gt; df = pd.DataFrame({</span>
<span class="sd">    ... &#39;name&#39;:[&#39;W1&#39;,&#39;W2&#39;,&#39;W3&#39;],</span>
<span class="sd">    ... &#39;Cu&#39;:[10,25,5],&#39;Ni&#39;:[5,3,15],&#39;Zn&#39;:[5,8,12],</span>
<span class="sd">    ... &#39;pyro&#39;:[50,120,90],&#39;Cya&#39;:[1,3,0.5],&#39;Mg&#39;:[10,15,5],&#39;Ca&#39;:[20,25,15]})</span>
<span class="sd">    &gt;&gt;&gt; Water_Hardness(df)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check required columns exist</span>
    <span class="n">required_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;Cu&#39;</span><span class="p">,</span><span class="s1">&#39;Ni&#39;</span><span class="p">,</span><span class="s1">&#39;Zn&#39;</span><span class="p">,</span><span class="s1">&#39;pyro&#39;</span><span class="p">,</span><span class="s1">&#39;Cya&#39;</span><span class="p">,</span><span class="s1">&#39;Mg&#39;</span><span class="p">,</span><span class="s1">&#39;Ca&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">required_cols</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DataFrame must contain columns: </span><span class="si">{</span><span class="n">required_cols</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">unavailable_water</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Thresholds for filtering</span>
    <span class="n">thresholds</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Cu&#39;</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;Ni&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;Zn&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;pyro&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;Cya&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">}</span>

    <span class="n">filtered_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">thresh</span> <span class="ow">in</span> <span class="n">thresholds</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">drop_index</span> <span class="o">=</span> <span class="n">filtered_df</span><span class="p">[</span><span class="n">filtered_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">thresh</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">drop_index</span><span class="p">:</span>
            <span class="n">unavailable_water</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filtered_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]])</span>
        <span class="n">filtered_df</span> <span class="o">=</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">drop_index</span><span class="p">)</span>

    <span class="c1"># Calculate hardness in ppm: Ca*2.5 + Mg*4.12</span>
    <span class="n">ca_ppm</span> <span class="o">=</span> <span class="n">filtered_df</span><span class="p">[</span><span class="s1">&#39;Ca&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">2.5</span>
    <span class="n">mg_ppm</span> <span class="o">=</span> <span class="n">filtered_df</span><span class="p">[</span><span class="s1">&#39;Mg&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">4.12</span>
    <span class="n">hardness_ppm</span> <span class="o">=</span> <span class="n">ca_ppm</span> <span class="o">+</span> <span class="n">mg_ppm</span>

    <span class="c1"># Plot hardness</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">filtered_df</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">hardness_ppm</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;skyblue&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Sample Name&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Hardness (ppm)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Water Hardness&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">filtered_df</span><span class="p">,</span> <span class="n">unavailable_water</span></div>






<div class="viewcode-block" id="WearRate_Calculation">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.WearRate_Calculation">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">WearRate_Calculation</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">work</span><span class="o">=</span><span class="s1">&#39;wear rate&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate wear rate of samples based on weight loss during a wear test.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pandas.DataFrame</span>
<span class="sd">        DataFrame containing two columns:</span>
<span class="sd">        - &#39;weight before test&#39;: sample weight before the test</span>
<span class="sd">        - &#39;weight after test&#39;: sample weight after the test</span>
<span class="sd">    S : float</span>
<span class="sd">        Sliding distance during the test (in meters)</span>
<span class="sd">    F : float</span>
<span class="sd">        Normal force applied during the test (in Newtons)</span>
<span class="sd">    work : str, optional</span>
<span class="sd">        Type of calculation, default is &#39;wear rate&#39;</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        Wear rate (WR) in units of mass/(force*distance)</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">    &gt;&gt;&gt; df = pd.DataFrame({</span>
<span class="sd">    ... &#39;weight before test&#39;:[5.0,4.8,5.2],</span>
<span class="sd">    ... &#39;weight after test&#39;:[4.9,4.7,5.1]})</span>
<span class="sd">    &gt;&gt;&gt; WearRate_Calculation(df, S=100, F=50)</span>
<span class="sd">    0.002</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check required columns exist</span>
    <span class="n">required_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;weight before test&#39;</span><span class="p">,</span> <span class="s1">&#39;weight after test&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">required_cols</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DataFrame must contain columns: </span><span class="si">{</span><span class="n">required_cols</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">wb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;weight before test&#39;</span><span class="p">])</span>
    <span class="n">wa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;weight after test&#39;</span><span class="p">])</span>

    <span class="c1"># Weight loss for each sample</span>
    <span class="n">wl</span> <span class="o">=</span> <span class="n">wb</span> <span class="o">-</span> <span class="n">wa</span>

    <span class="c1"># Average weight loss</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">wl</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">work</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;wear rate&#39;</span><span class="p">:</span>
        <span class="n">WR</span> <span class="o">=</span> <span class="n">m</span> <span class="o">/</span> <span class="p">(</span><span class="n">S</span> <span class="o">*</span> <span class="n">F</span><span class="p">)</span>  <span class="c1"># Wear rate = average weight loss / (sliding distance * force)</span>
        <span class="k">return</span> <span class="n">WR</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported work type. Only &#39;wear rate&#39; is supported.&quot;</span><span class="p">)</span></div>





<div class="viewcode-block" id="WearBar_Plot">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.WearBar_Plot">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">WearBar_Plot</span><span class="p">(</span><span class="n">df_list</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">F</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">work</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate wear rate for multiple samples and plot as a bar chart.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df_list : list of pandas.DataFrame</span>
<span class="sd">        Each DataFrame must contain columns:</span>
<span class="sd">        - &#39;weight before test&#39;</span>
<span class="sd">        - &#39;weight after test&#39;</span>
<span class="sd">    S : float, optional</span>
<span class="sd">        Sliding distance in meters (default 300)</span>
<span class="sd">    F : float, optional</span>
<span class="sd">        Normal force in Newtons (default 5)</span>
<span class="sd">    work : str, optional</span>
<span class="sd">        Currently only &#39;bar&#39; supported (default &#39;bar&#39;)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">        Displays a bar plot of wear rates for the samples.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; df1 = pd.DataFrame({&#39;weight before test&#39;:[5.0],&#39;weight after test&#39;:[4.9]})</span>
<span class="sd">    &gt;&gt;&gt; df2 = pd.DataFrame({&#39;weight before test&#39;:[4.8],&#39;weight after test&#39;:[4.7]})</span>
<span class="sd">    &gt;&gt;&gt; WearBar_Plot([df1, df2])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">work</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;bar&#39;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Only &#39;bar&#39; work type is supported.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;df_list must be a non-empty list of DataFrames.&quot;</span><span class="p">)</span>

    <span class="n">wear_rates</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">df_list</span><span class="p">):</span>
        <span class="c1"># Calculate wear rate for each sample using WearRate_Calculation()</span>
        <span class="n">wr</span> <span class="o">=</span> <span class="n">WearRate_Calculation</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="n">S</span><span class="p">,</span> <span class="n">F</span><span class="o">=</span><span class="n">F</span><span class="p">)</span>
        <span class="n">wear_rates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wr</span><span class="p">)</span>

    <span class="c1"># Define sample labels (A, B, C, ...)</span>
    <span class="n">sample_labels</span> <span class="o">=</span> <span class="p">[</span><span class="nb">chr</span><span class="p">(</span><span class="mi">65</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wear_rates</span><span class="p">))]</span>

    <span class="c1"># Plot bar chart</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">sample_labels</span><span class="p">,</span> <span class="n">wear_rates</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Wear Rate for Samples&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Wear Rate (mg/N.m)&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Sample&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>










<div class="viewcode-block" id="PolarizationAnalysis">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.PolarizationAnalysis">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">PolarizationAnalysis</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">work</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Analyze polarization data: plot polarization curve or calculate corrosion potential.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pandas.DataFrame</span>
<span class="sd">        DataFrame containing at least two columns:</span>
<span class="sd">        - &#39;Current density&#39;: current density in A/cm2</span>
<span class="sd">        - &#39;Potential&#39;: potential in V vs Ag/AgCl</span>
<span class="sd">    work : str</span>
<span class="sd">        Action to perform:</span>
<span class="sd">        - &#39;plot&#39;: plots the polarization curve (log(current) vs potential)</span>
<span class="sd">        - &#39;corrosion potential&#39;: returns the potential corresponding to the minimum current density</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float or None</span>
<span class="sd">        Corrosion potential in volts if work=&#39;corrosion potential&#39;, None if plotting.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">    &gt;&gt;&gt; df = pd.DataFrame({&#39;Current density&#39;:[1e-6,1e-5,1e-4],&#39;Potential&#39;:[0.1,0.2,0.3]})</span>
<span class="sd">    &gt;&gt;&gt; PolarizationAnalysis(df, &#39;plot&#39;)  # Displays the plot</span>
<span class="sd">    &gt;&gt;&gt; PolarizationAnalysis(df, &#39;corrosion potential&#39;)</span>
<span class="sd">    0.1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check required columns exist</span>
    <span class="n">required_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Current density&#39;</span><span class="p">,</span> <span class="s1">&#39;Potential&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">required_cols</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DataFrame must contain columns: </span><span class="si">{</span><span class="n">required_cols</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">current_density</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Current density&#39;</span><span class="p">])</span>
    <span class="n">potential</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Potential&#39;</span><span class="p">])</span>

    <span class="c1"># Take natural logarithm of current density</span>
    <span class="n">log_cd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">current_density</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">work</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;plot&#39;</span><span class="p">:</span>
        <span class="n">font_title</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;serif&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">}</span>
        <span class="n">font_label</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;serif&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">}</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">log_cd</span><span class="p">,</span> <span class="n">potential</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Polarization Curve&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font_title</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Log i (A/cm²)&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font_label</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;E (V vs Ag/AgCl)&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font_label</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">elif</span> <span class="n">work</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;corrosion potential&#39;</span><span class="p">:</span>
        <span class="c1"># Corrosion potential corresponds to minimum current density</span>
        <span class="n">min_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">current_density</span><span class="p">)</span>
        <span class="n">corrosion_potential</span> <span class="o">=</span> <span class="n">potential</span><span class="p">[</span><span class="n">min_index</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">corrosion_potential</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported work type. Use &#39;plot&#39; or &#39;corrosion potential&#39;.&quot;</span><span class="p">)</span></div>








<div class="viewcode-block" id="StatisticalAnalysis">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.StatisticalAnalysis">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">StatisticalAnalysis</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">operation</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform statistical analysis or plots on a DataFrame.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pandas.DataFrame</span>
<span class="sd">        Input DataFrame with numeric features.</span>
<span class="sd">    operation : str</span>
<span class="sd">        Operation to perform:</span>
<span class="sd">        - &#39;statistics&#39; : prints min, max, median, quantiles, IQR, and z-score for each numeric feature</span>
<span class="sd">        - &#39;histogram&#39;  : plots histograms for numeric features</span>
<span class="sd">        - &#39;correlation&#39;: plots correlation heatmap</span>
<span class="sd">        - &#39;pairplot&#39;   : plots pairplot with regression lines</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">        Prints statistics or displays plots.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">    &gt;&gt;&gt; df = pd.DataFrame({&#39;A&#39;:[1,2,3,4],&#39;B&#39;:[4,3,2,1]})</span>
<span class="sd">    &gt;&gt;&gt; StatisticalAnalysis(df, &#39;statistics&#39;)</span>
<span class="sd">    &gt;&gt;&gt; StatisticalAnalysis(df, &#39;histogram&#39;)</span>
<span class="sd">    &gt;&gt;&gt; StatisticalAnalysis(df, &#39;correlation&#39;)</span>
<span class="sd">    &gt;&gt;&gt; StatisticalAnalysis(df, &#39;pairplot&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Input DataFrame is empty.&quot;</span><span class="p">)</span>

    <span class="n">font_title</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;serif&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">}</span>
    <span class="n">font_x</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;serif&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">}</span>
    <span class="n">font_y</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;serif&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">}</span>

    <span class="n">numeric_cols</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>

    <span class="k">if</span> <span class="n">operation</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;statistics&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">numeric_cols</span><span class="p">:</span>
            <span class="n">Q1</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
            <span class="n">Q3</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.75</span><span class="p">)</span>
            <span class="n">IQR</span> <span class="o">=</span> <span class="n">Q3</span> <span class="o">-</span> <span class="n">Q1</span>
            <span class="n">min_value</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
            <span class="n">max_value</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="n">median_value</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
            <span class="n">z_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">zscore</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]))</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Feature: </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="se">\n</span><span class="s1"> Min: </span><span class="si">{</span><span class="n">min_value</span><span class="si">}</span><span class="s1">, Max: </span><span class="si">{</span><span class="n">max_value</span><span class="si">}</span><span class="s1">, Median: </span><span class="si">{</span><span class="n">median_value</span><span class="si">}</span><span class="s1">, &#39;</span>
                  <span class="sa">f</span><span class="s1">&#39;Q1: </span><span class="si">{</span><span class="n">Q1</span><span class="si">}</span><span class="s1">, Q3: </span><span class="si">{</span><span class="n">Q3</span><span class="si">}</span><span class="s1">, IQR: </span><span class="si">{</span><span class="n">IQR</span><span class="si">}</span><span class="s1">, Z-score: </span><span class="si">{</span><span class="n">z_score</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">operation</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;histogram&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">numeric_cols</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribution&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font_title</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Bins&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font_x</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font_y</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">operation</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;correlation&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">corr</span><span class="p">(),</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">numeric_cols</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">numeric_cols</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Correlation&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font_title</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">operation</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;pairplot&#39;</span><span class="p">:</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">numeric_cols</span><span class="p">],</span> <span class="n">markers</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;reg&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Relation Between Columns&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported operation. Choose from &#39;statistics&#39;, &#39;histogram&#39;, &#39;correlation&#39;, or &#39;pairplot&#39;.&quot;</span><span class="p">)</span></div>


         


 
<div class="viewcode-block" id="ParticleSizeAnalysis">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.ParticleSizeAnalysis">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">ParticleSizeAnalysis</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">operation</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Analyze particle size distribution: calculate average size or plot size distribution.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pandas.DataFrame</span>
<span class="sd">        DataFrame containing at least two columns:</span>
<span class="sd">        - &#39;size&#39;: particle sizes (nm)</span>
<span class="sd">        - &#39;distribution&#39;: intensity (%) corresponding to each size</span>
<span class="sd">    operation : str</span>
<span class="sd">        Action to perform:</span>
<span class="sd">        - &#39;calculate&#39;: calculate and return the average particle size</span>
<span class="sd">        - &#39;plot&#39;     : plot the particle size distribution curve</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float or None</span>
<span class="sd">        Average particle size if operation=&#39;calculate&#39;, None if plotting.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">    &gt;&gt;&gt; df = pd.DataFrame({&#39;size&#39;:[10,20,30],&#39;distribution&#39;:[30,50,20]})</span>
<span class="sd">    &gt;&gt;&gt; ParticleSizeAnalysis(df, &#39;calculate&#39;)</span>
<span class="sd">    20</span>
<span class="sd">    &gt;&gt;&gt; ParticleSizeAnalysis(df, &#39;plot&#39;)  # Displays the plot</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check required columns exist</span>
    <span class="n">required_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">,</span> <span class="s1">&#39;distribution&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">required_cols</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DataFrame must contain columns: </span><span class="si">{</span><span class="n">required_cols</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">operation</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;calculate&#39;</span><span class="p">:</span>
        <span class="n">average_size</span> <span class="o">=</span> <span class="n">statistics</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Average particle size is:&#39;</span><span class="p">,</span> <span class="n">average_size</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">average_size</span>

    <span class="k">elif</span> <span class="n">operation</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;plot&#39;</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;distribution&#39;</span><span class="p">]</span>
        <span class="n">font_x</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span><span class="s1">&#39;Times New Roman&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">15</span><span class="p">}</span>
        <span class="n">font_y</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span><span class="s1">&#39;Times New Roman&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">15</span><span class="p">}</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Size (nm)&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font_x</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Intensity (%)&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font_y</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Particle Size Distribution&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported operation. Choose &#39;calculate&#39; or &#39;plot&#39;.&quot;</span><span class="p">)</span></div>




    





<div class="viewcode-block" id="LoadPositionAnalysis">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.LoadPositionAnalysis">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">LoadPositionAnalysis</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">operation</span><span class="p">,</span> <span class="n">area</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Analyze Load-Position data: generate curves, calculate stress-strain, normalized stress-strain, or energy absorption density.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pandas.DataFrame</span>
<span class="sd">        DataFrame containing two columns:</span>
<span class="sd">        - &#39;Load (kN)&#39;: load values</span>
<span class="sd">        - &#39;Position (mm)&#39;: position values</span>
<span class="sd">    operation : str</span>
<span class="sd">        Operation to perform:</span>
<span class="sd">        - &#39;LPC&#39; or &#39;Load-Position Curve&#39;</span>
<span class="sd">        - &#39;SSCal&#39; or &#39;Stress-Strain Calculation&#39;</span>
<span class="sd">        - &#39;SSC&#39; or &#39;Stress-Strain Curve&#39;</span>
<span class="sd">        - &#39;NSSCal&#39; or &#39;Normal Stress-Strain Calculation&#39;</span>
<span class="sd">        - &#39;NSSC&#39; or &#39;Normal Stress-Strain Curve&#39;</span>
<span class="sd">        - &#39;EADCal&#39; or &#39;EAD Calculation&#39;</span>
<span class="sd">    area : float</span>
<span class="sd">        Cross-sectional area (mm²) for stress calculation</span>
<span class="sd">    length : float</span>
<span class="sd">        Gauge length (mm) for strain calculation</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.ndarray or float or None</span>
<span class="sd">        Depends on operation:</span>
<span class="sd">        - Stress-Strain arrays for &#39;SSCal&#39; and &#39;NSSCal&#39;</span>
<span class="sd">        - Energy absorption density for &#39;EADCal&#39;</span>
<span class="sd">        - None for plotting operations</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; df = pd.DataFrame({&#39;Load (kN)&#39;:[1,2,3],&#39;Position (mm)&#39;:[0,1,2]})</span>
<span class="sd">    &gt;&gt;&gt; LoadPositionAnalysis(df, &#39;LPC&#39;, 100, 50)  # Plot load-position curve</span>
<span class="sd">    &gt;&gt;&gt; LoadPositionAnalysis(df, &#39;SSCal&#39;, 100, 50)  # Returns Stress-Strain array</span>
<span class="sd">    &gt;&gt;&gt; LoadPositionAnalysis(df, &#39;EADCal&#39;, 100, 50)  # Returns energy absorption density</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">required_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Load (kN)&#39;</span><span class="p">,</span> <span class="s1">&#39;Position (mm)&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">required_cols</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DataFrame must contain columns: </span><span class="si">{</span><span class="n">required_cols</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">Load</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Load (kN)&#39;</span><span class="p">])</span>
    <span class="n">Position</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Position (mm)&#39;</span><span class="p">])</span>

    <span class="c1"># Compute Stress and Strain for operations that need them</span>
    <span class="n">Strain</span> <span class="o">=</span> <span class="n">Position</span> <span class="o">/</span> <span class="n">length</span>
    <span class="n">Stress</span> <span class="o">=</span> <span class="p">(</span><span class="n">Load</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">/</span> <span class="n">area</span>  <span class="c1"># Convert kN to N</span>

    <span class="n">title_font</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;Times New Roman&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">}</span>
    <span class="n">label_font</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;Times New Roman&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">}</span>

    <span class="n">op</span> <span class="o">=</span> <span class="n">operation</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="n">op</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;lpc&#39;</span><span class="p">,</span> <span class="s1">&#39;load-position curve&#39;</span><span class="p">]:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Position</span><span class="p">,</span> <span class="n">Load</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;teal&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Load-Position&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">title_font</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Position (mm)&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">label_font</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Load (kN)&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">label_font</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Position</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Load</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">elif</span> <span class="n">op</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;sscal&#39;</span><span class="p">,</span> <span class="s1">&#39;stress-strain calculation&#39;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">Strain</span><span class="p">,</span> <span class="n">Stress</span><span class="p">))</span>

    <span class="k">elif</span> <span class="n">op</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ssc&#39;</span><span class="p">,</span> <span class="s1">&#39;stress-strain curve&#39;</span><span class="p">]:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Strain</span><span class="p">,</span> <span class="n">Stress</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;teal&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Stress-Strain&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">title_font</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Strain (-)&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">label_font</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Stress (MPa)&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">label_font</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">elif</span> <span class="n">op</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;nsscal&#39;</span><span class="p">,</span> <span class="s1">&#39;normal stress-strain calculation&#39;</span><span class="p">]:</span>
        <span class="n">N_Strain</span> <span class="o">=</span> <span class="n">Strain</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Strain</span><span class="p">)</span>
        <span class="n">N_Stress</span> <span class="o">=</span> <span class="n">Stress</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Stress</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">N_Strain</span><span class="p">,</span> <span class="n">N_Stress</span><span class="p">))</span>

    <span class="k">elif</span> <span class="n">op</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;nssc&#39;</span><span class="p">,</span> <span class="s1">&#39;normal stress-strain curve&#39;</span><span class="p">]:</span>
        <span class="n">N_Strain</span> <span class="o">=</span> <span class="n">Strain</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Strain</span><span class="p">)</span>
        <span class="n">N_Stress</span> <span class="o">=</span> <span class="n">Stress</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Stress</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">N_Strain</span><span class="p">,</span> <span class="n">N_Stress</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;teal&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Normalized Stress-Strain&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">title_font</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Normalized Strain (-)&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">label_font</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span></div>




<div class="viewcode-block" id="SI_Calculation">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.SI_Calculation">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">SI_Calculation</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">PC</span><span class="p">,</span> <span class="n">Density</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate Separation Index (SI) and plot Flux, Rejection, and SI charts.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pandas.DataFrame</span>
<span class="sd">        DataFrame containing columns: &#39;Mem Code&#39;, &#39;Flux&#39;, &#39;Rejection&#39;.</span>
<span class="sd">    P : float</span>
<span class="sd">        Pressure (bar)</span>
<span class="sd">    PC : float</span>
<span class="sd">        Pollutant concentration in Feed (g/L)</span>
<span class="sd">    Density : float, optional</span>
<span class="sd">        Feed Density (g/cm3), default is 1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    SI : numpy.ndarray</span>
<span class="sd">        Array of Separation Index values for each membrane.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; df = pd.DataFrame({</span>
<span class="sd">    ...     &#39;Mem Code&#39;: [&#39;M1&#39;, &#39;M2&#39;, &#39;M3&#39;],</span>
<span class="sd">    ...     &#39;Flux&#39;: [90, 150, 250],</span>
<span class="sd">    ...     &#39;Rejection&#39;: [0.5, 0.7, 0.8]</span>
<span class="sd">    ... })</span>
<span class="sd">    &gt;&gt;&gt; SI = SI_Calculation(df, P=5, PC=50)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">J</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Flux&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Rejection&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">Mem_Code</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Mem Code&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

    <span class="c1"># Separation Index calculation</span>
    <span class="n">SI</span> <span class="o">=</span> <span class="p">(</span><span class="n">Density</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">R</span><span class="p">)</span> <span class="o">*</span> <span class="n">PC</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">J</span> <span class="o">/</span> <span class="p">(</span><span class="n">P</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">R</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.41</span><span class="p">)))</span>

    <span class="n">font</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;serif&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">plot_bar</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">thresholds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal function to plot bar chart with hatch patterns based on thresholds</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">hatches</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="s1">&#39;.&#39;</span> <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="n">thresholds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="s1">&#39;o&#39;</span> <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="n">thresholds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="s1">&#39;O&#39;</span> 
            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">values</span>
        <span class="p">])</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">bar_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;.:Low&#39;</span><span class="p">,</span> <span class="s1">&#39;o:Medium&#39;</span><span class="p">,</span> <span class="s1">&#39;O:High&#39;</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">Mem_Code</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">hatch</span><span class="o">=</span><span class="n">hatches</span><span class="p">,</span>
               <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="mf">0.01</span> <span class="k">if</span> <span class="n">ylabel</span><span class="o">==</span><span class="s1">&#39;Rejection&#39;</span> <span class="k">else</span> <span class="mi">10</span><span class="p">,</span>
               <span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">bar_labels</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Membrane code&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ylabel</span><span class="si">}</span><span class="s1"> Range&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># Plot charts</span>
    <span class="n">plot_bar</span><span class="p">(</span><span class="n">J</span><span class="p">,</span> <span class="s1">&#39;Flux Chart&#39;</span><span class="p">,</span> <span class="s1">&#39;Flux&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">])</span>
    <span class="n">plot_bar</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="s1">&#39;Rejection Chart&#39;</span><span class="p">,</span> <span class="s1">&#39;Rejection&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">])</span>
    <span class="n">plot_bar</span><span class="p">(</span><span class="n">SI</span><span class="p">,</span> <span class="s1">&#39;SI Chart&#39;</span><span class="p">,</span> <span class="s1">&#39;SI&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">250</span><span class="p">,</span> <span class="mi">500</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">SI</span></div>




<div class="viewcode-block" id="SICalculation">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.SICalculation">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">SICalculation</span><span class="p">(</span><span class="n">f_loc</span><span class="p">,</span><span class="n">P</span><span class="p">,</span><span class="n">PC</span><span class="p">,</span><span class="n">Density</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    This function is used for Separation Index Calculation</span>
<span class="sd">    </span>

<span class="sd">    P : Pressure (bar)</span>

<span class="sd">    Density : Feed Density(g/cm3)</span>

<span class="sd">    PC :  Pollutant concentration in Feed (g/L)</span>

<span class="sd">    Returns Separation Index and Flux &amp; Rejection &amp; Rejection Charts</span>

<span class="sd">    &#39;&#39;&#39;</span>

<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    Data=pd.read_excel(f_loc)</span>

<span class="sd">    Data.columns</span>

<span class="sd">    J=Data[&#39;Flux&#39;]</span>

<span class="sd">    R=Data[&#39;Rejection&#39;]</span>



<span class="sd">    SI=(Density-(1-R)*PC/1000)*(J/(P*((1-R)**0.41)))</span>

<span class="sd">    Mem_Code=np.array(Data[&#39;Mem Code&#39;])</span>

<span class="sd">    Flux=np.array(Data[&#39;Flux&#39;])</span>

<span class="sd">    Rejection=np.array(Data[&#39;Rejection&#39;])</span>



<span class="sd">    font={&#39;family&#39;:&#39;serif&#39;,&#39;color&#39;:&#39;k&#39;,&#39;size&#39;:&#39;20&#39;}</span>

<span class="sd">    </span>

<span class="sd">    c=np.array([])</span>

<span class="sd">    for i in range (0,len(Flux)):</span>

<span class="sd">        if Flux[i]&lt;100:</span>

<span class="sd">            a=np.array([&#39;.&#39;])</span>

<span class="sd">            c=np.concatenate((c,a))</span>

<span class="sd">        elif Flux[i]&lt;200:</span>

<span class="sd">            a=np.array([&#39;o&#39;])</span>

<span class="sd">            c=np.concatenate((c,a))</span>

<span class="sd">        else:</span>

<span class="sd">            a=np.array([&#39;O&#39;])</span>

<span class="sd">            c=np.concatenate((c,a))</span>

<span class="sd">    fig, ax = plt.subplots()</span>

<span class="sd">    </span>

<span class="sd">    bar_labels=[&#39;.:Low Flux&#39;,&#39;o:Medium Flux&#39;,&#39;O:High Flux&#39;]</span>

<span class="sd">    for i in range(0,len(Flux)-3):</span>

<span class="sd">        m=[&#39;_.&#39;]</span>

<span class="sd">        bar_labels=bar_labels+m</span>

<span class="sd">        </span>

<span class="sd">    ax.bar(Mem_Code,Flux,color=&#39;w&#39;,edgecolor=&#39;c&#39;,hatch=c,linewidth=1,yerr=10,ecolor=&#39;c&#39;,width=0.85,label=bar_labels)   </span>

<span class="sd">    plt.title(&#39;Flux Chart&#39;,fontdict=font)</span>

<span class="sd">    plt.xlabel(&#39;Membrane code&#39;,fontdict=font)</span>

<span class="sd">    plt.ylabel(&#39;Flux&#39;,fontdict=font)</span>

<span class="sd">    ax.legend(title=&#39;Flux Range&#39;)</span>

<span class="sd">    plt.show()</span>

<span class="sd">    </span>

<span class="sd">    d=np.array([])</span>

<span class="sd">    for i in range (0,len(Rejection)):</span>

<span class="sd">        if Rejection[i]&lt;0.6:</span>

<span class="sd">            a=np.array([&#39;.&#39;])</span>

<span class="sd">            d=np.concatenate((d,a))</span>

<span class="sd">        elif Rejection[i]&lt;0.75:</span>

<span class="sd">            a=np.array([&#39;o&#39;])</span>

<span class="sd">            d=np.concatenate((d,a))</span>

<span class="sd">        else:</span>

<span class="sd">            a=np.array([&#39;O&#39;])</span>

<span class="sd">            d=np.concatenate((d,a))</span>

<span class="sd">    fig, ax = plt.subplots()</span>

<span class="sd">    </span>

<span class="sd">    bar_labels=[&#39;.:Low Rejection&#39;,&#39;o:Medium Rejection&#39;,&#39;O:High Rejection&#39;]</span>

<span class="sd">    for i in range(0,len(Rejection)-3):</span>

<span class="sd">        m=[&#39;_.&#39;]</span>

<span class="sd">        bar_labels=bar_labels+m</span>

<span class="sd">        </span>

<span class="sd">    ax.bar(Mem_Code,Rejection,color=&#39;w&#39;,edgecolor=&#39;c&#39;,hatch=d,linewidth=1,yerr=0.01,ecolor=&#39;c&#39;,width=0.85,label=bar_labels)   </span>

<span class="sd">    plt.title(&#39;Rejection Chart&#39;,fontdict=font)</span>

<span class="sd">    plt.xlabel(&#39;Membrane code&#39;,fontdict=font)</span>

<span class="sd">    plt.ylabel(&#39;Rejection&#39;,fontdict=font)</span>

<span class="sd">    ax.legend(title=&#39;Rejection Range&#39;)</span>

<span class="sd">    plt.show()</span>

<span class="sd">    </span>

<span class="sd">    f=np.array([])</span>

<span class="sd">    for i in range (0,len(SI)):</span>

<span class="sd">        if SI[i]&lt;250:</span>

<span class="sd">            a=np.array([&#39;.&#39;])</span>

<span class="sd">            f=np.concatenate((f,a))</span>

<span class="sd">        elif SI[i]&lt;500:</span>

<span class="sd">            a=np.array([&#39;o&#39;])</span>

<span class="sd">            f=np.concatenate((f,a))</span>

<span class="sd">        else:</span>

<span class="sd">            a=np.array([&#39;O&#39;])</span>

<span class="sd">            f=np.concatenate((f,a))</span>

<span class="sd">    fig, ax = plt.subplots()</span>

<span class="sd">    </span>

<span class="sd">    bar_labels=[&#39;.:Low SI&#39;,&#39;o:Medium SI&#39;,&#39;O:High SI&#39;]</span>

<span class="sd">    for i in range(0,len(SI)-3):</span>

<span class="sd">        m=[&#39;_.&#39;]</span>

<span class="sd">        bar_labels=bar_labels+m</span>

<span class="sd">        </span>

<span class="sd">    ax.bar(Mem_Code,SI,color=&#39;w&#39;,edgecolor=&#39;c&#39;,hatch=f,linewidth=1,yerr=10,ecolor=&#39;c&#39;,width=0.85,label=bar_labels)   </span>

<span class="sd">    plt.title(&#39;SI Chart&#39;,fontdict=font)</span>

<span class="sd">    plt.xlabel(&#39;Membrane code&#39;,fontdict=font)</span>

<span class="sd">    plt.ylabel(&#39;SI&#39;,fontdict=font)</span>

<span class="sd">    ax.legend(title=&#39;SI Range&#39;)</span>

<span class="sd">    plt.show()    </span>

<span class="sd">    </span>

<span class="sd">    return SI</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: This function is deprecated. Please use &quot;SI_Calculation&quot; instead.&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span></div>









<div class="viewcode-block" id="Porosity">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.Porosity">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Porosity</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">Density</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate porosity of membranes and plot a Porosity Chart.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pandas.DataFrame</span>
<span class="sd">        DataFrame containing columns: &#39;membrane&#39;, &#39;Ww&#39;, &#39;Wd&#39;, &#39;V&#39;</span>
<span class="sd">        where Ww = weight of wet sample, Wd = weight of dry sample,</span>
<span class="sd">        V = sample volume.</span>
<span class="sd">    Density : float, optional</span>
<span class="sd">        Water density (g/cm3). Default is 1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Porosity : numpy.ndarray</span>
<span class="sd">        Array of porosity values for each membrane.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; df = pd.DataFrame({</span>
<span class="sd">    ...     &#39;membrane&#39;: [&#39;M1&#39;, &#39;M2&#39;, &#39;M3&#39;],</span>
<span class="sd">    ...     &#39;Ww&#39;: [2.5, 3.0, 2.8],</span>
<span class="sd">    ...     &#39;Wd&#39;: [2.0, 2.4, 2.3],</span>
<span class="sd">    ...     &#39;V&#39;: [1.0, 1.2, 1.1]</span>
<span class="sd">    ... })</span>
<span class="sd">    &gt;&gt;&gt; porosity_values = Porosity(df)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Ww</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Ww&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">Wd</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Wd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;V&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">membrane</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;membrane&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

    <span class="c1"># Porosity calculation</span>
    <span class="n">Porosity</span> <span class="o">=</span> <span class="p">(</span><span class="n">Ww</span> <span class="o">-</span> <span class="n">Wd</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">Density</span> <span class="o">*</span> <span class="n">V</span><span class="p">)</span>

    <span class="n">font</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;serif&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">}</span>

    <span class="c1"># Assign hatches based on porosity value</span>
    <span class="n">hatches</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
        <span class="s1">&#39;.&#39;</span> <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="mf">0.9</span> <span class="k">else</span> <span class="s1">&#39;o&#39;</span> <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;O&#39;</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">Porosity</span>
    <span class="p">])</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">bar_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;.:Low Porosity&#39;</span><span class="p">,</span> <span class="s1">&#39;o:Medium Porosity&#39;</span><span class="p">,</span> <span class="s1">&#39;O:High Porosity&#39;</span><span class="p">]</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">membrane</span><span class="p">,</span> <span class="n">Porosity</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">hatch</span><span class="o">=</span><span class="n">hatches</span><span class="p">,</span>
           <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">bar_labels</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Porosity Chart&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Membrane&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Porosity&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Porosity Range&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">Porosity</span></div>





<div class="viewcode-block" id="Tortuosity">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.Tortuosity">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Tortuosity</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">Density</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the pore tortuosity of membranes and plot a Tortuosity Chart.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pandas.DataFrame</span>
<span class="sd">        DataFrame containing columns: &#39;membrane&#39;, &#39;Ww&#39;, &#39;Wd&#39;, &#39;V&#39;</span>
<span class="sd">        where Ww = weight of wet sample, Wd = weight of dry sample, V = sample volume.</span>
<span class="sd">    Density : float, optional</span>
<span class="sd">        Water density (g/cm3). Default is 1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Tortuosity : numpy.ndarray</span>
<span class="sd">        Array of tortuosity values for each membrane.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; df = pd.DataFrame({</span>
<span class="sd">    ...     &#39;membrane&#39;: [&#39;M1&#39;, &#39;M2&#39;, &#39;M3&#39;],</span>
<span class="sd">    ...     &#39;Ww&#39;: [2.5, 3.0, 2.8],</span>
<span class="sd">    ...     &#39;Wd&#39;: [2.0, 2.4, 2.3],</span>
<span class="sd">    ...     &#39;V&#39;: [1.0, 1.2, 1.1]</span>
<span class="sd">    ... })</span>
<span class="sd">    &gt;&gt;&gt; tort_values = Tortuosity(df)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Calculate porosity first</span>
    <span class="n">Ww</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Ww&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">Wd</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Wd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;V&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">Porosity</span> <span class="o">=</span> <span class="p">(</span><span class="n">Ww</span> <span class="o">-</span> <span class="n">Wd</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">Density</span> <span class="o">*</span> <span class="n">V</span><span class="p">)</span>

    <span class="c1"># Tortuosity calculation</span>
    <span class="n">Tortuosity</span> <span class="o">=</span> <span class="p">((</span><span class="mi">2</span> <span class="o">-</span> <span class="n">Porosity</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">Porosity</span>
    <span class="n">membrane</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;membrane&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

    <span class="n">font</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;serif&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">}</span>

    <span class="c1"># Assign hatches based on tortuosity value</span>
    <span class="n">hatches</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
        <span class="s1">&#39;.&#39;</span> <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="mf">0.75</span> <span class="k">else</span> <span class="s1">&#39;o&#39;</span> <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="mf">1.25</span> <span class="k">else</span> <span class="s1">&#39;O&#39;</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">Tortuosity</span>
    <span class="p">])</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">bar_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;.:Low Tortuosity&#39;</span><span class="p">,</span> <span class="s1">&#39;o:Medium Tortuosity&#39;</span><span class="p">,</span> <span class="s1">&#39;O:High Tortuosity&#39;</span><span class="p">]</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">membrane</span><span class="p">,</span> <span class="n">Tortuosity</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">hatch</span><span class="o">=</span><span class="n">hatches</span><span class="p">,</span>
           <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">bar_labels</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Tortuosity Chart&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Membrane&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Tortuosity&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Tortuosity Range&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">Tortuosity</span></div>









<div class="viewcode-block" id="Pore_Size">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.Pore_Size">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Pore_Size</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">Vis</span><span class="o">=</span><span class="mf">8.9e-4</span><span class="p">,</span> <span class="n">Density</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the pore size of membranes and plot a Pore Size Chart.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pandas.DataFrame</span>
<span class="sd">        DataFrame containing columns: &#39;membrane&#39;, &#39;Ww&#39;, &#39;Wd&#39;, &#39;V&#39;, &#39;q&#39;, &#39;l&#39;</span>
<span class="sd">        Ww = weight of wet sample (g), Wd = weight of dry sample (g), V = sample volume (cm3)</span>
<span class="sd">        q = flow rate (m3/s), l = membrane thickness (m)</span>
<span class="sd">    A : float</span>
<span class="sd">        Effective surface area of the membrane (m2)</span>
<span class="sd">    P : float</span>
<span class="sd">        Operational pressure (Pa)</span>
<span class="sd">    Vis : float, optional</span>
<span class="sd">        Water viscosity (Pa.s). Default is 8.9e-4</span>
<span class="sd">    Density : float, optional</span>
<span class="sd">        Water density (g/cm3). Default is 1</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Pore_Size : numpy.ndarray</span>
<span class="sd">        Array of pore size values in nm.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; df = pd.DataFrame({</span>
<span class="sd">    ...     &#39;membrane&#39;: [&#39;M1&#39;, &#39;M2&#39;, &#39;M3&#39;],</span>
<span class="sd">    ...     &#39;Ww&#39;: [2.5, 3.0, 2.8],</span>
<span class="sd">    ...     &#39;Wd&#39;: [2.0, 2.4, 2.3],</span>
<span class="sd">    ...     &#39;V&#39;: [1.0, 1.2, 1.1],</span>
<span class="sd">    ...     &#39;q&#39;: [1e-6, 1.2e-6, 0.9e-6],</span>
<span class="sd">    ...     &#39;l&#39;: [1e-3, 1.1e-3, 0.9e-3]</span>
<span class="sd">    ... })</span>
<span class="sd">    &gt;&gt;&gt; pore_sizes = Pore_Size(df, A=0.01, P=2e5)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Calculate Porosity</span>
    <span class="n">Ww</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Ww&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">Wd</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Wd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;V&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">Porosity</span> <span class="o">=</span> <span class="p">(</span><span class="n">Ww</span> <span class="o">-</span> <span class="n">Wd</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">Density</span> <span class="o">*</span> <span class="n">V</span><span class="p">)</span>

    <span class="n">q</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">Pore_Size</span> <span class="o">=</span> <span class="p">((</span><span class="mf">2.9</span> <span class="o">-</span> <span class="mf">1.75</span><span class="o">*</span><span class="n">Porosity</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="n">Vis</span><span class="o">*</span><span class="n">q</span><span class="o">*</span><span class="n">l</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">Porosity</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">P</span><span class="p">))</span><span class="o">**</span><span class="mf">0.5</span> <span class="o">*</span> <span class="mf">1e9</span>
    <span class="n">membrane</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;membrane&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

    <span class="n">font</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span><span class="s1">&#39;serif&#39;</span><span class="p">,</span><span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">20</span><span class="p">}</span>

    <span class="c1"># Assign hatches based on pore size</span>
    <span class="n">hatches</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;.&#39;</span> <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="mf">4.5</span> <span class="k">else</span> <span class="s1">&#39;o&#39;</span> <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="mf">5.5</span> <span class="k">else</span> <span class="s1">&#39;O&#39;</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">Pore_Size</span><span class="p">])</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">bar_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;.:Low Pore Size&#39;</span><span class="p">,</span> <span class="s1">&#39;o:Medium Pore Size&#39;</span><span class="p">,</span> <span class="s1">&#39;O:High Pore Size&#39;</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">membrane</span><span class="p">,</span> <span class="n">Pore_Size</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">hatch</span><span class="o">=</span><span class="n">hatches</span><span class="p">,</span>
           <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">bar_labels</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Pore Size Chart&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Membrane&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pore Size (nm)&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Pore Size Range&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">Pore_Size</span></div>





<div class="viewcode-block" id="Signal_To_Noise_Ratio">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.Signal_To_Noise_Ratio">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Signal_To_Noise_Ratio</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">application</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate and optionally plot signal, noise, or SNR from experimental data.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : DataFrame</span>
<span class="sd">        Experimental data with columns:</span>
<span class="sd">            1- &#39;location&#39;: measurement locations</span>
<span class="sd">            2- &#39;Signal Strength&#39;: signal power in dBm</span>
<span class="sd">            3- &#39;Noise Power&#39;: noise power in dBm</span>
<span class="sd">    application : str</span>
<span class="sd">        One of the following:</span>
<span class="sd">            &#39;plot signal&#39; - plots the signal column</span>
<span class="sd">            &#39;plot noise&#39; - plots the noise column</span>
<span class="sd">            &#39;plot snr&#39;   - plots the signal-to-noise ratio</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    mx : float</span>
<span class="sd">        Maximum signal-to-noise ratio in dB</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">location</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">])</span>
    <span class="n">signal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Signal Strength&#39;</span><span class="p">])</span>
    <span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Noise Power&#39;</span><span class="p">])</span>
    
    <span class="n">snr</span> <span class="o">=</span> <span class="n">signal</span> <span class="o">-</span> <span class="n">noise</span>  <span class="c1"># Compute signal-to-noise ratio</span>

    <span class="c1"># Plot based on application</span>
    <span class="n">app</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">application</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">app</span> <span class="o">==</span> <span class="s1">&#39;plot signal&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">signal</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Signal Power at Each Location&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Location&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Signal Power (dBm)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">app</span> <span class="o">==</span> <span class="s1">&#39;plot noise&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">noise</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Noise Power at Each Location&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Location&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Noise Power (dBm)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">app</span> <span class="o">==</span> <span class="s1">&#39;plot snr&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">snr</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Signal-to-Noise Ratio at Each Location&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Location&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;SNR (dB)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="n">mx</span> <span class="o">=</span> <span class="n">snr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">mx</span></div>





<div class="viewcode-block" id="Polarization_Control">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.Polarization_Control">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Polarization_Control</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">application</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Analyze polymerization process data and either visualize trends or return key values.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : pd.DataFrame</span>
<span class="sd">        A DataFrame containing the following required columns:</span>
<span class="sd">        - &#39;time&#39; (float or int): Time in seconds</span>
<span class="sd">        - &#39;temp&#39; (float): Temperature in °C</span>
<span class="sd">        - &#39;pressure&#39; (float): Pressure in Pa</span>
<span class="sd">        - &#39;percent&#39; (float): Reaction progress percentage (0–100)</span>

<span class="sd">    application : str</span>
<span class="sd">        Selects the analysis/plotting mode. Options:</span>
<span class="sd">        - &#39;temp_time&#39;       : Plot Temperature vs Time</span>
<span class="sd">        - &#39;pressure_time&#39;   : Plot Pressure vs Time</span>
<span class="sd">        - &#39;percent_time&#39;    : Plot Reaction Percent vs Time</span>
<span class="sd">        - &#39;100% reaction&#39;   : Return (temperature, pressure) when polymerization reaches 100%</span>
<span class="sd">        - &#39;Max_pressure&#39;    : Return maximum process pressure</span>
<span class="sd">        - &#39;Max_temp&#39;        : Return maximum process temperature</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple | float | None</span>
<span class="sd">        - (temp, pressure) if application is &#39;100% reaction&#39;</span>
<span class="sd">        - max pressure (float) if application is &#39;Max_pressure&#39;</span>
<span class="sd">        - max temperature (float) if application is &#39;Max_temp&#39;</span>
<span class="sd">        - None if plotting is performed</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; df = pd.DataFrame({</span>
<span class="sd">    ...     &#39;time&#39;: [0, 10, 20, 30],</span>
<span class="sd">    ...     &#39;temp&#39;: [25, 50, 75, 100],</span>
<span class="sd">    ...     &#39;pressure&#39;: [1, 2, 3, 4],</span>
<span class="sd">    ...     &#39;percent&#39;: [0, 30, 70, 100]</span>
<span class="sd">    ... })</span>
<span class="sd">    &gt;&gt;&gt; Polarization_Control(df, &#39;temp_time&#39;)  # Plots Temperature vs Time</span>
<span class="sd">    &gt;&gt;&gt; Polarization_Control(df, &#39;Max_temp&#39;)</span>
<span class="sd">    100</span>
<span class="sd">    &gt;&gt;&gt; Polarization_Control(df, &#39;100% reaction&#39;)</span>
<span class="sd">    (100, 4)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Extract arrays</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">])</span>
    <span class="n">pressure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;pressure&#39;</span><span class="p">])</span>   <span class="c1"># FIX: corrected spelling (&quot;pessure&quot; → &quot;pressure&quot;)</span>
    <span class="n">reaction_percent</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;percent&#39;</span><span class="p">])</span>
    
    <span class="k">if</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;temp_time&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Temperature variation&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span><span class="s1">&#39;serif&#39;</span><span class="p">,</span><span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">16</span><span class="p">})</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time(s)&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span><span class="s1">&#39;serif&#39;</span><span class="p">,</span><span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">16</span><span class="p">})</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Temperature (°C)&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span><span class="s1">&#39;serif&#39;</span><span class="p">,</span><span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">16</span><span class="p">})</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;pressure_time&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">pressure</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Pressure variation&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span><span class="s1">&#39;serif&#39;</span><span class="p">,</span><span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">16</span><span class="p">})</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time(s)&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span><span class="s1">&#39;serif&#39;</span><span class="p">,</span><span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">16</span><span class="p">})</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pressure (Pa)&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span><span class="s1">&#39;serif&#39;</span><span class="p">,</span><span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">16</span><span class="p">})</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;percent_time&#39;</span><span class="p">:</span>  <span class="c1"># FIX: lowercase name for consistency</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">reaction_percent</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Reaction progress&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span><span class="s1">&#39;serif&#39;</span><span class="p">,</span><span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">16</span><span class="p">})</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time(s)&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span><span class="s1">&#39;serif&#39;</span><span class="p">,</span><span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">16</span><span class="p">})</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Reaction Percent (%)&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span><span class="s1">&#39;serif&#39;</span><span class="p">,</span><span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">16</span><span class="p">})</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>




<div class="viewcode-block" id="Desulfurization_Rate">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.Desulfurization_Rate">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Desulfurization_Rate</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">application</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Analyze desulfurization rate with and without ultrasonic assistance.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : pandas.DataFrame</span>
<span class="sd">        A dataframe containing the following columns:</span>
<span class="sd">        - &#39;Time&#39;: Measurement times</span>
<span class="sd">        - &#39;Desulfurization_With_Ultrasonic&#39;: Removal efficiency with ultrasonic</span>
<span class="sd">        - &#39;Desulfurization_Without_Ultrasonic&#39;: Removal efficiency without ultrasonic</span>

<span class="sd">    application : str</span>
<span class="sd">        Choose one of the following options:</span>
<span class="sd">        - &quot;plot&quot;: plots the desulfurization with and without ultrasonic</span>
<span class="sd">        - &quot;Max_Removal_With_Ultrasonic&quot;: returns maximum removal efficiency with ultrasonic</span>
<span class="sd">        - &quot;Max_Removal_Without_Ultrasonic&quot;: returns maximum removal efficiency without ultrasonic</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float or None</span>
<span class="sd">        - Returns the maximum value (float) if application is &quot;Max_Removal_With_Ultrasonic&quot;</span>
<span class="sd">          or &quot;Max_Removal_Without_Ultrasonic&quot;.</span>
<span class="sd">        - Returns None if application is &quot;plot&quot;.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">    &gt;&gt;&gt; df = pd.DataFrame({</span>
<span class="sd">    ...     &quot;Time&quot;: [0, 10, 20, 30],</span>
<span class="sd">    ...     &quot;Desulfurization_With_Ultrasonic&quot;: [5, 20, 45, 60],</span>
<span class="sd">    ...     &quot;Desulfurization_Without_Ultrasonic&quot;: [3, 15, 35, 50]</span>
<span class="sd">    ... })</span>
<span class="sd">    &gt;&gt;&gt; Desulfurization_Rate(df, &quot;Max_Removal_With_Ultrasonic&quot;)</span>
<span class="sd">    60</span>
<span class="sd">    &gt;&gt;&gt; Desulfurization_Rate(df, &quot;plot&quot;)</span>
<span class="sd">    # Displays plot</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Extract columns as numpy arrays</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">])</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Desulfurization_With_Ultrasonic&#39;</span><span class="p">])</span>
    <span class="n">y2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Desulfurization_Without_Ultrasonic&#39;</span><span class="p">])</span>
    
    <span class="k">if</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;plot&#39;</span><span class="p">:</span>
        <span class="c1"># Plot both cases</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;With Ultrasonic&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">mec</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Without Ultrasonic&#39;</span><span class="p">)</span>

        <span class="n">myfont</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;serif&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">}</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Desulfurization (%)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Sulfur Removal Plot&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">myfont</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;Max_Removal_With_Ultrasonic&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">y1</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">application</span> <span class="o">==</span> <span class="s1">&#39;Max_Removal_Without_Ultrasonic&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">y2</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid application. Choose from: &#39;plot&#39;, &quot;</span>
                         <span class="s2">&quot;&#39;Max_Removal_With_Ultrasonic&#39;, &quot;</span>
                         <span class="s2">&quot;&#39;Max_Removal_Without_Ultrasonic&#39;&quot;</span><span class="p">)</span></div>








<div class="viewcode-block" id="Imerssion_Test">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.Imerssion_Test">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Imerssion_Test</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">application</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Analyze immersion test data for weight gain/loss over time.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : pandas.DataFrame</span>
<span class="sd">        A DataFrame containing immersion test results with the following columns:</span>
<span class="sd">        - &#39;time&#39;</span>
<span class="sd">        - &#39;Mg&#39;</span>
<span class="sd">        - &#39;Mg_H&#39;</span>
<span class="sd">        - &#39;Mg_Pl&#39;</span>
<span class="sd">        - &#39;Mg_HPl&#39;</span>
<span class="sd">    application : str</span>
<span class="sd">        The analysis to perform:</span>
<span class="sd">            - &#39;plot&#39; : Plot the changes of weight (%) vs. time (days).</span>
<span class="sd">            - &#39;More_Bioactive&#39; : Return the sample with the highest weight gain (more bioactive).</span>
<span class="sd">            - &#39;Less_Bioactive&#39; : Return the sample with the greatest weight loss (less bioactive).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None or str</span>
<span class="sd">        - If application == &#39;plot&#39;, displays a plot and returns None.</span>
<span class="sd">        - If application == &#39;More_Bioactive&#39;, returns the name of the most bioactive sample.</span>
<span class="sd">        - If application == &#39;Less_Bioactive&#39;, returns the name of the least bioactive sample.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">    &gt;&gt;&gt; df = pd.DataFrame({</span>
<span class="sd">    ...     &#39;time&#39;: [1, 2, 3],</span>
<span class="sd">    ...     &#39;Mg&#39;: [0.1, 0.2, 0.3],</span>
<span class="sd">    ...     &#39;Mg_H&#39;: [0.2, 0.3, 0.5],</span>
<span class="sd">    ...     &#39;Mg_Pl&#39;: [0.15, 0.25, 0.35],</span>
<span class="sd">    ...     &#39;Mg_HPl&#39;: [0.25, 0.35, 0.45]</span>
<span class="sd">    ... })</span>
<span class="sd">    &gt;&gt;&gt; Imerssion_Test(df, &#39;More_Bioactive&#39;)</span>
<span class="sd">    &#39;Mg_HPl&#39;</span>
<span class="sd">    &gt;&gt;&gt; Imerssion_Test(df, &#39;Less_Bioactive&#39;)</span>
<span class="sd">    &#39;Mg&#39;</span>
<span class="sd">    &gt;&gt;&gt; Imerssion_Test(df, &#39;plot&#39;)  # plots the data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Mg_HPl&#39;</span><span class="p">])</span>
    <span class="n">y2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Mg_H&#39;</span><span class="p">])</span>
    <span class="n">y3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Mg_Pl&#39;</span><span class="p">])</span>
    <span class="n">y4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Mg&#39;</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">application</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;plot&#39;</span><span class="p">:</span>
        <span class="c1"># Plot all curves</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mg_HPl&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mg_H&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y3</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mg_Pl&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y4</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mg&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;The graph of changes in the weight of the samples in the SBF solution&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Immersion Time (days)&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Weight Gain (%)&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">application</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;more_bioactive&#39;</span><span class="p">:</span>
        <span class="c1"># Find sample with highest maximum weight gain</span>
        <span class="n">max_col</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;Mg&#39;</span><span class="p">,</span> <span class="s1">&#39;Mg_H&#39;</span><span class="p">,</span> <span class="s1">&#39;Mg_Pl&#39;</span><span class="p">,</span> <span class="s1">&#39;Mg_HPl&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">max_col</span>

    <span class="k">elif</span> <span class="n">application</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;less_bioactive&#39;</span><span class="p">:</span>
        <span class="c1"># Find sample with lowest minimum weight (largest weight loss)</span>
        <span class="n">min_col</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;Mg&#39;</span><span class="p">,</span> <span class="s1">&#39;Mg_H&#39;</span><span class="p">,</span> <span class="s1">&#39;Mg_Pl&#39;</span><span class="p">,</span> <span class="s1">&#39;Mg_HPl&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">min_col</span></div>







<div class="viewcode-block" id="Reaction_Conversion_Analysis">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.Reaction_Conversion_Analysis">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Reaction_Conversion_Analysis</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">app</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Analyze and visualize conversion data from a chemical reaction experiment.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : pandas.DataFrame</span>
<span class="sd">        A DataFrame that must contain the following columns:</span>
<span class="sd">        - &#39;time&#39; : time in seconds</span>
<span class="sd">        - &#39;temp&#39; : temperature in Celsius</span>
<span class="sd">        - &#39;pressure&#39; : pressure in bar</span>
<span class="sd">        - &#39;conv&#39; : conversion percentage</span>
<span class="sd">        </span>
<span class="sd">    app : str</span>
<span class="sd">        Determines the action:</span>
<span class="sd">        - &quot;PLOT_TEMP&quot;        → plots Temperature vs. Time</span>
<span class="sd">        - &quot;PLOT_PRESSURE&quot;    → plots Pressure vs. Time</span>
<span class="sd">        - &quot;PLOT_CONVERSION&quot;  → plots Conversion vs. Time</span>
<span class="sd">        - &quot;MAXIMUM_CONVERSION&quot; → returns index and values at maximum conversion</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : int or None</span>
<span class="sd">        - If `app=&quot;MAXIMUM_CONVERSION&quot;`, returns the index of maximum conversion.</span>
<span class="sd">        - Otherwise, returns None (just shows plots).</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    TypeError</span>
<span class="sd">        If `app` is not one of the accepted values.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">    &gt;&gt;&gt; df = pd.DataFrame({</span>
<span class="sd">    ...     &quot;time&quot;: [0, 1, 2, 3],</span>
<span class="sd">    ...     &quot;temp&quot;: [300, 310, 315, 320],</span>
<span class="sd">    ...     &quot;pressure&quot;: [1, 1.2, 1.3, 1.4],</span>
<span class="sd">    ...     &quot;conv&quot;: [10, 20, 30, 50]</span>
<span class="sd">    ... })</span>
<span class="sd">    &gt;&gt;&gt; Conversion_Analysis(df, &quot;PLOT_TEMP&quot;)  # plots Temperature vs Time</span>
<span class="sd">    &gt;&gt;&gt; Conversion_Analysis(df, &quot;MAXIMUM_CONVERSION&quot;)</span>
<span class="sd">    maximum of temperature is  320</span>
<span class="sd">    maximum of conversion is  50</span>
<span class="sd">    The temperature in maximum conversion is  320 and the pressure is  1.4</span>
<span class="sd">    3</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Ensure required columns exist</span>
    <span class="n">required_cols</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;temp&quot;</span><span class="p">,</span> <span class="s2">&quot;pressure&quot;</span><span class="p">,</span> <span class="s2">&quot;conv&quot;</span><span class="p">}</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">required_cols</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data must contain columns: </span><span class="si">{</span><span class="n">required_cols</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">])</span>
    <span class="n">pressure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;pressure&#39;</span><span class="p">])</span>
    <span class="n">conv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;conv&#39;</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">app</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;PLOT_TEMP&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Temperature over Time&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Temperature (°C)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">app</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;PLOT_PRESSURE&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">pressure</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Pressure over Time&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pressure (bar)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">app</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;PLOT_CONVERSION&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">conv</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Conversion over Time&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Conversion (%)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">app</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;MAXIMUM_CONVERSION&#39;</span><span class="p">:</span>
        <span class="n">max_conv</span> <span class="o">=</span> <span class="n">conv</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">idx_max_conv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">conv</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;maximum of temperature is&#39;</span><span class="p">,</span> <span class="n">temp</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;maximum of conversion is&#39;</span><span class="p">,</span> <span class="n">max_conv</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s1">&#39;The temperature at maximum conversion is&#39;</span><span class="p">,</span> <span class="n">temp</span><span class="p">[</span><span class="n">idx_max_conv</span><span class="p">],</span>
            <span class="s1">&#39;and the pressure is&#39;</span><span class="p">,</span> <span class="n">pressure</span><span class="p">[</span><span class="n">idx_max_conv</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">idx_max_conv</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The data or application argument is not entered correctly.&#39;</span><span class="p">)</span></div>






<div class="viewcode-block" id="Import_Data">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.Import_Data">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Import_Data</span><span class="p">(</span><span class="n">File_Directory</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    
    
    <span class="k">if</span> <span class="n">File_Directory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Please enter the file directory to open!&#39;</span><span class="p">)</span>
        
        
        
    <span class="k">try</span><span class="p">:</span>
        <span class="n">data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">File_Directory</span><span class="p">)</span>
        
        
<span class="c1">#for examle --&gt;data=pd.read_csv(&#39;C:\\Users\\Parsis.Co\\Desktop\\CV.csv&#39;)</span>
         
         
<span class="c1">#1---&gt;File not find  (by &#39;FileNotFoundError&#39;)       </span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s1">&#39;Unfortunately, the desired file &lt;&#39;</span><span class="p">,</span><span class="n">File_Directory</span><span class="p">,</span><span class="s1">&#39;&gt;is not available &#39;</span><span class="p">)</span>
        
        
        
<span class="c1">#2---&gt; File is  empty (by &#39;pd.errors.EmptyDataError&#39;)</span>
    <span class="k">except</span> <span class="n">pd</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">EmptyDataError</span><span class="p">:</span>
         <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The file: &#39;</span><span class="p">,</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39; is empty. please a correct file.&#39;</span><span class="p">)</span>
         
   
<span class="c1">#3---&gt;Format is wrong  (by &#39;pd.errors.ParserError&#39;)     </span>
    <span class="k">except</span> <span class="n">pd</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">ParserError</span><span class="p">:</span>
             <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The file format is not valid, please import a &lt;csv&gt; format file&#39;</span><span class="p">)</span>
             
             
 <span class="c1">#4---&gt;remove empty cells     </span>
    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Empty cell founded and removed &#39;</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        
 <span class="c1">#5---&gt;turn object to numeric form for both columns    </span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="o">==</span><span class="s1">&#39;object&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;object element founded in potential column and converted to numeric form&#39;</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">])</span>
            
    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="o">==</span><span class="s1">&#39;object&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;object element founded in current density column and converted to numeric&#39;</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">])</span>
            
            
 <span class="c1">#6---&gt;remove duplicated data         </span>
    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Duolicated elemets in rows founded and removed &#39;</span><span class="p">)</span>
        <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
        
        
    <span class="k">return</span> <span class="n">data</span></div>

        
            




<div class="viewcode-block" id="Fatigue_Test_Analysis">
<a class="viewcode-back" href="../../modules_/data_analysis.html#PyGamLab.Data_Analysis.Fatigue_Test_Analysis">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Fatigue_Test_Analysis</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">application</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Analyze fatigue test data and provide multiple metrics and plots.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : pandas.DataFrame</span>
<span class="sd">        Must contain columns:</span>
<span class="sd">        - &#39;stress_amplitude&#39; : Stress amplitude in MPa</span>
<span class="sd">        - &#39;number_of_cycles&#39; : Number of cycles to failure (N)</span>
<span class="sd">    </span>
<span class="sd">    application : str</span>
<span class="sd">        Determines the operation:</span>
<span class="sd">        - &quot;plot&quot;                  : S-N plot (Stress vs. Number of Cycles)</span>
<span class="sd">        - &quot;max stress amplitude&quot;  : Maximum stress amplitude</span>
<span class="sd">        - &quot;fatigue strength&quot;      : Mean stress amplitude</span>
<span class="sd">        - &quot;fatigue life&quot;          : Mean number of cycles</span>
<span class="sd">        - &quot;stress in one cycle&quot;   : Basquin&#39;s equation for stress at N=1</span>
<span class="sd">        - &quot;Sa&quot;                    : Stress amplitude at N=1</span>
<span class="sd">        - &quot;fatigue limit&quot;         : Cycle where stress becomes constant</span>
<span class="sd">        - &quot;std stress&quot;            : Standard deviation of stress</span>
<span class="sd">        - &quot;std cycles&quot;            : Standard deviation of cycles</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    value : float or array-like or None</span>
<span class="sd">        Result depending on the chosen application.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">stress_amplitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;stress_amplitude&quot;</span><span class="p">])</span>
    <span class="n">number_of_cycles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;number_of_cycles&quot;</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">application</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;plot&quot;</span><span class="p">:</span>
        <span class="n">title_font</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;Merriweather&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">}</span>
        <span class="n">xy_label_font</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;Magenta&quot;</span><span class="p">,</span> <span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;Merriweather&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">}</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">number_of_cycles</span><span class="p">,</span> <span class="n">stress_amplitude</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">mec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> 
                 <span class="n">label</span><span class="o">=</span><span class="s1">&#39;S-N Curve&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;S-N Curve (Fatigue Test)&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">title_font</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Number of Cycles to Failure (N)&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">xy_label_font</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Stress Amplitude (MPa)&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">xy_label_font</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">application</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;max stress amplitude&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">stress_amplitude</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">application</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;fatigue strength&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">stress_amplitude</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">application</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;fatigue life&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">number_of_cycles</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">application</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;stress in one cycle&#39;</span><span class="p">:</span>
        <span class="c1"># Basquin&#39;s law: Sa = S_f * N^b, solve for stress at N=1</span>
        <span class="n">log_N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">number_of_cycles</span><span class="p">)</span>
        <span class="n">log_S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">stress_amplitude</span><span class="p">)</span>
        <span class="n">b</span><span class="p">,</span> <span class="n">log_Sf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">log_N</span><span class="p">,</span> <span class="n">log_S</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># Linear fit: log(S) = b*log(N) + log(Sf)</span>
        <span class="n">stress_one_cycle</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">log_Sf</span><span class="p">)</span>  <span class="c1"># Stress at N=1</span>
        <span class="k">return</span> <span class="n">stress_one_cycle</span>

    <span class="k">if</span> <span class="n">application</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;sa&#39;</span><span class="p">:</span>
        <span class="c1"># Stress amplitude at N=1, if exact not present, take nearest</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">number_of_cycles</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">stress_amplitude</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">application</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;fatigue limit&#39;</span><span class="p">:</span>
        <span class="n">fatigue_limit</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">stress_amplitude</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">stress_amplitude</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">stress_amplitude</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">fatigue_limit</span> <span class="o">=</span> <span class="n">number_of_cycles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="n">fatigue_limit</span>

    <span class="k">if</span> <span class="n">application</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;std stress&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">stress_amplitude</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">application</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;std cycles&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">number_of_cycles</span><span class="p">)</span>

    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid application. Choose a valid option.&quot;</span><span class="p">)</span></div>

    






</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Ali Pilehvar Meibody
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="../../_static/documentation_options.js?v=79f5c508"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=5fa4622c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    </body>
</html>